<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE PatternGuards, DeriveDataTypeable  #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Module      :  Language.C.Analysis.DefTable</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Copyright   :  (c) 2008 Benedikt Huber</span><span>
</span><a name="line-6"></a><span class="hs-comment">--                  based on code from c2hs</span><span>
</span><a name="line-7"></a><span class="hs-comment">--                (c) [1999..2001] Manuel M. T. Chakravarty</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- License     :  BSD-style</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Maintainer  :  benedikt.huber@gmail.com</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Stability   :  alpha</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- Portability :  ghc</span><span>
</span><a name="line-12"></a><span class="hs-comment">--</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- This module manages symbols in local and global scopes.</span><span>
</span><a name="line-14"></a><span class="hs-comment">--</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- There are four different kind of identifiers: ordinary identifiers (henceforth</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- simply called `identifier'), tag names (names of struct\/union\/enum types),</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- labels and structure members.</span><span>
</span><a name="line-18"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-19"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.C.Analysis.DefTable</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-20"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#identOfTyDecl"><span class="hs-identifier hs-var">identOfTyDecl</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#TagEntry"><span class="hs-identifier hs-type">TagEntry</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#TagFwdDecl"><span class="hs-identifier hs-type">TagFwdDecl</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#emptyDefTable"><span class="hs-identifier hs-var">emptyDefTable</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#globalDefs"><span class="hs-identifier hs-var">globalDefs</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#inFileScope"><span class="hs-identifier hs-var">inFileScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#enterFunctionScope"><span class="hs-identifier hs-var">enterFunctionScope</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#leaveFunctionScope"><span class="hs-identifier hs-var">leaveFunctionScope</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#enterBlockScope"><span class="hs-identifier hs-var">enterBlockScope</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#leaveBlockScope"><span class="hs-identifier hs-var">leaveBlockScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#enterMemberDecl"><span class="hs-identifier hs-var">enterMemberDecl</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#leaveMemberDecl"><span class="hs-identifier hs-var">leaveMemberDecl</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#declStatusDescr"><span class="hs-identifier hs-var">declStatusDescr</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#defineTypeDef"><span class="hs-identifier hs-var">defineTypeDef</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#defineGlobalIdent"><span class="hs-identifier hs-var">defineGlobalIdent</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#defineScopedIdent"><span class="hs-identifier hs-var">defineScopedIdent</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#defineScopedIdentWhen"><span class="hs-identifier hs-var">defineScopedIdentWhen</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#declareTag"><span class="hs-identifier hs-var">declareTag</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#defineTag"><span class="hs-identifier hs-var">defineTag</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#defineLabel"><span class="hs-identifier hs-var">defineLabel</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#lookupIdent"><span class="hs-identifier hs-var">lookupIdent</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#lookupTag"><span class="hs-identifier hs-var">lookupTag</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#lookupLabel"><span class="hs-identifier hs-var">lookupLabel</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#lookupIdentInner"><span class="hs-identifier hs-var">lookupIdentInner</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#lookupTagInner"><span class="hs-identifier hs-var">lookupTagInner</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#insertType"><span class="hs-identifier hs-var">insertType</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#lookupType"><span class="hs-identifier hs-var">lookupType</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>    </span><a href="Language.C.Analysis.DefTable.html#mergeDefTable"><span class="hs-identifier hs-var">mergeDefTable</span></a><span>
</span><a name="line-34"></a><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">where</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="Language.C.Data.html"><span class="hs-identifier">Language.C.Data</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html"><span class="hs-identifier">Language.C.Analysis.NameSpaceMap</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="Language.C.Analysis.SemRep.html"><span class="hs-identifier">Language.C.Analysis.SemRep</span></a><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.IntMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">union</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.IntMap</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IntMap</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Generics</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span class="hs-comment">{- Name spaces, scopes and contexts [Scopes]

 In C, there are 4 categories of identifiers:

  * labels
  * tag names (@(struct|union|enum) tag-name@), where /all/ tag names live in one namespace
  * members of structures and unions
  * ordinary identifiers, denoting objects, functions, typeDefs and enumeration constants

 There are 4 kind of scopes:

  * file scope: outside of parameter lists and blocks
  * function prototype scope
  * function scope: labels are visible within the entire function, and declared implicitely
  * block scope

 While function scope is irrelevant for variable declarations, they might also appear in member declarations.
 Therefore, there are also 4 kinds of contexts where a variable might be declared:

  * File Scope Context: external declaration \/ definition
  * Block Scope Context: either external or local definition
  * Function prototype scope context
  * Member Declaration context

 See
   &lt;http://www.embedded.com/design/206901036&gt;
   C99 6
-}</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span class="hs-comment">-- | All ordinary identifiers map to 'IdenTyDecl': either a typedef or a object\/function\/enumerator</span><span>
</span><a name="line-75"></a><span class="hs-keyword">type</span><span> </span><a name="IdentEntry"><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier">IdentEntry</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Language.C.Analysis.SemRep.html#TypeDef"><span class="hs-identifier hs-type">TypeDef</span></a><span> </span><a href="Language.C.Analysis.SemRep.html#IdentDecl"><span class="hs-identifier hs-type">IdentDecl</span></a><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-identifier">identOfTyDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span>
</span><a name="line-78"></a><a name="identOfTyDecl"><a href="Language.C.Analysis.DefTable.html#identOfTyDecl"><span class="hs-identifier">identOfTyDecl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><a href="Language.C.Analysis.SemRep.html#identOfTypeDef"><span class="hs-identifier hs-var">identOfTypeDef</span></a><span> </span><a href="Language.C.Analysis.SemRep.html#declIdent"><span class="hs-identifier hs-var">declIdent</span></a><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span class="hs-keyword">data</span><span> </span><a name="TagFwdDecl"><a href="Language.C.Analysis.DefTable.html#TagFwdDecl"><span class="hs-identifier">TagFwdDecl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CompDecl"><a href="Language.C.Analysis.DefTable.html#CompDecl"><span class="hs-identifier">CompDecl</span></a></a><span> </span><a href="Language.C.Analysis.SemRep.html#CompTypeRef"><span class="hs-identifier hs-type">CompTypeRef</span></a><span>
</span><a name="line-81"></a><span>                </span><span class="hs-glyph">|</span><span> </span><a name="EnumDecl"><a href="Language.C.Analysis.DefTable.html#EnumDecl"><span class="hs-identifier">EnumDecl</span></a></a><span> </span><a href="Language.C.Analysis.SemRep.html#EnumTypeRef"><span class="hs-identifier hs-type">EnumTypeRef</span></a><span>
</span><a name="line-82"></a><span class="hs-keyword">instance</span><span> </span><a href="Language.C.Analysis.SemRep.html#HasSUERef"><span class="hs-identifier hs-type">HasSUERef</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#TagFwdDecl"><span class="hs-identifier hs-type">TagFwdDecl</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-83"></a><span>  </span><a name="local-8214565720323914057"><a href="Language.C.Analysis.SemRep.html#sueRef"><span class="hs-identifier">sueRef</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#CompDecl"><span class="hs-identifier hs-var">CompDecl</span></a><span> </span><a name="local-6989586621679154742"><a href="#local-6989586621679154742"><span class="hs-identifier">ctr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.SemRep.html#sueRef"><span class="hs-identifier hs-var">sueRef</span></a><span> </span><a href="#local-6989586621679154742"><span class="hs-identifier hs-var">ctr</span></a><span>
</span><a name="line-84"></a><span>  </span><span class="hs-identifier">sueRef</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#EnumDecl"><span class="hs-identifier hs-var">EnumDecl</span></a><span> </span><a name="local-6989586621679154743"><a href="#local-6989586621679154743"><span class="hs-identifier">etr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.SemRep.html#sueRef"><span class="hs-identifier hs-var">sueRef</span></a><span> </span><a href="#local-6989586621679154743"><span class="hs-identifier hs-var">etr</span></a><span>
</span><a name="line-85"></a><span class="hs-keyword">instance</span><span> </span><a href="Language.C.Data.Node.html#CNode"><span class="hs-identifier hs-type">CNode</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#TagFwdDecl"><span class="hs-identifier hs-type">TagFwdDecl</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-86"></a><span>  </span><a name="local-8214565720323818016"><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier">nodeInfo</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#CompDecl"><span class="hs-identifier hs-var">CompDecl</span></a><span> </span><a name="local-6989586621679154740"><a href="#local-6989586621679154740"><span class="hs-identifier">ctr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679154740"><span class="hs-identifier hs-var">ctr</span></a><span>
</span><a name="line-87"></a><span>  </span><span class="hs-identifier">nodeInfo</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#EnumDecl"><span class="hs-identifier hs-var">EnumDecl</span></a><span> </span><a name="local-6989586621679154741"><a href="#local-6989586621679154741"><span class="hs-identifier">etr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679154741"><span class="hs-identifier hs-var">etr</span></a><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-comment">-- | Tag names map to forward declarations or definitions of struct\/union\/enum types</span><span>
</span><a name="line-90"></a><span class="hs-keyword">type</span><span> </span><a name="TagEntry"><a href="Language.C.Analysis.DefTable.html#TagEntry"><span class="hs-identifier">TagEntry</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Language.C.Analysis.DefTable.html#TagFwdDecl"><span class="hs-identifier hs-type">TagFwdDecl</span></a><span> </span><a href="Language.C.Analysis.SemRep.html#TagDef"><span class="hs-identifier hs-type">TagDef</span></a><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- | Table holding current definitions</span><span>
</span><a name="line-93"></a><span class="hs-keyword">data</span><span> </span><a name="DefTable"><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier">DefTable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="DefTable"><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier">DefTable</span></a></a><span>
</span><a name="line-94"></a><span>    </span><span class="hs-special">{</span><span>
</span><a name="line-95"></a><span>        </span><a name="identDecls"><a href="Language.C.Analysis.DefTable.html#identDecls"><span class="hs-identifier">identDecls</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#NameSpaceMap"><span class="hs-identifier hs-type">NameSpaceMap</span></a><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span class="hs-special">,</span><span>     </span><span class="hs-comment">-- ^ declared `ordinary identifiers'</span><span>
</span><a name="line-96"></a><span>        </span><a name="tagDecls"><a href="Language.C.Analysis.DefTable.html#tagDecls"><span class="hs-identifier">tagDecls</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#NameSpaceMap"><span class="hs-identifier hs-type">NameSpaceMap</span></a><span> </span><a href="Language.C.Data.Ident.html#SUERef"><span class="hs-identifier hs-type">SUERef</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#TagEntry"><span class="hs-identifier hs-type">TagEntry</span></a><span class="hs-special">,</span><span>        </span><span class="hs-comment">-- ^ declared struct/union/enum  tags</span><span>
</span><a name="line-97"></a><span>        </span><a name="labelDefs"><a href="Language.C.Analysis.DefTable.html#labelDefs"><span class="hs-identifier">labelDefs</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#NameSpaceMap"><span class="hs-identifier hs-type">NameSpaceMap</span></a><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span class="hs-special">,</span><span>            </span><span class="hs-comment">-- ^ defined labels</span><span>
</span><a name="line-98"></a><span>        </span><a name="memberDecls"><a href="Language.C.Analysis.DefTable.html#memberDecls"><span class="hs-identifier">memberDecls</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#NameSpaceMap"><span class="hs-identifier hs-type">NameSpaceMap</span></a><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><a href="Language.C.Analysis.SemRep.html#MemberDecl"><span class="hs-identifier hs-type">MemberDecl</span></a><span class="hs-special">,</span><span>      </span><span class="hs-comment">-- ^ member declarations (only local)</span><span>
</span><a name="line-99"></a><span>        </span><a name="refTable"><a href="Language.C.Analysis.DefTable.html#refTable"><span class="hs-identifier">refTable</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="Language.C.Data.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span>                         </span><span class="hs-comment">-- ^ link names with definitions</span><span>
</span><a name="line-100"></a><span>        </span><a name="typeTable"><a href="Language.C.Analysis.DefTable.html#typeTable"><span class="hs-identifier">typeTable</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="Language.C.Analysis.SemRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-101"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-comment">-- | empty definition table, with all name space maps in global scope</span><span>
</span><a name="line-104"></a><span class="hs-identifier">emptyDefTable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span>
</span><a name="line-105"></a><a name="emptyDefTable"><a href="Language.C.Analysis.DefTable.html#emptyDefTable"><span class="hs-identifier">emptyDefTable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-var">DefTable</span></a><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#nameSpaceMap"><span class="hs-identifier hs-var">nameSpaceMap</span></a><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#nameSpaceMap"><span class="hs-identifier hs-var">nameSpaceMap</span></a><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#nameSpaceMap"><span class="hs-identifier hs-var">nameSpaceMap</span></a><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#nameSpaceMap"><span class="hs-identifier hs-var">nameSpaceMap</span></a><span> </span><span class="hs-identifier hs-var">IntMap.empty</span><span> </span><span class="hs-identifier hs-var">IntMap.empty</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-comment">-- | get the globally defined entries of a definition table</span><span>
</span><a name="line-108"></a><span class="hs-identifier">globalDefs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#GlobalDecls"><span class="hs-identifier hs-type">GlobalDecls</span></a><span>
</span><a name="line-109"></a><a name="globalDefs"><a href="Language.C.Analysis.DefTable.html#globalDefs"><span class="hs-identifier">globalDefs</span></a></a><span> </span><a name="local-6989586621679154750"><a href="#local-6989586621679154750"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.foldWithKey</span><span> </span><a href="#local-6989586621679154754"><span class="hs-identifier hs-var">insertDecl</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#GlobalDecls"><span class="hs-identifier hs-var">GlobalDecls</span></a><span> </span><a href="#local-6989586621679154751"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679154753"><span class="hs-identifier hs-var">gtags</span></a><span> </span><a href="#local-6989586621679154751"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.NameSpaceMap.html#globalNames"><span class="hs-identifier hs-var">globalNames</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">identDecls</span><span> </span><a href="#local-6989586621679154750"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-111"></a><span>    </span><a name="local-6989586621679154751"><a href="#local-6989586621679154751"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.empty</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679154752"><a href="#local-6989586621679154752"><span class="hs-identifier">_fwd_decls</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154753"><a href="#local-6989586621679154753"><span class="hs-identifier">gtags</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.mapEither</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#globalNames"><span class="hs-identifier hs-var">globalNames</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tagDecls</span><span> </span><a href="#local-6989586621679154750"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>    </span><a name="local-6989586621679154754"><a href="#local-6989586621679154754"><span class="hs-identifier">insertDecl</span></a></a><span> </span><a name="local-6989586621679154755"><a href="#local-6989586621679154755"><span class="hs-identifier">ident</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679154756"><a href="#local-6989586621679154756"><span class="hs-identifier">tydef</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679154757"><a href="#local-6989586621679154757"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154757"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gTypeDefs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.insert</span><span> </span><a href="#local-6989586621679154755"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679154756"><span class="hs-identifier hs-var">tydef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gTypeDefs</span><span> </span><a href="#local-6989586621679154757"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-identifier">insertDecl</span><span> </span><a name="local-6989586621679154758"><a href="#local-6989586621679154758"><span class="hs-identifier">ident</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679154759"><a href="#local-6989586621679154759"><span class="hs-identifier">obj</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679154760"><a href="#local-6989586621679154760"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154760"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">gObjs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.insert</span><span> </span><a href="#local-6989586621679154758"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679154759"><span class="hs-identifier hs-var">obj</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">gObjs</span><span> </span><a href="#local-6989586621679154760"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-identifier">inFileScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-117"></a><a name="inFileScope"><a href="Language.C.Analysis.DefTable.html#inFileScope"><span class="hs-identifier">inFileScope</span></a></a><span> </span><a name="local-6989586621679154761"><a href="#local-6989586621679154761"><span class="hs-identifier">dt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.NameSpaceMap.html#hasLocalNames"><span class="hs-identifier hs-var">hasLocalNames</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">identDecls</span><span> </span><a href="#local-6989586621679154761"><span class="hs-identifier hs-var">dt</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#hasLocalNames"><span class="hs-identifier hs-var">hasLocalNames</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">labelDefs</span><span> </span><a href="#local-6989586621679154761"><span class="hs-identifier hs-var">dt</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-identifier">leaveScope_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679154748"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#NameSpaceMap"><span class="hs-identifier hs-type">NameSpaceMap</span></a><span> </span><a href="#local-6989586621679154748"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679154749"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#NameSpaceMap"><span class="hs-identifier hs-type">NameSpaceMap</span></a><span> </span><a href="#local-6989586621679154748"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679154749"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-120"></a><a name="leaveScope_"><a href="Language.C.Analysis.DefTable.html#leaveScope_"><span class="hs-identifier">leaveScope_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#leaveScope"><span class="hs-identifier hs-var">leaveScope</span></a><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-identifier">enterLocalScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span>
</span><a name="line-123"></a><a name="enterLocalScope"><a href="Language.C.Analysis.DefTable.html#enterLocalScope"><span class="hs-identifier">enterLocalScope</span></a></a><span> </span><a name="local-6989586621679154762"><a href="#local-6989586621679154762"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154762"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-124"></a><span>        </span><span class="hs-identifier">identDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#enterNewScope"><span class="hs-identifier hs-var">enterNewScope</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">identDecls</span><span> </span><a href="#local-6989586621679154762"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-125"></a><span>        </span><span class="hs-identifier">tagDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#enterNewScope"><span class="hs-identifier hs-var">enterNewScope</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tagDecls</span><span> </span><a href="#local-6989586621679154762"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-126"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-127"></a><span class="hs-identifier">leaveLocalScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span>
</span><a name="line-128"></a><a name="leaveLocalScope"><a href="Language.C.Analysis.DefTable.html#leaveLocalScope"><span class="hs-identifier">leaveLocalScope</span></a></a><span> </span><a name="local-6989586621679154763"><a href="#local-6989586621679154763"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154763"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-129"></a><span>                        </span><span class="hs-identifier">identDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#leaveScope_"><span class="hs-identifier hs-var">leaveScope_</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">identDecls</span><span> </span><a href="#local-6989586621679154763"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-130"></a><span>                        </span><span class="hs-identifier">tagDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#leaveScope_"><span class="hs-identifier hs-var">leaveScope_</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tagDecls</span><span> </span><a href="#local-6989586621679154763"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>                       </span><span class="hs-special">}</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-comment">-- | Enter function scope (AND the corresponding block scope)</span><span>
</span><a name="line-134"></a><span class="hs-identifier">enterFunctionScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span>
</span><a name="line-135"></a><a name="enterFunctionScope"><a href="Language.C.Analysis.DefTable.html#enterFunctionScope"><span class="hs-identifier">enterFunctionScope</span></a></a><span> </span><a name="local-6989586621679154764"><a href="#local-6989586621679154764"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#enterLocalScope"><span class="hs-identifier hs-var">enterLocalScope</span></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679154764"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">labelDefs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#enterNewScope"><span class="hs-identifier hs-var">enterNewScope</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">labelDefs</span><span> </span><a href="#local-6989586621679154764"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">-- | Leave function scope, and return the associated DefTable.</span><span>
</span><a name="line-138"></a><span class="hs-comment">--   Error if not in function scope.</span><span>
</span><a name="line-139"></a><span class="hs-identifier">leaveFunctionScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span>
</span><a name="line-140"></a><a name="leaveFunctionScope"><a href="Language.C.Analysis.DefTable.html#leaveFunctionScope"><span class="hs-identifier">leaveFunctionScope</span></a></a><span> </span><a name="local-6989586621679154765"><a href="#local-6989586621679154765"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#leaveLocalScope"><span class="hs-identifier hs-var">leaveLocalScope</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679154765"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">labelDefs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#leaveScope_"><span class="hs-identifier hs-var">leaveScope_</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">labelDefs</span><span> </span><a href="#local-6989586621679154765"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">-- | Enter new block scope</span><span>
</span><a name="line-143"></a><span class="hs-identifier">enterBlockScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span>
</span><a name="line-144"></a><a name="enterBlockScope"><a href="Language.C.Analysis.DefTable.html#enterBlockScope"><span class="hs-identifier">enterBlockScope</span></a></a><span> </span><a name="local-6989586621679154766"><a href="#local-6989586621679154766"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#enterLocalScope"><span class="hs-identifier hs-var">enterLocalScope</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679154766"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">labelDefs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#enterNewScope"><span class="hs-identifier hs-var">enterNewScope</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">labelDefs</span><span> </span><a href="#local-6989586621679154766"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-comment">-- | Leave innermost block scope</span><span>
</span><a name="line-147"></a><span class="hs-identifier">leaveBlockScope</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span>
</span><a name="line-148"></a><a name="leaveBlockScope"><a href="Language.C.Analysis.DefTable.html#leaveBlockScope"><span class="hs-identifier">leaveBlockScope</span></a></a><span> </span><a name="local-6989586621679154767"><a href="#local-6989586621679154767"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#leaveLocalScope"><span class="hs-identifier hs-var">leaveLocalScope</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679154767"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">labelDefs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#leaveScope_"><span class="hs-identifier hs-var">leaveScope_</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">labelDefs</span><span> </span><a href="#local-6989586621679154767"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span class="hs-comment">-- | Enter new member declaration scope</span><span>
</span><a name="line-151"></a><span class="hs-identifier">enterMemberDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span>
</span><a name="line-152"></a><a name="enterMemberDecl"><a href="Language.C.Analysis.DefTable.html#enterMemberDecl"><span class="hs-identifier">enterMemberDecl</span></a></a><span> </span><a name="local-6989586621679154768"><a href="#local-6989586621679154768"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154768"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">memberDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#enterNewScope"><span class="hs-identifier hs-var">enterNewScope</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">memberDecls</span><span> </span><a href="#local-6989586621679154768"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-comment">-- | Leave innermost member declaration scope</span><span>
</span><a name="line-155"></a><span class="hs-identifier">leaveMemberDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Language.C.Analysis.SemRep.html#MemberDecl"><span class="hs-identifier hs-type">MemberDecl</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">)</span><span>
</span><a name="line-156"></a><a name="leaveMemberDecl"><a href="Language.C.Analysis.DefTable.html#leaveMemberDecl"><span class="hs-identifier">leaveMemberDecl</span></a></a><span> </span><a name="local-6989586621679154769"><a href="#local-6989586621679154769"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-157"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679154770"><a href="#local-6989586621679154770"><span class="hs-identifier">decls'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154771"><a href="#local-6989586621679154771"><span class="hs-identifier">members</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#leaveScope"><span class="hs-identifier hs-var">leaveScope</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">memberDecls</span><span> </span><a href="#local-6989586621679154769"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679154771"><span class="hs-identifier hs-var">members</span></a><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>           </span><span class="hs-special">(</span><a href="#local-6989586621679154769"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">memberDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154770"><span class="hs-identifier hs-var">decls'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span class="hs-comment">-- * declarations</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-comment">-- | Status of a declaration</span><span>
</span><a name="line-164"></a><span class="hs-keyword">data</span><span> </span><a name="DeclarationStatus"><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier">DeclarationStatus</span></a></a><span> </span><a name="local-6989586621679154738"><a href="#local-6989586621679154738"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-165"></a><span>      </span><a name="NewDecl"><a href="Language.C.Analysis.DefTable.html#NewDecl"><span class="hs-identifier">NewDecl</span></a></a><span>         </span><span class="hs-comment">-- ^ new entry</span><span>
</span><a name="line-166"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Redeclared"><a href="Language.C.Analysis.DefTable.html#Redeclared"><span class="hs-identifier">Redeclared</span></a></a><span> </span><a href="#local-6989586621679154738"><span class="hs-identifier hs-type">t</span></a><span>    </span><span class="hs-comment">-- ^ old def was overwritten</span><span>
</span><a name="line-167"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="KeepDef"><a href="Language.C.Analysis.DefTable.html#KeepDef"><span class="hs-identifier">KeepDef</span></a></a><span> </span><a href="#local-6989586621679154738"><span class="hs-identifier hs-type">t</span></a><span>       </span><span class="hs-comment">-- ^ new def was discarded</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Shadowed"><a href="Language.C.Analysis.DefTable.html#Shadowed"><span class="hs-identifier">Shadowed</span></a></a><span> </span><a href="#local-6989586621679154738"><span class="hs-identifier hs-type">t</span></a><span>      </span><span class="hs-comment">-- ^ new def shadows one in outer scope</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="KindMismatch"><a href="Language.C.Analysis.DefTable.html#KindMismatch"><span class="hs-identifier">KindMismatch</span></a></a><span> </span><a href="#local-6989586621679154738"><span class="hs-identifier hs-type">t</span></a><span>  </span><span class="hs-comment">-- ^ kind mismatch</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Data</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span class="hs-identifier">declStatusDescr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="#local-6989586621679154747"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-172"></a><a name="declStatusDescr"><a href="Language.C.Analysis.DefTable.html#declStatusDescr"><span class="hs-identifier">declStatusDescr</span></a></a><span> </span><a href="Language.C.Analysis.DefTable.html#NewDecl"><span class="hs-identifier hs-var">NewDecl</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;new&quot;</span><span>
</span><a name="line-173"></a><span class="hs-identifier">declStatusDescr</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#Redeclared"><span class="hs-identifier hs-var">Redeclared</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;redeclared&quot;</span><span>
</span><a name="line-174"></a><span class="hs-identifier">declStatusDescr</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#KeepDef"><span class="hs-identifier hs-var">KeepDef</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;keep old&quot;</span><span>
</span><a name="line-175"></a><span class="hs-identifier">declStatusDescr</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#Shadowed"><span class="hs-identifier hs-var">Shadowed</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;shadowed&quot;</span><span>
</span><a name="line-176"></a><span class="hs-identifier">declStatusDescr</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;kind mismatch&quot;</span><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-identifier">compatIdentEntry</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-179"></a><a name="compatIdentEntry"><a href="Language.C.Analysis.DefTable.html#compatIdentEntry"><span class="hs-identifier">compatIdentEntry</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679154772"><a href="#local-6989586621679154772"><span class="hs-identifier">_tydef</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span class="hs-identifier">compatIdentEntry</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679154773"><a href="#local-6989586621679154773"><span class="hs-identifier">def</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-181"></a><span>  </span><span class="hs-glyph">\</span><a name="local-6989586621679154774"><a href="#local-6989586621679154774"><span class="hs-identifier">other_def</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154773"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">,</span><a href="#local-6989586621679154774"><span class="hs-identifier hs-var">other_def</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-182"></a><span>                  </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#EnumeratorDef"><span class="hs-identifier hs-var">EnumeratorDef</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.SemRep.html#EnumeratorDef"><span class="hs-identifier hs-var">EnumeratorDef</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-183"></a><span>                  </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#EnumeratorDef"><span class="hs-identifier hs-var">EnumeratorDef</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-184"></a><span>                  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.SemRep.html#EnumeratorDef"><span class="hs-identifier hs-var">EnumeratorDef</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-185"></a><span>                  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-keyword">data</span><span> </span><a name="TagEntryKind"><a href="Language.C.Analysis.DefTable.html#TagEntryKind"><span class="hs-identifier">TagEntryKind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CompKind"><a href="Language.C.Analysis.DefTable.html#CompKind"><span class="hs-identifier">CompKind</span></a></a><span> </span><a href="Language.C.Analysis.SemRep.html#CompTyKind"><span class="hs-identifier hs-type">CompTyKind</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="EnumKind"><a href="Language.C.Analysis.DefTable.html#EnumKind"><span class="hs-identifier">EnumKind</span></a></a><span>
</span><a name="line-188"></a><span>                    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Language.C.Analysis.DefTable.html#TagEntryKind"><span class="hs-identifier hs-type">TagEntryKind</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-190"></a><span>  </span><a name="local-8214565720323789997"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#CompKind"><span class="hs-identifier hs-var">CompKind</span></a><span> </span><a name="local-6989586621679154739"><a href="#local-6989586621679154739"><span class="hs-identifier">ctk</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679154739"><span class="hs-identifier hs-var">ctk</span></a><span>
</span><a name="line-191"></a><span>  </span><span class="hs-identifier">show</span><span> </span><a href="Language.C.Analysis.DefTable.html#EnumKind"><span class="hs-identifier hs-var">EnumKind</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;enum&quot;</span><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span class="hs-comment">-- | @sameTagKind ty1 ty2@ returns @True@ if @ty1,ty2@ are the same kind of tag (struct,union or enum)</span><span>
</span><a name="line-194"></a><span class="hs-identifier">tagKind</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#TagEntry"><span class="hs-identifier hs-type">TagEntry</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#TagEntryKind"><span class="hs-identifier hs-type">TagEntryKind</span></a><span>
</span><a name="line-195"></a><a name="tagKind"><a href="Language.C.Analysis.DefTable.html#tagKind"><span class="hs-identifier">tagKind</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#CompDecl"><span class="hs-identifier hs-var">CompDecl</span></a><span> </span><a name="local-6989586621679154775"><a href="#local-6989586621679154775"><span class="hs-identifier">cd</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#CompKind"><span class="hs-identifier hs-var">CompKind</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#compTag"><span class="hs-identifier hs-var">compTag</span></a><span> </span><a href="#local-6989586621679154775"><span class="hs-identifier hs-var">cd</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span class="hs-identifier">tagKind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#EnumDecl"><span class="hs-identifier hs-var">EnumDecl</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#EnumKind"><span class="hs-identifier hs-var">EnumKind</span></a><span>
</span><a name="line-197"></a><span class="hs-identifier">tagKind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#CompDef"><span class="hs-identifier hs-var">CompDef</span></a><span> </span><a name="local-6989586621679154776"><a href="#local-6989586621679154776"><span class="hs-identifier">cd</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#CompKind"><span class="hs-identifier hs-var">CompKind</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#compTag"><span class="hs-identifier hs-var">compTag</span></a><span> </span><a href="#local-6989586621679154776"><span class="hs-identifier hs-var">cd</span></a><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span class="hs-identifier">tagKind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#EnumDef"><span class="hs-identifier hs-var">EnumDef</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>  </span><a href="Language.C.Analysis.DefTable.html#EnumKind"><span class="hs-identifier hs-var">EnumKind</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-identifier">compatTagEntry</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#TagEntry"><span class="hs-identifier hs-type">TagEntry</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#TagEntry"><span class="hs-identifier hs-type">TagEntry</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-201"></a><a name="compatTagEntry"><a href="Language.C.Analysis.DefTable.html#compatTagEntry"><span class="hs-identifier">compatTagEntry</span></a></a><span>  </span><a name="local-6989586621679154777"><a href="#local-6989586621679154777"><span class="hs-identifier">te1</span></a></a><span> </span><a name="local-6989586621679154778"><a href="#local-6989586621679154778"><span class="hs-identifier">te2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#tagKind"><span class="hs-identifier hs-var">tagKind</span></a><span> </span><a href="#local-6989586621679154777"><span class="hs-identifier hs-var">te1</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Language.C.Analysis.DefTable.html#tagKind"><span class="hs-identifier hs-var">tagKind</span></a><span> </span><a href="#local-6989586621679154778"><span class="hs-identifier hs-var">te2</span></a><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-identifier">defRedeclStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154746"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679154746"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679154746"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679154746"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="#local-6989586621679154746"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-204"></a><a name="defRedeclStatus"><a href="Language.C.Analysis.DefTable.html#defRedeclStatus"><span class="hs-identifier">defRedeclStatus</span></a></a><span> </span><a name="local-6989586621679154779"><a href="#local-6989586621679154779"><span class="hs-identifier">sameKind</span></a></a><span> </span><a name="local-6989586621679154780"><a href="#local-6989586621679154780"><span class="hs-identifier">def</span></a></a><span> </span><a name="local-6989586621679154781"><a href="#local-6989586621679154781"><span class="hs-identifier">oldDecl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679154781"><span class="hs-identifier hs-var">oldDecl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-206"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679154782"><a href="#local-6989586621679154782"><span class="hs-identifier">def'</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679154780"><span class="hs-identifier hs-var">def</span></a><span> </span><span class="hs-special">`</span><a href="#local-6989586621679154779"><span class="hs-identifier hs-var">sameKind</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679154782"><span class="hs-identifier hs-var">def'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#Redeclared"><span class="hs-identifier hs-var">Redeclared</span></a><span> </span><a href="#local-6989586621679154782"><span class="hs-identifier hs-var">def'</span></a><span>
</span><a name="line-207"></a><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><a href="#local-6989586621679154782"><span class="hs-identifier hs-var">def'</span></a><span>
</span><a name="line-208"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#NewDecl"><span class="hs-identifier hs-var">NewDecl</span></a><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span class="hs-identifier">defRedeclStatusLocal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679154744"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-211"></a><span>                        </span><span class="hs-special">(</span><a href="#local-6989586621679154745"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679154745"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679154744"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679154745"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679154745"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#NameSpaceMap"><span class="hs-identifier hs-type">NameSpaceMap</span></a><span> </span><a href="#local-6989586621679154744"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679154745"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="#local-6989586621679154745"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-212"></a><a name="defRedeclStatusLocal"><a href="Language.C.Analysis.DefTable.html#defRedeclStatusLocal"><span class="hs-identifier">defRedeclStatusLocal</span></a></a><span> </span><a name="local-6989586621679154783"><a href="#local-6989586621679154783"><span class="hs-identifier">sameKind</span></a></a><span> </span><a name="local-6989586621679154784"><a href="#local-6989586621679154784"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679154785"><a href="#local-6989586621679154785"><span class="hs-identifier">def</span></a></a><span> </span><a name="local-6989586621679154786"><a href="#local-6989586621679154786"><span class="hs-identifier">oldDecl</span></a></a><span> </span><a name="local-6989586621679154787"><a href="#local-6989586621679154787"><span class="hs-identifier">nsm</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Language.C.Analysis.DefTable.html#defRedeclStatus"><span class="hs-identifier hs-var">defRedeclStatus</span></a><span> </span><a href="#local-6989586621679154783"><span class="hs-identifier hs-var">sameKind</span></a><span> </span><a href="#local-6989586621679154785"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679154786"><span class="hs-identifier hs-var">oldDecl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-214"></a><span>        </span><a href="Language.C.Analysis.DefTable.html#NewDecl"><span class="hs-identifier hs-var">NewDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a><span> </span><a href="#local-6989586621679154787"><span class="hs-identifier hs-var">nsm</span></a><span> </span><a href="#local-6989586621679154784"><span class="hs-identifier hs-var">ident</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-215"></a><span>                     </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679154788"><a href="#local-6989586621679154788"><span class="hs-identifier">shadowed</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#Shadowed"><span class="hs-identifier hs-var">Shadowed</span></a><span> </span><a href="#local-6989586621679154788"><span class="hs-identifier hs-var">shadowed</span></a><span>
</span><a name="line-216"></a><span>                     </span><span class="hs-identifier hs-var">Nothing</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#NewDecl"><span class="hs-identifier hs-var">NewDecl</span></a><span>
</span><a name="line-217"></a><span>        </span><a name="local-6989586621679154789"><a href="#local-6989586621679154789"><span class="hs-identifier">redecl</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679154789"><span class="hs-identifier hs-var">redecl</span></a><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-identifier">defineTypeDef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#TypeDef"><span class="hs-identifier hs-type">TypeDef</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">)</span><span>
</span><a name="line-220"></a><a name="defineTypeDef"><a href="Language.C.Analysis.DefTable.html#defineTypeDef"><span class="hs-identifier">defineTypeDef</span></a></a><span> </span><a name="local-6989586621679154790"><a href="#local-6989586621679154790"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679154791"><a href="#local-6989586621679154791"><span class="hs-identifier">tydef</span></a></a><span> </span><a name="local-6989586621679154792"><a href="#local-6989586621679154792"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-221"></a><span>  </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#defRedeclStatus"><span class="hs-identifier hs-var">defRedeclStatus</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#compatIdentEntry"><span class="hs-identifier hs-var">compatIdentEntry</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679154791"><span class="hs-identifier hs-var">tydef</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154794"><span class="hs-identifier hs-var">oldDecl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679154792"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">identDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154793"><span class="hs-identifier hs-var">decls'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-223"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679154793"><a href="#local-6989586621679154793"><span class="hs-identifier">decls'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679154794"><a href="#local-6989586621679154794"><span class="hs-identifier">oldDecl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#defLocal"><span class="hs-identifier hs-var">defLocal</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">identDecls</span><span> </span><a href="#local-6989586621679154792"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154790"><span class="hs-identifier hs-var">ident</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679154791"><span class="hs-identifier hs-var">tydef</span></a><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-comment">-- | declare\/define a global object\/function\/typeDef</span><span>
</span><a name="line-226"></a><span class="hs-comment">--</span><span>
</span><a name="line-227"></a><span class="hs-comment">--  returns @Redeclared def@ if there is already an object\/function\/typeDef</span><span>
</span><a name="line-228"></a><span class="hs-comment">--  in global scope, or @DifferentKindRedec def@ if the old declaration is of a different kind.</span><span>
</span><a name="line-229"></a><span class="hs-identifier">defineGlobalIdent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#IdentDecl"><span class="hs-identifier hs-type">IdentDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">)</span><span>
</span><a name="line-230"></a><a name="defineGlobalIdent"><a href="Language.C.Analysis.DefTable.html#defineGlobalIdent"><span class="hs-identifier">defineGlobalIdent</span></a></a><span> </span><a name="local-6989586621679154795"><a href="#local-6989586621679154795"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679154796"><a href="#local-6989586621679154796"><span class="hs-identifier">def</span></a></a><span> </span><a name="local-6989586621679154797"><a href="#local-6989586621679154797"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#defRedeclStatus"><span class="hs-identifier hs-var">defRedeclStatus</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#compatIdentEntry"><span class="hs-identifier hs-var">compatIdentEntry</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679154796"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154799"><span class="hs-identifier hs-var">oldDecl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679154797"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">identDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154798"><span class="hs-identifier hs-var">decls'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-233"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679154798"><a href="#local-6989586621679154798"><span class="hs-identifier">decls'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154799"><a href="#local-6989586621679154799"><span class="hs-identifier">oldDecl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#defGlobal"><span class="hs-identifier hs-var">defGlobal</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">identDecls</span><span> </span><a href="#local-6989586621679154797"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154795"><span class="hs-identifier hs-var">ident</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679154796"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span>
</span><a name="line-234"></a><span class="hs-comment">-- | declare\/define a object\/function\/typeDef with lexical scope</span><span>
</span><a name="line-235"></a><span class="hs-comment">--</span><span>
</span><a name="line-236"></a><span class="hs-comment">--  returns @Redeclared def@ or @DifferentKindRedec def@  if there is already an object\/function\/typeDef</span><span>
</span><a name="line-237"></a><span class="hs-comment">--  in the same scope.</span><span>
</span><a name="line-238"></a><span class="hs-identifier">defineScopedIdent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#IdentDecl"><span class="hs-identifier hs-type">IdentDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">)</span><span>
</span><a name="line-239"></a><a name="defineScopedIdent"><a href="Language.C.Analysis.DefTable.html#defineScopedIdent"><span class="hs-identifier">defineScopedIdent</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#defineScopedIdentWhen"><span class="hs-identifier hs-var">defineScopedIdentWhen</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-comment">-- | declare\/define a object\/function\/typeDef with lexical scope, if the given predicate holds on the old</span><span>
</span><a name="line-242"></a><span class="hs-comment">--   entry.</span><span>
</span><a name="line-243"></a><span class="hs-comment">--</span><span>
</span><a name="line-244"></a><span class="hs-comment">--  returns @Keep old_def@ if the old definition shouldn't be overwritten, and otherwise @Redeclared def@ or</span><span>
</span><a name="line-245"></a><span class="hs-comment">--  @DifferentKindRedecl def@  if there is already an object\/function\/typeDef in the same scope.</span><span>
</span><a name="line-246"></a><span class="hs-identifier">defineScopedIdentWhen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#IdentDecl"><span class="hs-identifier hs-type">IdentDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#IdentDecl"><span class="hs-identifier hs-type">IdentDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-247"></a><span>                           </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">)</span><span>
</span><a name="line-248"></a><a name="defineScopedIdentWhen"><a href="Language.C.Analysis.DefTable.html#defineScopedIdentWhen"><span class="hs-identifier">defineScopedIdentWhen</span></a></a><span> </span><a name="local-6989586621679154800"><a href="#local-6989586621679154800"><span class="hs-identifier">override_def</span></a></a><span> </span><a name="local-6989586621679154801"><a href="#local-6989586621679154801"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679154802"><a href="#local-6989586621679154802"><span class="hs-identifier">def</span></a></a><span> </span><a name="local-6989586621679154803"><a href="#local-6989586621679154803"><span class="hs-identifier">deftbl</span></a></a><span>
</span><a name="line-249"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154808"><span class="hs-identifier hs-var">redecl_status</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679154803"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">identDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154807"><span class="hs-identifier hs-var">decls'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-251"></a><span>    </span><a name="local-6989586621679154804"><a href="#local-6989586621679154804"><span class="hs-identifier">new_def</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679154802"><span class="hs-identifier hs-var">def</span></a><span>
</span><a name="line-252"></a><span>    </span><a name="local-6989586621679154805"><a href="#local-6989586621679154805"><span class="hs-identifier">old_decls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">identDecls</span><span> </span><a href="#local-6989586621679154803"><span class="hs-identifier hs-var">deftbl</span></a><span>
</span><a name="line-253"></a><span>    </span><a name="local-6989586621679154806"><a href="#local-6989586621679154806"><span class="hs-identifier">old_decl_opt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#lookupInnermostScope"><span class="hs-identifier hs-var">lookupInnermostScope</span></a><span> </span><a href="#local-6989586621679154805"><span class="hs-identifier hs-var">old_decls</span></a><span> </span><a href="#local-6989586621679154801"><span class="hs-identifier hs-var">ident</span></a><span>
</span><a name="line-254"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679154807"><a href="#local-6989586621679154807"><span class="hs-identifier">decls'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154808"><a href="#local-6989586621679154808"><span class="hs-identifier">redecl_status</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679154812"><a href="#local-6989586621679154812"><span class="hs-identifier">old_decl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679154806"><span class="hs-identifier hs-var">old_decl_opt</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154812"><span class="hs-identifier hs-var">old_decl</span></a><span> </span><span class="hs-special">`</span><a href="Language.C.Analysis.DefTable.html#compatIdentEntry"><span class="hs-identifier hs-var">compatIdentEntry</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679154804"><span class="hs-identifier hs-var">new_def</span></a><span class="hs-special">)</span><span>
</span><a name="line-255"></a><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154809"><span class="hs-identifier hs-var">new_decls</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><a href="#local-6989586621679154812"><span class="hs-identifier hs-var">old_decl</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><a href="#local-6989586621679154810"><span class="hs-identifier hs-var">doOverride</span></a><span> </span><a href="#local-6989586621679154806"><span class="hs-identifier hs-var">old_decl_opt</span></a><span>
</span><a name="line-257"></a><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154809"><span class="hs-identifier hs-var">new_decls</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679154811"><span class="hs-identifier hs-var">redeclStatus'</span></a><span> </span><a href="#local-6989586621679154806"><span class="hs-identifier hs-var">old_decl_opt</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>                            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>
</span><a name="line-259"></a><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154805"><span class="hs-identifier hs-var">old_decls</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><a href="Language.C.Analysis.DefTable.html#NewDecl"><span class="hs-identifier hs-var">NewDecl</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#KeepDef"><span class="hs-identifier hs-var">KeepDef</span></a><span> </span><a href="#local-6989586621679154806"><span class="hs-identifier hs-var">old_decl_opt</span></a><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>    </span><a name="local-6989586621679154809"><a href="#local-6989586621679154809"><span class="hs-identifier">new_decls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.NameSpaceMap.html#defLocal"><span class="hs-identifier hs-var">defLocal</span></a><span> </span><a href="#local-6989586621679154805"><span class="hs-identifier hs-var">old_decls</span></a><span> </span><a href="#local-6989586621679154801"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679154804"><span class="hs-identifier hs-var">new_def</span></a><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>    </span><a name="local-6989586621679154810"><a href="#local-6989586621679154810"><span class="hs-identifier">doOverride</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-262"></a><span>    </span><span class="hs-identifier">doOverride</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679154813"><a href="#local-6989586621679154813"><span class="hs-identifier">old_def</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154800"><span class="hs-identifier hs-var">override_def</span></a><span> </span><a href="#local-6989586621679154813"><span class="hs-identifier hs-var">old_def</span></a><span>
</span><a name="line-263"></a><span>    </span><a name="local-6989586621679154811"><a href="#local-6989586621679154811"><span class="hs-identifier">redeclStatus'</span></a></a><span> </span><a name="local-6989586621679154814"><a href="#local-6989586621679154814"><span class="hs-identifier">overriden_decl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#defRedeclStatusLocal"><span class="hs-identifier hs-var">defRedeclStatusLocal</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#compatIdentEntry"><span class="hs-identifier hs-var">compatIdentEntry</span></a><span> </span><a href="#local-6989586621679154801"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679154804"><span class="hs-identifier hs-var">new_def</span></a><span> </span><a href="#local-6989586621679154814"><span class="hs-identifier hs-var">overriden_decl</span></a><span> </span><a href="#local-6989586621679154805"><span class="hs-identifier hs-var">old_decls</span></a><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span class="hs-comment">-- | declare a tag (fwd decl in case the struct name isn't defined yet)</span><span>
</span><a name="line-266"></a><span class="hs-identifier">declareTag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Ident.html#SUERef"><span class="hs-identifier hs-type">SUERef</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#TagFwdDecl"><span class="hs-identifier hs-type">TagFwdDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#TagEntry"><span class="hs-identifier hs-type">TagEntry</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">)</span><span>
</span><a name="line-267"></a><a name="declareTag"><a href="Language.C.Analysis.DefTable.html#declareTag"><span class="hs-identifier">declareTag</span></a></a><span> </span><a name="local-6989586621679154815"><a href="#local-6989586621679154815"><span class="hs-identifier">sueref</span></a></a><span> </span><a name="local-6989586621679154816"><a href="#local-6989586621679154816"><span class="hs-identifier">decl</span></a></a><span> </span><a name="local-6989586621679154817"><a href="#local-6989586621679154817"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-268"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="Language.C.Analysis.DefTable.html#lookupTag"><span class="hs-identifier hs-var">lookupTag</span></a><span> </span><a href="#local-6989586621679154815"><span class="hs-identifier hs-var">sueref</span></a><span> </span><a href="#local-6989586621679154817"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-269"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#NewDecl"><span class="hs-identifier hs-var">NewDecl</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679154817"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tagDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#defLocal"><span class="hs-identifier hs-var">defLocal</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tagDecls</span><span> </span><a href="#local-6989586621679154817"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154815"><span class="hs-identifier hs-var">sueref</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679154816"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679154818"><a href="#local-6989586621679154818"><span class="hs-identifier">old_def</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Language.C.Analysis.DefTable.html#tagKind"><span class="hs-identifier hs-var">tagKind</span></a><span> </span><a href="#local-6989586621679154818"><span class="hs-identifier hs-var">old_def</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Language.C.Analysis.DefTable.html#tagKind"><span class="hs-identifier hs-var">tagKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679154816"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#KeepDef"><span class="hs-identifier hs-var">KeepDef</span></a><span> </span><a href="#local-6989586621679154818"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679154817"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><a href="#local-6989586621679154818"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679154817"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span class="hs-comment">-- | define a tag</span><span>
</span><a name="line-274"></a><span class="hs-identifier">defineTag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Ident.html#SUERef"><span class="hs-identifier hs-type">SUERef</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#TagDef"><span class="hs-identifier hs-type">TagDef</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#TagEntry"><span class="hs-identifier hs-type">TagEntry</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">)</span><span>
</span><a name="line-275"></a><a name="defineTag"><a href="Language.C.Analysis.DefTable.html#defineTag"><span class="hs-identifier">defineTag</span></a></a><span> </span><a name="local-6989586621679154819"><a href="#local-6989586621679154819"><span class="hs-identifier">sueref</span></a></a><span> </span><a name="local-6989586621679154820"><a href="#local-6989586621679154820"><span class="hs-identifier">def</span></a></a><span> </span><a name="local-6989586621679154821"><a href="#local-6989586621679154821"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-276"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679154824"><span class="hs-identifier hs-var">redeclStatus</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679154821"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tagDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154822"><span class="hs-identifier hs-var">decls'</span></a><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-277"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-278"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679154822"><a href="#local-6989586621679154822"><span class="hs-identifier">decls'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154823"><a href="#local-6989586621679154823"><span class="hs-identifier">olddecl</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#defLocal"><span class="hs-identifier hs-var">defLocal</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tagDecls</span><span> </span><a href="#local-6989586621679154821"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154819"><span class="hs-identifier hs-var">sueref</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679154820"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>    </span><a name="local-6989586621679154824"><a href="#local-6989586621679154824"><span class="hs-identifier">redeclStatus</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-280"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679154823"><span class="hs-identifier hs-var">olddecl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-281"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679154825"><a href="#local-6989586621679154825"><span class="hs-identifier">fwd_decl</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Language.C.Analysis.DefTable.html#tagKind"><span class="hs-identifier hs-var">tagKind</span></a><span> </span><a href="#local-6989586621679154825"><span class="hs-identifier hs-var">fwd_decl</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Language.C.Analysis.DefTable.html#tagKind"><span class="hs-identifier hs-var">tagKind</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679154820"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#NewDecl"><span class="hs-identifier hs-var">NewDecl</span></a><span> </span><span class="hs-comment">-- should be NewDef</span><span>
</span><a name="line-282"></a><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><a href="#local-6989586621679154825"><span class="hs-identifier hs-var">fwd_decl</span></a><span>
</span><a name="line-283"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#defRedeclStatusLocal"><span class="hs-identifier hs-var">defRedeclStatusLocal</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#compatTagEntry"><span class="hs-identifier hs-var">compatTagEntry</span></a><span> </span><a href="#local-6989586621679154819"><span class="hs-identifier hs-var">sueref</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679154820"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154823"><span class="hs-identifier hs-var">olddecl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tagDecls</span><span> </span><a href="#local-6989586621679154821"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span class="hs-comment">-- | define a label</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- Return the old label if it is already defined in this function's scope</span><span>
</span><a name="line-287"></a><span class="hs-identifier">defineLabel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">)</span><span>
</span><a name="line-288"></a><a name="defineLabel"><a href="Language.C.Analysis.DefTable.html#defineLabel"><span class="hs-identifier">defineLabel</span></a></a><span> </span><a name="local-6989586621679154826"><a href="#local-6989586621679154826"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679154827"><a href="#local-6989586621679154827"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-289"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679154828"><a href="#local-6989586621679154828"><span class="hs-identifier">labels'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154829"><a href="#local-6989586621679154829"><span class="hs-identifier">old_label</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#defLocal"><span class="hs-identifier hs-var">defLocal</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">labelDefs</span><span> </span><a href="#local-6989586621679154827"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154826"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679154826"><span class="hs-identifier hs-var">ident</span></a><span>
</span><a name="line-290"></a><span>    </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maybe</span><span> </span><a href="Language.C.Analysis.DefTable.html#NewDecl"><span class="hs-identifier hs-var">NewDecl</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#Redeclared"><span class="hs-identifier hs-var">Redeclared</span></a><span> </span><a href="#local-6989586621679154829"><span class="hs-identifier hs-var">old_label</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679154827"><span class="hs-identifier hs-var">deftbl</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">labelDefs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154828"><span class="hs-identifier hs-var">labels'</span></a><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-comment">-- | lookup identifier (object, function, typeDef, enumerator)</span><span>
</span><a name="line-293"></a><span class="hs-identifier">lookupIdent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span>
</span><a name="line-294"></a><a name="lookupIdent"><a href="Language.C.Analysis.DefTable.html#lookupIdent"><span class="hs-identifier">lookupIdent</span></a></a><span> </span><a name="local-6989586621679154830"><a href="#local-6989586621679154830"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679154831"><a href="#local-6989586621679154831"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">identDecls</span><span> </span><a href="#local-6989586621679154831"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154830"><span class="hs-identifier hs-var">ident</span></a><span>
</span><a name="line-295"></a><span>
</span><a name="line-296"></a><span class="hs-comment">-- | lookup tag</span><span>
</span><a name="line-297"></a><span class="hs-identifier">lookupTag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Ident.html#SUERef"><span class="hs-identifier hs-type">SUERef</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.C.Analysis.DefTable.html#TagEntry"><span class="hs-identifier hs-type">TagEntry</span></a><span>
</span><a name="line-298"></a><a name="lookupTag"><a href="Language.C.Analysis.DefTable.html#lookupTag"><span class="hs-identifier">lookupTag</span></a></a><span> </span><a name="local-6989586621679154832"><a href="#local-6989586621679154832"><span class="hs-identifier">sue_ref</span></a></a><span> </span><a name="local-6989586621679154833"><a href="#local-6989586621679154833"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tagDecls</span><span> </span><a href="#local-6989586621679154833"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154832"><span class="hs-identifier hs-var">sue_ref</span></a><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span class="hs-comment">-- | lookup label</span><span>
</span><a name="line-301"></a><span class="hs-identifier">lookupLabel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span>
</span><a name="line-302"></a><a name="lookupLabel"><a href="Language.C.Analysis.DefTable.html#lookupLabel"><span class="hs-identifier">lookupLabel</span></a></a><span> </span><a name="local-6989586621679154834"><a href="#local-6989586621679154834"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679154835"><a href="#local-6989586621679154835"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">labelDefs</span><span> </span><a href="#local-6989586621679154835"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154834"><span class="hs-identifier hs-var">ident</span></a><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">-- | lookup an object in the innermost scope</span><span>
</span><a name="line-305"></a><span class="hs-identifier">lookupIdentInner</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span>
</span><a name="line-306"></a><a name="lookupIdentInner"><a href="Language.C.Analysis.DefTable.html#lookupIdentInner"><span class="hs-identifier">lookupIdentInner</span></a></a><span> </span><a name="local-6989586621679154836"><a href="#local-6989586621679154836"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679154837"><a href="#local-6989586621679154837"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#lookupInnermostScope"><span class="hs-identifier hs-var">lookupInnermostScope</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">identDecls</span><span> </span><a href="#local-6989586621679154837"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154836"><span class="hs-identifier hs-var">ident</span></a><span>
</span><a name="line-307"></a><span>
</span><a name="line-308"></a><span class="hs-comment">-- | lookup an identifier in the innermost scope</span><span>
</span><a name="line-309"></a><span class="hs-identifier">lookupTagInner</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Ident.html#SUERef"><span class="hs-identifier hs-type">SUERef</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.C.Analysis.DefTable.html#TagEntry"><span class="hs-identifier hs-type">TagEntry</span></a><span>
</span><a name="line-310"></a><a name="lookupTagInner"><a href="Language.C.Analysis.DefTable.html#lookupTagInner"><span class="hs-identifier">lookupTagInner</span></a></a><span> </span><a name="local-6989586621679154838"><a href="#local-6989586621679154838"><span class="hs-identifier">sue_ref</span></a></a><span> </span><a name="local-6989586621679154839"><a href="#local-6989586621679154839"><span class="hs-identifier">deftbl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.NameSpaceMap.html#lookupInnermostScope"><span class="hs-identifier hs-var">lookupInnermostScope</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">tagDecls</span><span> </span><a href="#local-6989586621679154839"><span class="hs-identifier hs-var">deftbl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154838"><span class="hs-identifier hs-var">sue_ref</span></a><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span class="hs-comment">-- | Record the type of a node.</span><span>
</span><a name="line-313"></a><span class="hs-identifier">insertType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Data.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span>
</span><a name="line-314"></a><a name="insertType"><a href="Language.C.Analysis.DefTable.html#insertType"><span class="hs-identifier">insertType</span></a></a><span> </span><a name="local-6989586621679154840"><a href="#local-6989586621679154840"><span class="hs-identifier">dt</span></a></a><span> </span><a name="local-6989586621679154841"><a href="#local-6989586621679154841"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679154842"><a href="#local-6989586621679154842"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154840"><span class="hs-identifier hs-var">dt</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">typeTable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IntMap.insert</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nameId</span><span> </span><a href="#local-6989586621679154841"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154842"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">typeTable</span><span> </span><a href="#local-6989586621679154840"><span class="hs-identifier hs-var">dt</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-315"></a><span>
</span><a name="line-316"></a><span class="hs-comment">-- | Lookup the type of a node.</span><span>
</span><a name="line-317"></a><span class="hs-identifier">lookupType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Data.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.C.Analysis.SemRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-318"></a><a name="lookupType"><a href="Language.C.Analysis.DefTable.html#lookupType"><span class="hs-identifier">lookupType</span></a></a><span> </span><a name="local-6989586621679154843"><a href="#local-6989586621679154843"><span class="hs-identifier">dt</span></a></a><span> </span><a name="local-6989586621679154844"><a href="#local-6989586621679154844"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IntMap.lookup</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nameId</span><span> </span><a href="#local-6989586621679154844"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">typeTable</span><span> </span><a href="#local-6989586621679154843"><span class="hs-identifier hs-var">dt</span></a><span class="hs-special">)</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-comment">-- | Merge two DefTables. If both tables contain an entry for a given</span><span>
</span><a name="line-321"></a><span class="hs-comment">--   key, they must agree on its value.</span><span>
</span><a name="line-322"></a><span class="hs-identifier">mergeDefTable</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span>
</span><a name="line-323"></a><a name="mergeDefTable"><a href="Language.C.Analysis.DefTable.html#mergeDefTable"><span class="hs-identifier">mergeDefTable</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-var">DefTable</span></a><span> </span><a name="local-6989586621679154845"><a href="#local-6989586621679154845"><span class="hs-identifier">i1</span></a></a><span> </span><a name="local-6989586621679154846"><a href="#local-6989586621679154846"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679154847"><a href="#local-6989586621679154847"><span class="hs-identifier">l1</span></a></a><span> </span><a name="local-6989586621679154848"><a href="#local-6989586621679154848"><span class="hs-identifier">m1</span></a></a><span> </span><a name="local-6989586621679154849"><a href="#local-6989586621679154849"><span class="hs-identifier">r1</span></a></a><span> </span><a name="local-6989586621679154850"><a href="#local-6989586621679154850"><span class="hs-identifier">tt1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-var">DefTable</span></a><span> </span><a name="local-6989586621679154851"><a href="#local-6989586621679154851"><span class="hs-identifier">i2</span></a></a><span> </span><a name="local-6989586621679154852"><a href="#local-6989586621679154852"><span class="hs-identifier">t2</span></a></a><span> </span><a name="local-6989586621679154853"><a href="#local-6989586621679154853"><span class="hs-identifier">l2</span></a></a><span> </span><a name="local-6989586621679154854"><a href="#local-6989586621679154854"><span class="hs-identifier">m2</span></a></a><span> </span><a name="local-6989586621679154855"><a href="#local-6989586621679154855"><span class="hs-identifier">r2</span></a></a><span> </span><a name="local-6989586621679154856"><a href="#local-6989586621679154856"><span class="hs-identifier">tt2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-324"></a><span>  </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-var">DefTable</span></a><span>
</span><a name="line-325"></a><span>  </span><span class="hs-special">(</span><a href="Language.C.Analysis.NameSpaceMap.html#mergeNameSpace"><span class="hs-identifier hs-var">mergeNameSpace</span></a><span> </span><a href="#local-6989586621679154845"><span class="hs-identifier hs-var">i1</span></a><span> </span><a href="#local-6989586621679154851"><span class="hs-identifier hs-var">i2</span></a><span class="hs-special">)</span><span>
</span><a name="line-326"></a><span>  </span><span class="hs-special">(</span><a href="Language.C.Analysis.NameSpaceMap.html#mergeNameSpace"><span class="hs-identifier hs-var">mergeNameSpace</span></a><span> </span><a href="#local-6989586621679154846"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679154852"><span class="hs-identifier hs-var">t2</span></a><span class="hs-special">)</span><span>
</span><a name="line-327"></a><span>  </span><span class="hs-special">(</span><a href="Language.C.Analysis.NameSpaceMap.html#mergeNameSpace"><span class="hs-identifier hs-var">mergeNameSpace</span></a><span> </span><a href="#local-6989586621679154847"><span class="hs-identifier hs-var">l1</span></a><span> </span><a href="#local-6989586621679154853"><span class="hs-identifier hs-var">l2</span></a><span class="hs-special">)</span><span>
</span><a name="line-328"></a><span>  </span><span class="hs-special">(</span><a href="Language.C.Analysis.NameSpaceMap.html#mergeNameSpace"><span class="hs-identifier hs-var">mergeNameSpace</span></a><span> </span><a href="#local-6989586621679154848"><span class="hs-identifier hs-var">m1</span></a><span> </span><a href="#local-6989586621679154854"><span class="hs-identifier hs-var">m2</span></a><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">union</span><span> </span><a href="#local-6989586621679154849"><span class="hs-identifier hs-var">r1</span></a><span> </span><a href="#local-6989586621679154855"><span class="hs-identifier hs-var">r2</span></a><span class="hs-special">)</span><span>
</span><a name="line-330"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">union</span><span> </span><a href="#local-6989586621679154850"><span class="hs-identifier hs-var">tt1</span></a><span> </span><a href="#local-6989586621679154856"><span class="hs-identifier hs-var">tt2</span></a><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a></pre></body></html>