<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses, TypeSynonymInstances, FlexibleContexts,FlexibleInstances,
             PatternGuards, RankNTypes, ScopedTypeVariables #-}</span><span>
</span><a name="line-3"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Module      :  Language.C.Analysis.TravMonad</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- Copyright   :  (c) 2008 Benedikt Huber</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- License     :  BSD-style</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Maintainer  :  benedikt.huber@gmail.com</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Stability   :  alpha</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Portability :  ghc</span><span>
</span><a name="line-11"></a><span class="hs-comment">--</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Monad for Traversals of the C AST.</span><span>
</span><a name="line-13"></a><span class="hs-comment">--</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- For the traversal, we maintain a symboltable and need MonadError and unique</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- name generation facilities.</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- Furthermore, the user may provide callbacks to handle declarations and definitions.</span><span>
</span><a name="line-17"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-18"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.C.Analysis.TravMonad</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-19"></a><span>    </span><span class="hs-comment">-- * Name generation monad</span><span>
</span><a name="line-20"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#MonadName"><span class="hs-identifier hs-type">MonadName</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>    </span><span class="hs-comment">-- * Symbol table monad</span><span>
</span><a name="line-22"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>    </span><span class="hs-comment">-- * Specialized C error-handling monad</span><span>
</span><a name="line-24"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>    </span><span class="hs-comment">-- * AST traversal monad</span><span>
</span><a name="line-26"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#MonadTrav"><span class="hs-identifier hs-type">MonadTrav</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>    </span><span class="hs-comment">-- * Handling declarations</span><span>
</span><a name="line-28"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#handleTagDecl"><span class="hs-identifier hs-var">handleTagDecl</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#handleTagDef"><span class="hs-identifier hs-var">handleTagDef</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#handleEnumeratorDef"><span class="hs-identifier hs-var">handleEnumeratorDef</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#handleTypeDef"><span class="hs-identifier hs-var">handleTypeDef</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#handleObjectDef"><span class="hs-identifier hs-var">handleObjectDef</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#handleFunDef"><span class="hs-identifier hs-var">handleFunDef</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#handleVarDecl"><span class="hs-identifier hs-var">handleVarDecl</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#handleParamDecl"><span class="hs-identifier hs-var">handleParamDecl</span></a><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#handleAsmBlock"><span class="hs-identifier hs-var">handleAsmBlock</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>    </span><span class="hs-comment">-- * Symbol table scope modification</span><span>
</span><a name="line-32"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#enterPrototypeScope"><span class="hs-identifier hs-var">enterPrototypeScope</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#leavePrototypeScope"><span class="hs-identifier hs-var">leavePrototypeScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#enterFunctionScope"><span class="hs-identifier hs-var">enterFunctionScope</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#leaveFunctionScope"><span class="hs-identifier hs-var">leaveFunctionScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#enterBlockScope"><span class="hs-identifier hs-var">enterBlockScope</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#leaveBlockScope"><span class="hs-identifier hs-var">leaveBlockScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>    </span><span class="hs-comment">-- * Symbol table lookup (delegate)</span><span>
</span><a name="line-36"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#lookupTypeDef"><span class="hs-identifier hs-var">lookupTypeDef</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#lookupObject"><span class="hs-identifier hs-var">lookupObject</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>    </span><span class="hs-comment">-- * Symbol table modification</span><span>
</span><a name="line-38"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#createSUERef"><span class="hs-identifier hs-var">createSUERef</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>    </span><span class="hs-comment">-- * Additional error handling facilities</span><span>
</span><a name="line-40"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#hadHardErrors"><span class="hs-identifier hs-var">hadHardErrors</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#handleTravError"><span class="hs-identifier hs-var">handleTravError</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#throwOnLeft"><span class="hs-identifier hs-var">throwOnLeft</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#astError"><span class="hs-identifier hs-var">astError</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#warn"><span class="hs-identifier hs-var">warn</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>    </span><span class="hs-comment">-- * Trav - default MonadTrav implementation</span><span>
</span><a name="line-43"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#runTrav"><span class="hs-identifier hs-var">runTrav</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#runTrav_"><span class="hs-identifier hs-var">runTrav_</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-type">TravState</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#initTravState"><span class="hs-identifier hs-var">initTravState</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#withExtDeclHandler"><span class="hs-identifier hs-var">withExtDeclHandler</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#modifyUserState"><span class="hs-identifier hs-var">modifyUserState</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#userState"><span class="hs-identifier hs-var">userState</span></a><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#getUserState"><span class="hs-identifier hs-var">getUserState</span></a><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#TravOptions"><span class="hs-identifier hs-type">TravOptions</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#modifyOptions"><span class="hs-identifier hs-var">modifyOptions</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#travErrors"><span class="hs-identifier hs-var">travErrors</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>    </span><span class="hs-comment">-- * Language options</span><span>
</span><a name="line-50"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#CLanguage"><span class="hs-identifier hs-type">CLanguage</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-comment">-- * Helpers</span><span>
</span><a name="line-52"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#maybeM"><span class="hs-identifier hs-var">maybeM</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#mapSndM"><span class="hs-identifier hs-var">mapSndM</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.TravMonad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span class="hs-keyword">where</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><a href="Language.C.Data.html"><span class="hs-identifier">Language.C.Data</span></a><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><a href="Language.C.Data.RList.html"><span class="hs-identifier">Language.C.Data.RList</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">RList</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><a href="Language.C.Analysis.Builtins.html"><span class="hs-identifier">Language.C.Analysis.Builtins</span></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><a href="Language.C.Analysis.SemError.html"><span class="hs-identifier">Language.C.Analysis.SemError</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="Language.C.Analysis.SemRep.html"><span class="hs-identifier">Language.C.Analysis.SemRep</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><a href="Language.C.Analysis.TypeUtils.html"><span class="hs-identifier">Language.C.Analysis.TypeUtils</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TypeUtils.html#sameType"><span class="hs-identifier hs-var">sameType</span></a><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="Language.C.Analysis.DefTable.html"><span class="hs-identifier">Language.C.Analysis.DefTable</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#enterBlockScope"><span class="hs-identifier hs-var">enterBlockScope</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#leaveBlockScope"><span class="hs-identifier hs-var">leaveBlockScope</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>                                            </span><a href="Language.C.Analysis.DefTable.html#enterFunctionScope"><span class="hs-identifier hs-var">enterFunctionScope</span></a><span class="hs-special">,</span><a href="Language.C.Analysis.DefTable.html#leaveFunctionScope"><span class="hs-identifier hs-var">leaveFunctionScope</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Language.C.Analysis.DefTable.html"><span class="hs-identifier">Language.C.Analysis.DefTable</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">ST</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.IntMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">insert</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Applicative</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ap</span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679158147"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="MonadName"><a href="Language.C.Analysis.TravMonad.html#MonadName"><span class="hs-identifier">MonadName</span></a></a><span> </span><a name="local-6989586621679158147"><a href="#local-6989586621679158147"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-comment">-- | unique name generation</span><span>
</span><a name="line-74"></a><span>    </span><a name="genName"><a href="Language.C.Analysis.TravMonad.html#genName"><span class="hs-identifier">genName</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679158147"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.C.Data.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679158145"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="MonadSymtab"><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier">MonadSymtab</span></a></a><span> </span><a name="local-6989586621679158145"><a href="#local-6989586621679158145"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-comment">-- symbol table handling</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-comment">-- | return the definition table</span><span>
</span><a name="line-79"></a><span>    </span><a name="getDefTable"><a href="Language.C.Analysis.TravMonad.html#getDefTable"><span class="hs-identifier">getDefTable</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679158145"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span>
</span><a name="line-80"></a><span>    </span><span class="hs-comment">-- | perform an action modifying the definition table</span><span>
</span><a name="line-81"></a><span>    </span><a name="withDefTable"><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier">withDefTable</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158146"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158145"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679158146"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679158140"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="MonadCError"><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier">MonadCError</span></a></a><span> </span><a name="local-6989586621679158140"><a href="#local-6989586621679158140"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-84"></a><span>    </span><span class="hs-comment">-- error handling facilities</span><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span>    </span><span class="hs-comment">-- | throw an 'Error'</span><span>
</span><a name="line-87"></a><span>    </span><a name="throwTravError"><a href="Language.C.Analysis.TravMonad.html#throwTravError"><span class="hs-identifier">throwTravError</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a><span> </span><a href="#local-6989586621679158141"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679158141"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158140"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679158142"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-88"></a><span>    </span><span class="hs-comment">-- | catch an 'Error' (we could implement dynamically-typed catch here)</span><span>
</span><a name="line-89"></a><span>    </span><a name="catchTravError"><a href="Language.C.Analysis.TravMonad.html#catchTravError"><span class="hs-identifier">catchTravError</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679158140"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679158143"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Error.html#CError"><span class="hs-identifier hs-type">CError</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158140"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679158143"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158140"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679158143"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-90"></a><span>    </span><span class="hs-comment">-- | remember that an 'Error' occurred (without throwing it)</span><span>
</span><a name="line-91"></a><span>    </span><a name="recordError"><a href="Language.C.Analysis.TravMonad.html#recordError"><span class="hs-identifier">recordError</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a><span> </span><a href="#local-6989586621679158144"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679158144"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158140"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-comment">-- | return the list of recorded errors</span><span>
</span><a name="line-93"></a><span>    </span><a name="getErrors"><a href="Language.C.Analysis.TravMonad.html#getErrors"><span class="hs-identifier">getErrors</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679158140"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="Language.C.Data.Error.html#CError"><span class="hs-identifier hs-type">CError</span></a><span class="hs-special">]</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | Traversal monad</span><span>
</span><a name="line-96"></a><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadName"><span class="hs-identifier hs-type">MonadName</span></a><span> </span><a href="#local-6989586621679158139"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158139"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158139"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="MonadTrav"><a href="Language.C.Analysis.TravMonad.html#MonadTrav"><span class="hs-identifier">MonadTrav</span></a></a><span> </span><a name="local-6989586621679158139"><a href="#local-6989586621679158139"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-comment">-- | handling declarations and definitions</span><span>
</span><a name="line-98"></a><span>    </span><a name="handleDecl"><a href="Language.C.Analysis.TravMonad.html#handleDecl"><span class="hs-identifier">handleDecl</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.SemRep.html#DeclEvent"><span class="hs-identifier hs-type">DeclEvent</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158139"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-comment">-- * handling declarations</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-comment">-- check wheter a redefinition is ok</span><span>
</span><a name="line-103"></a><span class="hs-identifier">checkRedef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158241"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Data.Node.html#CNode"><span class="hs-identifier hs-type">CNode</span></a><span> </span><a href="#local-6989586621679158242"><span class="hs-identifier hs-type">t</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Data.Node.html#CNode"><span class="hs-identifier hs-type">CNode</span></a><span> </span><a href="#local-6989586621679158243"><span class="hs-identifier hs-type">t1</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158242"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="#local-6989586621679158243"><span class="hs-identifier hs-type">t1</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158241"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-104"></a><a name="checkRedef"><a href="Language.C.Analysis.TravMonad.html#checkRedef"><span class="hs-identifier">checkRedef</span></a></a><span> </span><a name="local-6989586621679158244"><a href="#local-6989586621679158244"><span class="hs-identifier">subject</span></a></a><span> </span><a name="local-6989586621679158245"><a href="#local-6989586621679158245"><span class="hs-identifier">new_decl</span></a></a><span> </span><a name="local-6989586621679158246"><a href="#local-6989586621679158246"><span class="hs-identifier">redecl_status</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679158246"><span class="hs-identifier hs-var">redecl_status</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-106"></a><span>        </span><a href="Language.C.Analysis.DefTable.html#NewDecl"><span class="hs-identifier hs-var">NewDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>        </span><a href="Language.C.Analysis.DefTable.html#Redeclared"><span class="hs-identifier hs-var">Redeclared</span></a><span> </span><a name="local-6989586621679158247"><a href="#local-6989586621679158247"><span class="hs-identifier">old_def</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#throwTravError"><span class="hs-identifier hs-var">throwTravError</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-108"></a><span>            </span><a href="Language.C.Analysis.SemError.html#redefinition"><span class="hs-identifier hs-var">redefinition</span></a><span> </span><a href="Language.C.Data.Error.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a><span> </span><a href="#local-6989586621679158244"><span class="hs-identifier hs-var">subject</span></a><span> </span><a href="Language.C.Analysis.SemError.html#DuplicateDef"><span class="hs-identifier hs-var">DuplicateDef</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679158245"><span class="hs-identifier hs-var">new_decl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679158247"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>        </span><a href="Language.C.Analysis.DefTable.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><a name="local-6989586621679158248"><a href="#local-6989586621679158248"><span class="hs-identifier">old_def</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#throwTravError"><span class="hs-identifier hs-var">throwTravError</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-110"></a><span>            </span><a href="Language.C.Analysis.SemError.html#redefinition"><span class="hs-identifier hs-var">redefinition</span></a><span> </span><a href="Language.C.Data.Error.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a><span> </span><a href="#local-6989586621679158244"><span class="hs-identifier hs-var">subject</span></a><span> </span><a href="Language.C.Analysis.SemError.html#DiffKindRedecl"><span class="hs-identifier hs-var">DiffKindRedecl</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679158245"><span class="hs-identifier hs-var">new_decl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679158248"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>        </span><a href="Language.C.Analysis.DefTable.html#Shadowed"><span class="hs-identifier hs-var">Shadowed</span></a><span> </span><a name="local-6989586621679158249"><a href="#local-6989586621679158249"><span class="hs-identifier">_old_def</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span>            </span><span class="hs-comment">-- warn $</span><span>
</span><a name="line-113"></a><span>            </span><span class="hs-comment">-- redefinition LevelWarn subject ShadowedDef (nodeInfo new_decl) (nodeInfo old_def)</span><span>
</span><a name="line-114"></a><span>        </span><a href="Language.C.Analysis.DefTable.html#KeepDef"><span class="hs-identifier hs-var">KeepDef</span></a><span> </span><a name="local-6989586621679158250"><a href="#local-6989586621679158250"><span class="hs-identifier">_old_def</span></a></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-comment">-- | forward declaration of a tag. Only necessary for name analysis, but otherwise no semantic</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- consequences.</span><span>
</span><a name="line-118"></a><span class="hs-identifier">handleTagDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158240"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158240"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#TagFwdDecl"><span class="hs-identifier hs-type">TagFwdDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158240"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-119"></a><a name="handleTagDecl"><a href="Language.C.Analysis.TravMonad.html#handleTagDecl"><span class="hs-identifier">handleTagDecl</span></a></a><span> </span><a name="local-6989586621679158251"><a href="#local-6989586621679158251"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-120"></a><span>    </span><a name="local-6989586621679158252"><a href="#local-6989586621679158252"><span class="hs-identifier">redecl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier hs-var">withDefTable</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.DefTable.html#declareTag"><span class="hs-identifier hs-var">declareTag</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#sueRef"><span class="hs-identifier hs-var">sueRef</span></a><span> </span><a href="#local-6989586621679158251"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158251"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-121"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#checkRedef"><span class="hs-identifier hs-var">checkRedef</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Ident.html#sueRefToString"><span class="hs-identifier hs-var">sueRefToString</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.SemRep.html#sueRef"><span class="hs-identifier hs-var">sueRef</span></a><span> </span><a href="#local-6989586621679158251"><span class="hs-identifier hs-var">decl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158251"><span class="hs-identifier hs-var">decl</span></a><span> </span><a href="#local-6989586621679158252"><span class="hs-identifier hs-var">redecl</span></a><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-comment">-- | define the given composite type or enumeration</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- If there is a declaration visible, overwrite it with the definition.</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- Otherwise, enter a new definition in the current namespace.</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- If there is already a definition present, yield an error (redeclaration).</span><span>
</span><a name="line-127"></a><span class="hs-identifier">handleTagDef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadTrav"><span class="hs-identifier hs-type">MonadTrav</span></a><span> </span><a href="#local-6989586621679158239"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#TagDef"><span class="hs-identifier hs-type">TagDef</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158239"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-128"></a><a name="handleTagDef"><a href="Language.C.Analysis.TravMonad.html#handleTagDef"><span class="hs-identifier">handleTagDef</span></a></a><span> </span><a name="local-6989586621679158253"><a href="#local-6989586621679158253"><span class="hs-identifier">def</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-129"></a><span>    </span><a name="local-6989586621679158254"><a href="#local-6989586621679158254"><span class="hs-identifier">redecl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier hs-var">withDefTable</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.DefTable.html#defineTag"><span class="hs-identifier hs-var">defineTag</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#sueRef"><span class="hs-identifier hs-var">sueRef</span></a><span> </span><a href="#local-6989586621679158253"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158253"><span class="hs-identifier hs-var">def</span></a><span>
</span><a name="line-130"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#checkRedef"><span class="hs-identifier hs-var">checkRedef</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Ident.html#sueRefToString"><span class="hs-identifier hs-var">sueRefToString</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.SemRep.html#sueRef"><span class="hs-identifier hs-var">sueRef</span></a><span> </span><a href="#local-6989586621679158253"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158253"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679158254"><span class="hs-identifier hs-var">redecl</span></a><span>
</span><a name="line-131"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#handleDecl"><span class="hs-identifier hs-var">handleDecl</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#TagEvent"><span class="hs-identifier hs-var">TagEvent</span></a><span> </span><a href="#local-6989586621679158253"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-identifier">handleEnumeratorDef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158238"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158238"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#Enumerator"><span class="hs-identifier hs-type">Enumerator</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="#local-6989586621679158238"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-134"></a><a name="handleEnumeratorDef"><a href="Language.C.Analysis.TravMonad.html#handleEnumeratorDef"><span class="hs-identifier">handleEnumeratorDef</span></a></a><span> </span><a name="local-6989586621679158255"><a href="#local-6989586621679158255"><span class="hs-identifier">enumerator</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-135"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679158256"><a href="#local-6989586621679158256"><span class="hs-identifier">ident</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.SemRep.html#declIdent"><span class="hs-identifier hs-var">declIdent</span></a><span> </span><a href="#local-6989586621679158255"><span class="hs-identifier hs-var">enumerator</span></a><span>
</span><a name="line-136"></a><span>    </span><a name="local-6989586621679158257"><a href="#local-6989586621679158257"><span class="hs-identifier">redecl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier hs-var">withDefTable</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.DefTable.html#defineScopedIdent"><span class="hs-identifier hs-var">defineScopedIdent</span></a><span> </span><a href="#local-6989586621679158256"><span class="hs-identifier hs-var">ident</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#EnumeratorDef"><span class="hs-identifier hs-var">EnumeratorDef</span></a><span> </span><a href="#local-6989586621679158255"><span class="hs-identifier hs-var">enumerator</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#checkRedef"><span class="hs-identifier hs-var">checkRedef</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Ident.html#identToString"><span class="hs-identifier hs-var">identToString</span></a><span> </span><a href="#local-6989586621679158256"><span class="hs-identifier hs-var">ident</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158256"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679158257"><span class="hs-identifier hs-var">redecl</span></a><span>
</span><a name="line-138"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-identifier">handleTypeDef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadTrav"><span class="hs-identifier hs-type">MonadTrav</span></a><span> </span><a href="#local-6989586621679158237"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#TypeDef"><span class="hs-identifier hs-type">TypeDef</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158237"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-141"></a><a name="handleTypeDef"><a href="Language.C.Analysis.TravMonad.html#handleTypeDef"><span class="hs-identifier">handleTypeDef</span></a></a><span> </span><a name="local-6989586621679158258"><a href="#local-6989586621679158258"><span class="hs-identifier">typeDef</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#TypeDef"><span class="hs-identifier hs-var">TypeDef</span></a><span> </span><a name="local-6989586621679158259"><a href="#local-6989586621679158259"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679158260"><a href="#local-6989586621679158260"><span class="hs-identifier">t1</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-142"></a><span>    </span><a name="local-6989586621679158261"><a href="#local-6989586621679158261"><span class="hs-identifier">redecl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier hs-var">withDefTable</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.DefTable.html#defineTypeDef"><span class="hs-identifier hs-var">defineTypeDef</span></a><span> </span><a href="#local-6989586621679158259"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679158258"><span class="hs-identifier hs-var">typeDef</span></a><span>
</span><a name="line-143"></a><span>    </span><span class="hs-comment">-- C11 6.7/3 If an identifier has no linkage, there shall be no more than</span><span>
</span><a name="line-144"></a><span>    </span><span class="hs-comment">-- one declaration of the identifier (in a declarator or type specifier)</span><span>
</span><a name="line-145"></a><span>    </span><span class="hs-comment">-- with the same scope and in the same name space, except that: a typedef</span><span>
</span><a name="line-146"></a><span>    </span><span class="hs-comment">-- name may be redefined to denote the same type as it currently does,</span><span>
</span><a name="line-147"></a><span>    </span><span class="hs-comment">-- provided that type is not a variably modified type;</span><span>
</span><a name="line-148"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679158261"><span class="hs-identifier hs-var">redecl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-149"></a><span>      </span><a href="Language.C.Analysis.DefTable.html#Redeclared"><span class="hs-identifier hs-var">Redeclared</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#TypeDef"><span class="hs-identifier hs-var">TypeDef</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679158262"><a href="#local-6989586621679158262"><span class="hs-identifier">t2</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Language.C.Analysis.TypeUtils.html#sameType"><span class="hs-identifier hs-var">sameType</span></a><span> </span><a href="#local-6989586621679158260"><span class="hs-identifier hs-var">t1</span></a><span> </span><a href="#local-6989586621679158262"><span class="hs-identifier hs-var">t2</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#checkRedef"><span class="hs-identifier hs-var">checkRedef</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Ident.html#identToString"><span class="hs-identifier hs-var">identToString</span></a><span> </span><a href="#local-6989586621679158259"><span class="hs-identifier hs-var">ident</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158258"><span class="hs-identifier hs-var">typeDef</span></a><span> </span><a href="#local-6989586621679158261"><span class="hs-identifier hs-var">redecl</span></a><span>
</span><a name="line-151"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#handleDecl"><span class="hs-identifier hs-var">handleDecl</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#TypeDefEvent"><span class="hs-identifier hs-var">TypeDefEvent</span></a><span> </span><a href="#local-6989586621679158258"><span class="hs-identifier hs-var">typeDef</span></a><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-identifier">handleAsmBlock</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadTrav"><span class="hs-identifier hs-type">MonadTrav</span></a><span> </span><a href="#local-6989586621679158236"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#AsmBlock"><span class="hs-identifier hs-type">AsmBlock</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158236"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-155"></a><a name="handleAsmBlock"><a href="Language.C.Analysis.TravMonad.html#handleAsmBlock"><span class="hs-identifier">handleAsmBlock</span></a></a><span> </span><a name="local-6989586621679158263"><a href="#local-6989586621679158263"><span class="hs-identifier">asm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#handleDecl"><span class="hs-identifier hs-var">handleDecl</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#AsmEvent"><span class="hs-identifier hs-var">AsmEvent</span></a><span> </span><a href="#local-6989586621679158263"><span class="hs-identifier hs-var">asm</span></a><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-identifier">redefErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158233"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Data.Node.html#CNode"><span class="hs-identifier hs-type">CNode</span></a><span> </span><a href="#local-6989586621679158234"><span class="hs-identifier hs-type">old</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Data.Node.html#CNode"><span class="hs-identifier hs-type">CNode</span></a><span> </span><a href="#local-6989586621679158235"><span class="hs-identifier hs-type">new</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-158"></a><span>            </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Data.Error.html#ErrorLevel"><span class="hs-identifier hs-type">ErrorLevel</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158235"><span class="hs-identifier hs-type">new</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158234"><span class="hs-identifier hs-type">old</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemError.html#RedefKind"><span class="hs-identifier hs-type">RedefKind</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158233"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-159"></a><a name="redefErr"><a href="Language.C.Analysis.TravMonad.html#redefErr"><span class="hs-identifier">redefErr</span></a></a><span> </span><a name="local-6989586621679158264"><a href="#local-6989586621679158264"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679158265"><a href="#local-6989586621679158265"><span class="hs-identifier">lvl</span></a></a><span> </span><a name="local-6989586621679158266"><a href="#local-6989586621679158266"><span class="hs-identifier">new</span></a></a><span> </span><a name="local-6989586621679158267"><a href="#local-6989586621679158267"><span class="hs-identifier">old</span></a></a><span> </span><a name="local-6989586621679158268"><a href="#local-6989586621679158268"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-160"></a><span>  </span><a href="Language.C.Analysis.TravMonad.html#throwTravError"><span class="hs-identifier hs-var">throwTravError</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.SemError.html#redefinition"><span class="hs-identifier hs-var">redefinition</span></a><span> </span><a href="#local-6989586621679158265"><span class="hs-identifier hs-var">lvl</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Ident.html#identToString"><span class="hs-identifier hs-var">identToString</span></a><span> </span><a href="#local-6989586621679158264"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158268"><span class="hs-identifier hs-var">kind</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679158266"><span class="hs-identifier hs-var">new</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679158267"><span class="hs-identifier hs-var">old</span></a><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span>
</span><a name="line-162"></a><span class="hs-comment">-- TODO: unused</span><span>
</span><a name="line-163"></a><span class="hs-identifier">_checkIdentTyRedef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158232"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158232"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-164"></a><a name="_checkIdentTyRedef"><a href="Language.C.Analysis.TravMonad.html#_checkIdentTyRedef"><span class="hs-identifier">_checkIdentTyRedef</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679158269"><a href="#local-6989586621679158269"><span class="hs-identifier">decl</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679158270"><a href="#local-6989586621679158270"><span class="hs-identifier">status</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#checkVarRedef"><span class="hs-identifier hs-var">checkVarRedef</span></a><span> </span><a href="#local-6989586621679158269"><span class="hs-identifier hs-var">decl</span></a><span> </span><a href="#local-6989586621679158270"><span class="hs-identifier hs-var">status</span></a><span>
</span><a name="line-165"></a><span class="hs-identifier">_checkIdentTyRedef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679158271"><a href="#local-6989586621679158271"><span class="hs-identifier">tydef</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><a name="local-6989586621679158272"><a href="#local-6989586621679158272"><span class="hs-identifier">old_def</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-166"></a><span>  </span><a href="Language.C.Analysis.TravMonad.html#redefErr"><span class="hs-identifier hs-var">redefErr</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#identOfTypeDef"><span class="hs-identifier hs-var">identOfTypeDef</span></a><span> </span><a href="#local-6989586621679158271"><span class="hs-identifier hs-var">tydef</span></a><span class="hs-special">)</span><span> </span><a href="Language.C.Data.Error.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a><span> </span><a href="#local-6989586621679158271"><span class="hs-identifier hs-var">tydef</span></a><span> </span><a href="#local-6989586621679158272"><span class="hs-identifier hs-var">old_def</span></a><span> </span><a href="Language.C.Analysis.SemError.html#DiffKindRedecl"><span class="hs-identifier hs-var">DiffKindRedecl</span></a><span>
</span><a name="line-167"></a><span class="hs-identifier">_checkIdentTyRedef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679158273"><a href="#local-6989586621679158273"><span class="hs-identifier">tydef</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#Redeclared"><span class="hs-identifier hs-var">Redeclared</span></a><span> </span><a name="local-6989586621679158274"><a href="#local-6989586621679158274"><span class="hs-identifier">old_def</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-168"></a><span>  </span><a href="Language.C.Analysis.TravMonad.html#redefErr"><span class="hs-identifier hs-var">redefErr</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#identOfTypeDef"><span class="hs-identifier hs-var">identOfTypeDef</span></a><span> </span><a href="#local-6989586621679158273"><span class="hs-identifier hs-var">tydef</span></a><span class="hs-special">)</span><span> </span><a href="Language.C.Data.Error.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a><span> </span><a href="#local-6989586621679158273"><span class="hs-identifier hs-var">tydef</span></a><span> </span><a href="#local-6989586621679158274"><span class="hs-identifier hs-var">old_def</span></a><span> </span><a href="Language.C.Analysis.SemError.html#DuplicateDef"><span class="hs-identifier hs-var">DuplicateDef</span></a><span>
</span><a name="line-169"></a><span class="hs-identifier">_checkIdentTyRedef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679158275"><a href="#local-6989586621679158275"><span class="hs-identifier">_tydef</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-comment">-- Check whether it is ok to declare a variable already in scope</span><span>
</span><a name="line-172"></a><span class="hs-identifier">checkVarRedef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158231"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#IdentDecl"><span class="hs-identifier hs-type">IdentDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DeclarationStatus"><span class="hs-identifier hs-type">DeclarationStatus</span></a><span> </span><a href="Language.C.Analysis.DefTable.html#IdentEntry"><span class="hs-identifier hs-type">IdentEntry</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158231"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-173"></a><a name="checkVarRedef"><a href="Language.C.Analysis.TravMonad.html#checkVarRedef"><span class="hs-identifier">checkVarRedef</span></a></a><span> </span><a name="local-6989586621679158276"><a href="#local-6989586621679158276"><span class="hs-identifier">def</span></a></a><span> </span><a name="local-6989586621679158277"><a href="#local-6989586621679158277"><span class="hs-identifier">redecl</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-174"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679158277"><span class="hs-identifier hs-var">redecl</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-175"></a><span>        </span><span class="hs-comment">-- always an error</span><span>
</span><a name="line-176"></a><span>        </span><a href="Language.C.Analysis.DefTable.html#KindMismatch"><span class="hs-identifier hs-var">KindMismatch</span></a><span> </span><a name="local-6989586621679158290"><a href="#local-6989586621679158290"><span class="hs-identifier">old_def</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158278"><span class="hs-identifier hs-var">redefVarErr</span></a><span> </span><a href="#local-6989586621679158290"><span class="hs-identifier hs-var">old_def</span></a><span> </span><a href="Language.C.Analysis.SemError.html#DiffKindRedecl"><span class="hs-identifier hs-var">DiffKindRedecl</span></a><span>
</span><a name="line-177"></a><span>        </span><span class="hs-comment">-- Declaration referencing definition:</span><span>
</span><a name="line-178"></a><span>        </span><span class="hs-comment">--   * new entry has to be a declaration</span><span>
</span><a name="line-179"></a><span>        </span><span class="hs-comment">--   * old entry and new entry have to have linkage and agree on linkage</span><span>
</span><a name="line-180"></a><span>        </span><span class="hs-comment">--   * types have to match</span><span>
</span><a name="line-181"></a><span>        </span><a href="Language.C.Analysis.DefTable.html#KeepDef"><span class="hs-identifier hs-var">KeepDef</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679158291"><a href="#local-6989586621679158291"><span class="hs-identifier">old_def</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158282"><span class="hs-identifier hs-var">agreeOnLinkage</span></a><span> </span><a href="#local-6989586621679158276"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679158291"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158279"><span class="hs-identifier hs-var">linkageErr</span></a><span> </span><a href="#local-6989586621679158276"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679158291"><span class="hs-identifier hs-var">old_def</span></a><span>
</span><a name="line-182"></a><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#throwOnLeft"><span class="hs-identifier hs-var">throwOnLeft</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.TravMonad.html#checkCompatibleTypes"><span class="hs-identifier hs-var">checkCompatibleTypes</span></a><span> </span><a href="#local-6989586621679158280"><span class="hs-identifier hs-var">new_ty</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#declType"><span class="hs-identifier hs-var">declType</span></a><span> </span><a href="#local-6989586621679158291"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span>        </span><span class="hs-comment">-- redefinition:</span><span>
</span><a name="line-184"></a><span>        </span><span class="hs-comment">--   * old entry has to be a declaration or tentative definition</span><span>
</span><a name="line-185"></a><span>        </span><span class="hs-comment">--   * old entry and new entry have to have linkage and agree on linkage</span><span>
</span><a name="line-186"></a><span>        </span><span class="hs-comment">--   * types have to match</span><span>
</span><a name="line-187"></a><span>        </span><a href="Language.C.Analysis.DefTable.html#Redeclared"><span class="hs-identifier hs-var">Redeclared</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679158292"><a href="#local-6989586621679158292"><span class="hs-identifier">old_def</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158282"><span class="hs-identifier hs-var">agreeOnLinkage</span></a><span> </span><a href="#local-6989586621679158276"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679158292"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158279"><span class="hs-identifier hs-var">linkageErr</span></a><span> </span><a href="#local-6989586621679158276"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679158292"><span class="hs-identifier hs-var">old_def</span></a><span>
</span><a name="line-188"></a><span>                                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span class="hs-special">(</span><a href="#local-6989586621679158281"><span class="hs-identifier hs-var">canBeOverwritten</span></a><span> </span><a href="#local-6989586621679158292"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158278"><span class="hs-identifier hs-var">redefVarErr</span></a><span> </span><a href="#local-6989586621679158292"><span class="hs-identifier hs-var">old_def</span></a><span> </span><a href="Language.C.Analysis.SemError.html#DuplicateDef"><span class="hs-identifier hs-var">DuplicateDef</span></a><span>
</span><a name="line-189"></a><span>                                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#throwOnLeft"><span class="hs-identifier hs-var">throwOnLeft</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.TravMonad.html#checkCompatibleTypes"><span class="hs-identifier hs-var">checkCompatibleTypes</span></a><span> </span><a href="#local-6989586621679158280"><span class="hs-identifier hs-var">new_ty</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#declType"><span class="hs-identifier hs-var">declType</span></a><span> </span><a href="#local-6989586621679158292"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>        </span><span class="hs-comment">-- NewDecl/Shadowed is ok</span><span>
</span><a name="line-191"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-192"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-193"></a><span>    </span><a name="local-6989586621679158278"><a href="#local-6989586621679158278"><span class="hs-identifier">redefVarErr</span></a></a><span> </span><a name="local-6989586621679158283"><a href="#local-6989586621679158283"><span class="hs-identifier">old_def</span></a></a><span> </span><a name="local-6989586621679158284"><a href="#local-6989586621679158284"><span class="hs-identifier">kind</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#redefErr"><span class="hs-identifier hs-var">redefErr</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#declIdent"><span class="hs-identifier hs-var">declIdent</span></a><span> </span><a href="#local-6989586621679158276"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span> </span><a href="Language.C.Data.Error.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a><span> </span><a href="#local-6989586621679158276"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679158283"><span class="hs-identifier hs-var">old_def</span></a><span> </span><a href="#local-6989586621679158284"><span class="hs-identifier hs-var">kind</span></a><span>
</span><a name="line-194"></a><span>    </span><a name="local-6989586621679158279"><a href="#local-6989586621679158279"><span class="hs-identifier">linkageErr</span></a></a><span> </span><a name="local-6989586621679158285"><a href="#local-6989586621679158285"><span class="hs-identifier">new_def</span></a></a><span> </span><a name="local-6989586621679158286"><a href="#local-6989586621679158286"><span class="hs-identifier">old_def</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-195"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#declLinkage"><span class="hs-identifier hs-var">declLinkage</span></a><span> </span><a href="#local-6989586621679158285"><span class="hs-identifier hs-var">new_def</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.SemRep.html#declLinkage"><span class="hs-identifier hs-var">declLinkage</span></a><span> </span><a href="#local-6989586621679158286"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-196"></a><span>            </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#NoLinkage"><span class="hs-identifier hs-var">NoLinkage</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#redefErr"><span class="hs-identifier hs-var">redefErr</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#declIdent"><span class="hs-identifier hs-var">declIdent</span></a><span> </span><a href="#local-6989586621679158285"><span class="hs-identifier hs-var">new_def</span></a><span class="hs-special">)</span><span> </span><a href="Language.C.Data.Error.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a><span> </span><a href="#local-6989586621679158285"><span class="hs-identifier hs-var">new_def</span></a><span> </span><a href="#local-6989586621679158286"><span class="hs-identifier hs-var">old_def</span></a><span> </span><a href="Language.C.Analysis.SemError.html#NoLinkageOld"><span class="hs-identifier hs-var">NoLinkageOld</span></a><span>
</span><a name="line-197"></a><span>            </span><span class="hs-identifier">_</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#redefErr"><span class="hs-identifier hs-var">redefErr</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#declIdent"><span class="hs-identifier hs-var">declIdent</span></a><span> </span><a href="#local-6989586621679158285"><span class="hs-identifier hs-var">new_def</span></a><span class="hs-special">)</span><span> </span><a href="Language.C.Data.Error.html#LevelError"><span class="hs-identifier hs-var">LevelError</span></a><span> </span><a href="#local-6989586621679158285"><span class="hs-identifier hs-var">new_def</span></a><span> </span><a href="#local-6989586621679158286"><span class="hs-identifier hs-var">old_def</span></a><span> </span><a href="Language.C.Analysis.SemError.html#DisagreeLinkage"><span class="hs-identifier hs-var">DisagreeLinkage</span></a><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span>    </span><a name="local-6989586621679158280"><a href="#local-6989586621679158280"><span class="hs-identifier">new_ty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.SemRep.html#declType"><span class="hs-identifier hs-var">declType</span></a><span> </span><a href="#local-6989586621679158276"><span class="hs-identifier hs-var">def</span></a><span>
</span><a name="line-200"></a><span>    </span><a name="local-6989586621679158281"><a href="#local-6989586621679158281"><span class="hs-identifier">canBeOverwritten</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#Declaration"><span class="hs-identifier hs-var">Declaration</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-201"></a><span>    </span><span class="hs-identifier">canBeOverwritten</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#ObjectDef"><span class="hs-identifier hs-var">ObjectDef</span></a><span> </span><a name="local-6989586621679158287"><a href="#local-6989586621679158287"><span class="hs-identifier">od</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.SemRep.html#isTentative"><span class="hs-identifier hs-var">isTentative</span></a><span> </span><a href="#local-6989586621679158287"><span class="hs-identifier hs-var">od</span></a><span>
</span><a name="line-202"></a><span>    </span><span class="hs-identifier">canBeOverwritten</span><span> </span><span class="hs-identifier">_</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-203"></a><span>    </span><a name="local-6989586621679158282"><a href="#local-6989586621679158282"><span class="hs-identifier">agreeOnLinkage</span></a></a><span> </span><a name="local-6989586621679158288"><a href="#local-6989586621679158288"><span class="hs-identifier">new_def</span></a></a><span> </span><a name="local-6989586621679158289"><a href="#local-6989586621679158289"><span class="hs-identifier">old_def</span></a></a><span>
</span><a name="line-204"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="Language.C.Analysis.SemRep.html#declStorage"><span class="hs-identifier hs-var">declStorage</span></a><span> </span><a href="#local-6989586621679158289"><span class="hs-identifier hs-var">old_def</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Language.C.Analysis.SemRep.html#FunLinkage"><span class="hs-identifier hs-var">FunLinkage</span></a><span> </span><a href="Language.C.Analysis.SemRep.html#InternalLinkage"><span class="hs-identifier hs-var">InternalLinkage</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-205"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#hasLinkage"><span class="hs-identifier hs-var">hasLinkage</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.SemRep.html#declStorage"><span class="hs-identifier hs-var">declStorage</span></a><span> </span><a href="#local-6989586621679158288"><span class="hs-identifier hs-var">new_def</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#hasLinkage"><span class="hs-identifier hs-var">hasLinkage</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.SemRep.html#declStorage"><span class="hs-identifier hs-var">declStorage</span></a><span> </span><a href="#local-6989586621679158289"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-206"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#declLinkage"><span class="hs-identifier hs-var">declLinkage</span></a><span> </span><a href="#local-6989586621679158288"><span class="hs-identifier hs-var">new_def</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#declLinkage"><span class="hs-identifier hs-var">declLinkage</span></a><span> </span><a href="#local-6989586621679158289"><span class="hs-identifier hs-var">old_def</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-207"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span class="hs-comment">-- | handle variable declarations (external object declarations and function prototypes)</span><span>
</span><a name="line-210"></a><span class="hs-comment">-- variable declarations are either function prototypes, or external declarations, and not very</span><span>
</span><a name="line-211"></a><span class="hs-comment">-- interesting on their own. we only put them in the symbol table and call the handle.</span><span>
</span><a name="line-212"></a><span class="hs-comment">-- declarations never override definitions</span><span>
</span><a name="line-213"></a><span class="hs-identifier">handleVarDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadTrav"><span class="hs-identifier hs-type">MonadTrav</span></a><span> </span><a href="#local-6989586621679158230"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#Decl"><span class="hs-identifier hs-type">Decl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158230"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-214"></a><a name="handleVarDecl"><a href="Language.C.Analysis.TravMonad.html#handleVarDecl"><span class="hs-identifier">handleVarDecl</span></a></a><span> </span><a name="local-6989586621679158293"><a href="#local-6989586621679158293"><span class="hs-identifier">is_local</span></a></a><span> </span><a name="local-6989586621679158294"><a href="#local-6989586621679158294"><span class="hs-identifier">decl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-215"></a><span>    </span><a name="local-6989586621679158295"><a href="#local-6989586621679158295"><span class="hs-identifier">def</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Analysis.TravMonad.html#enterDecl"><span class="hs-identifier hs-var">enterDecl</span></a><span> </span><a href="#local-6989586621679158294"><span class="hs-identifier hs-var">decl</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#handleDecl"><span class="hs-identifier hs-var">handleDecl</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679158293"><span class="hs-identifier hs-var">is_local</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Language.C.Analysis.SemRep.html#LocalEvent"><span class="hs-identifier hs-var">LocalEvent</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Language.C.Analysis.SemRep.html#DeclEvent"><span class="hs-identifier hs-var">DeclEvent</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158295"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-comment">-- | handle parameter declaration. The interesting part is that parameters can be abstract</span><span>
</span><a name="line-219"></a><span class="hs-comment">-- (if they are part of a type). If they have a name, we enter the name (usually in function prototype or function scope),</span><span>
</span><a name="line-220"></a><span class="hs-comment">-- checking if there are duplicate definitions.</span><span>
</span><a name="line-221"></a><span class="hs-comment">-- FIXME: I think it would be more transparent to handle parameter declarations in a special way</span><span>
</span><a name="line-222"></a><span class="hs-identifier">handleParamDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadTrav"><span class="hs-identifier hs-type">MonadTrav</span></a><span> </span><a href="#local-6989586621679158229"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#ParamDecl"><span class="hs-identifier hs-type">ParamDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158229"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-223"></a><a name="handleParamDecl"><a href="Language.C.Analysis.TravMonad.html#handleParamDecl"><span class="hs-identifier">handleParamDecl</span></a></a><span> </span><a name="local-6989586621679158296"><a href="#local-6989586621679158296"><span class="hs-identifier">pd</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#AbstractParamDecl"><span class="hs-identifier hs-var">AbstractParamDecl</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#handleDecl"><span class="hs-identifier hs-var">handleDecl</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#ParamEvent"><span class="hs-identifier hs-var">ParamEvent</span></a><span> </span><a href="#local-6989586621679158296"><span class="hs-identifier hs-var">pd</span></a><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span class="hs-identifier">handleParamDecl</span><span> </span><a name="local-6989586621679158297"><a href="#local-6989586621679158297"><span class="hs-identifier">pd</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#ParamDecl"><span class="hs-identifier hs-var">ParamDecl</span></a><span> </span><a name="local-6989586621679158298"><a href="#local-6989586621679158298"><span class="hs-identifier">vardecl</span></a></a><span> </span><a name="local-6989586621679158299"><a href="#local-6989586621679158299"><span class="hs-identifier">node</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-225"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679158300"><a href="#local-6989586621679158300"><span class="hs-identifier">def</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.SemRep.html#ObjectDef"><span class="hs-identifier hs-var">ObjectDef</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#ObjDef"><span class="hs-identifier hs-var">ObjDef</span></a><span> </span><a href="#local-6989586621679158298"><span class="hs-identifier hs-var">vardecl</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a href="#local-6989586621679158299"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">)</span><span>
</span><a name="line-226"></a><span>    </span><a name="local-6989586621679158301"><a href="#local-6989586621679158301"><span class="hs-identifier">redecl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier hs-var">withDefTable</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.DefTable.html#defineScopedIdent"><span class="hs-identifier hs-var">defineScopedIdent</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#declIdent"><span class="hs-identifier hs-var">declIdent</span></a><span> </span><a href="#local-6989586621679158300"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158300"><span class="hs-identifier hs-var">def</span></a><span>
</span><a name="line-227"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#checkVarRedef"><span class="hs-identifier hs-var">checkVarRedef</span></a><span> </span><a href="#local-6989586621679158300"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679158301"><span class="hs-identifier hs-var">redecl</span></a><span>
</span><a name="line-228"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#handleDecl"><span class="hs-identifier hs-var">handleDecl</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#ParamEvent"><span class="hs-identifier hs-var">ParamEvent</span></a><span> </span><a href="#local-6989586621679158297"><span class="hs-identifier hs-var">pd</span></a><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span class="hs-comment">-- shared impl</span><span>
</span><a name="line-231"></a><span class="hs-identifier">enterDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158228"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158228"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#Decl"><span class="hs-identifier hs-type">Decl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#IdentDecl"><span class="hs-identifier hs-type">IdentDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158228"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.C.Analysis.SemRep.html#IdentDecl"><span class="hs-identifier hs-type">IdentDecl</span></a><span>
</span><a name="line-232"></a><a name="enterDecl"><a href="Language.C.Analysis.TravMonad.html#enterDecl"><span class="hs-identifier">enterDecl</span></a></a><span> </span><a name="local-6989586621679158302"><a href="#local-6989586621679158302"><span class="hs-identifier">decl</span></a></a><span> </span><a name="local-6989586621679158303"><a href="#local-6989586621679158303"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-233"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679158304"><a href="#local-6989586621679158304"><span class="hs-identifier">def</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.SemRep.html#Declaration"><span class="hs-identifier hs-var">Declaration</span></a><span> </span><a href="#local-6989586621679158302"><span class="hs-identifier hs-var">decl</span></a><span>
</span><a name="line-234"></a><span>    </span><a name="local-6989586621679158305"><a href="#local-6989586621679158305"><span class="hs-identifier">redecl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier hs-var">withDefTable</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-235"></a><span>              </span><a href="Language.C.Analysis.DefTable.html#defineScopedIdentWhen"><span class="hs-identifier hs-var">defineScopedIdentWhen</span></a><span> </span><a href="#local-6989586621679158303"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#declIdent"><span class="hs-identifier hs-var">declIdent</span></a><span> </span><a href="#local-6989586621679158304"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158304"><span class="hs-identifier hs-var">def</span></a><span>
</span><a name="line-236"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#checkVarRedef"><span class="hs-identifier hs-var">checkVarRedef</span></a><span> </span><a href="#local-6989586621679158304"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679158305"><span class="hs-identifier hs-var">redecl</span></a><span>
</span><a name="line-237"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679158304"><span class="hs-identifier hs-var">def</span></a><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span class="hs-comment">-- | handle function definitions</span><span>
</span><a name="line-240"></a><span class="hs-identifier">handleFunDef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadTrav"><span class="hs-identifier hs-type">MonadTrav</span></a><span> </span><a href="#local-6989586621679158227"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#FunDef"><span class="hs-identifier hs-type">FunDef</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158227"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-241"></a><a name="handleFunDef"><a href="Language.C.Analysis.TravMonad.html#handleFunDef"><span class="hs-identifier">handleFunDef</span></a></a><span> </span><a name="local-6989586621679158306"><a href="#local-6989586621679158306"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679158307"><a href="#local-6989586621679158307"><span class="hs-identifier">fun_def</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-242"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679158308"><a href="#local-6989586621679158308"><span class="hs-identifier">def</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.SemRep.html#FunctionDef"><span class="hs-identifier hs-var">FunctionDef</span></a><span> </span><a href="#local-6989586621679158307"><span class="hs-identifier hs-var">fun_def</span></a><span>
</span><a name="line-243"></a><span>    </span><a name="local-6989586621679158309"><a href="#local-6989586621679158309"><span class="hs-identifier">redecl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier hs-var">withDefTable</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-244"></a><span>              </span><a href="Language.C.Analysis.DefTable.html#defineScopedIdentWhen"><span class="hs-identifier hs-var">defineScopedIdentWhen</span></a><span> </span><a href="Language.C.Analysis.TravMonad.html#isDeclaration"><span class="hs-identifier hs-var">isDeclaration</span></a><span> </span><a href="#local-6989586621679158306"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679158308"><span class="hs-identifier hs-var">def</span></a><span>
</span><a name="line-245"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#checkVarRedef"><span class="hs-identifier hs-var">checkVarRedef</span></a><span> </span><a href="#local-6989586621679158308"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679158309"><span class="hs-identifier hs-var">redecl</span></a><span>
</span><a name="line-246"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#handleDecl"><span class="hs-identifier hs-var">handleDecl</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#DeclEvent"><span class="hs-identifier hs-var">DeclEvent</span></a><span> </span><a href="#local-6989586621679158308"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span class="hs-identifier">isDeclaration</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.SemRep.html#IdentDecl"><span class="hs-identifier hs-type">IdentDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-249"></a><a name="isDeclaration"><a href="Language.C.Analysis.TravMonad.html#isDeclaration"><span class="hs-identifier">isDeclaration</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#Declaration"><span class="hs-identifier hs-var">Declaration</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-250"></a><span class="hs-identifier">isDeclaration</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-identifier">checkCompatibleTypes</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.SemRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Language.C.Analysis.SemError.html#TypeMismatch"><span class="hs-identifier hs-type">TypeMismatch</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-253"></a><a name="checkCompatibleTypes"><a href="Language.C.Analysis.TravMonad.html#checkCompatibleTypes"><span class="hs-identifier">checkCompatibleTypes</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>
</span><a name="line-255"></a><span class="hs-comment">-- | handle object defintions (maybe tentative)</span><span>
</span><a name="line-256"></a><span class="hs-identifier">handleObjectDef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadTrav"><span class="hs-identifier hs-type">MonadTrav</span></a><span> </span><a href="#local-6989586621679158226"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.SemRep.html#ObjDef"><span class="hs-identifier hs-type">ObjDef</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158226"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-257"></a><a name="handleObjectDef"><a href="Language.C.Analysis.TravMonad.html#handleObjectDef"><span class="hs-identifier">handleObjectDef</span></a></a><span> </span><a name="local-6989586621679158310"><a href="#local-6989586621679158310"><span class="hs-identifier">local</span></a></a><span> </span><a name="local-6989586621679158311"><a href="#local-6989586621679158311"><span class="hs-identifier">ident</span></a></a><span> </span><a name="local-6989586621679158312"><a href="#local-6989586621679158312"><span class="hs-identifier">obj_def</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-258"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679158318"><a href="#local-6989586621679158318"><span class="hs-identifier">def</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.SemRep.html#ObjectDef"><span class="hs-identifier hs-var">ObjectDef</span></a><span> </span><a href="#local-6989586621679158312"><span class="hs-identifier hs-var">obj_def</span></a><span>
</span><a name="line-259"></a><span>    </span><a name="local-6989586621679158319"><a href="#local-6989586621679158319"><span class="hs-identifier">redecl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier hs-var">withDefTable</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-260"></a><span>              </span><a href="Language.C.Analysis.DefTable.html#defineScopedIdentWhen"><span class="hs-identifier hs-var">defineScopedIdentWhen</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158314"><span class="hs-identifier hs-var">shouldOverride</span></a><span> </span><a href="#local-6989586621679158318"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158311"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679158318"><span class="hs-identifier hs-var">def</span></a><span>
</span><a name="line-261"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#checkVarRedef"><span class="hs-identifier hs-var">checkVarRedef</span></a><span> </span><a href="#local-6989586621679158318"><span class="hs-identifier hs-var">def</span></a><span> </span><a href="#local-6989586621679158319"><span class="hs-identifier hs-var">redecl</span></a><span>
</span><a name="line-262"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#handleDecl"><span class="hs-identifier hs-var">handleDecl</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679158310"><span class="hs-identifier hs-var">local</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="Language.C.Analysis.SemRep.html#LocalEvent"><span class="hs-identifier hs-var">LocalEvent</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="Language.C.Analysis.SemRep.html#DeclEvent"><span class="hs-identifier hs-var">DeclEvent</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158318"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-264"></a><span>    </span><a name="local-6989586621679158313"><a href="#local-6989586621679158313"><span class="hs-identifier">isTentativeDef</span></a></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#ObjectDef"><span class="hs-identifier hs-var">ObjectDef</span></a><span> </span><a name="local-6989586621679158315"><a href="#local-6989586621679158315"><span class="hs-identifier">object_def</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.SemRep.html#isTentative"><span class="hs-identifier hs-var">isTentative</span></a><span> </span><a href="#local-6989586621679158315"><span class="hs-identifier hs-var">object_def</span></a><span>
</span><a name="line-265"></a><span>    </span><span class="hs-identifier">isTentativeDef</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-266"></a><span>    </span><a name="local-6989586621679158314"><a href="#local-6989586621679158314"><span class="hs-identifier">shouldOverride</span></a></a><span> </span><a name="local-6989586621679158316"><a href="#local-6989586621679158316"><span class="hs-identifier">def</span></a></a><span> </span><a name="local-6989586621679158317"><a href="#local-6989586621679158317"><span class="hs-identifier">old</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="Language.C.Analysis.TravMonad.html#isDeclaration"><span class="hs-identifier hs-var">isDeclaration</span></a><span> </span><a href="#local-6989586621679158317"><span class="hs-identifier hs-var">old</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-267"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158313"><span class="hs-identifier hs-var">isTentativeDef</span></a><span> </span><a href="#local-6989586621679158316"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-268"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679158313"><span class="hs-identifier hs-var">isTentativeDef</span></a><span> </span><a href="#local-6989586621679158317"><span class="hs-identifier hs-var">old</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-269"></a><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-270"></a><span>
</span><a name="line-271"></a><span class="hs-comment">-- * scope manipulation</span><span>
</span><a name="line-272"></a><span class="hs-comment">--</span><span>
</span><a name="line-273"></a><span class="hs-comment">--  * file scope: outside of parameter lists and blocks (outermost)</span><span>
</span><a name="line-274"></a><span class="hs-comment">--</span><span>
</span><a name="line-275"></a><span class="hs-comment">--  * function prototype scope</span><span>
</span><a name="line-276"></a><span class="hs-comment">--</span><span>
</span><a name="line-277"></a><span class="hs-comment">--  * function scope: labels are visible within the entire function, and declared implicitely</span><span>
</span><a name="line-278"></a><span class="hs-comment">--</span><span>
</span><a name="line-279"></a><span class="hs-comment">--  * block scope</span><span>
</span><a name="line-280"></a><span class="hs-identifier">updDefTable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158225"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158225"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-281"></a><a name="updDefTable"><a href="Language.C.Analysis.TravMonad.html#updDefTable"><span class="hs-identifier">updDefTable</span></a></a><span> </span><a name="local-6989586621679158320"><a href="#local-6989586621679158320"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier hs-var">withDefTable</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679158321"><a href="#local-6989586621679158321"><span class="hs-identifier">st</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621679158320"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679158321"><span class="hs-identifier hs-var">st</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-identifier">enterPrototypeScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158224"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679158224"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-284"></a><a name="enterPrototypeScope"><a href="Language.C.Analysis.TravMonad.html#enterPrototypeScope"><span class="hs-identifier">enterPrototypeScope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#updDefTable"><span class="hs-identifier hs-var">updDefTable</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#enterBlockScope"><span class="hs-identifier hs-var">ST.enterBlockScope</span></a><span class="hs-special">)</span><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-identifier">leavePrototypeScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158223"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679158223"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-287"></a><a name="leavePrototypeScope"><a href="Language.C.Analysis.TravMonad.html#leavePrototypeScope"><span class="hs-identifier">leavePrototypeScope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#updDefTable"><span class="hs-identifier hs-var">updDefTable</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#leaveBlockScope"><span class="hs-identifier hs-var">ST.leaveBlockScope</span></a><span class="hs-special">)</span><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span class="hs-identifier">enterFunctionScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158222"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679158222"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-290"></a><a name="enterFunctionScope"><a href="Language.C.Analysis.TravMonad.html#enterFunctionScope"><span class="hs-identifier">enterFunctionScope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#updDefTable"><span class="hs-identifier hs-var">updDefTable</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#enterFunctionScope"><span class="hs-identifier hs-var">ST.enterFunctionScope</span></a><span class="hs-special">)</span><span>
</span><a name="line-291"></a><span>
</span><a name="line-292"></a><span class="hs-identifier">leaveFunctionScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158221"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679158221"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-293"></a><a name="leaveFunctionScope"><a href="Language.C.Analysis.TravMonad.html#leaveFunctionScope"><span class="hs-identifier">leaveFunctionScope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#updDefTable"><span class="hs-identifier hs-var">updDefTable</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#leaveFunctionScope"><span class="hs-identifier hs-var">ST.leaveFunctionScope</span></a><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-identifier">enterBlockScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158220"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679158220"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-296"></a><a name="enterBlockScope"><a href="Language.C.Analysis.TravMonad.html#enterBlockScope"><span class="hs-identifier">enterBlockScope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#updDefTable"><span class="hs-identifier hs-var">updDefTable</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#enterBlockScope"><span class="hs-identifier hs-var">ST.enterBlockScope</span></a><span class="hs-special">)</span><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-identifier">leaveBlockScope</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158219"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679158219"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-299"></a><a name="leaveBlockScope"><a href="Language.C.Analysis.TravMonad.html#leaveBlockScope"><span class="hs-identifier">leaveBlockScope</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#updDefTable"><span class="hs-identifier hs-var">updDefTable</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#leaveBlockScope"><span class="hs-identifier hs-var">ST.leaveBlockScope</span></a><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span class="hs-comment">-- * Lookup</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span class="hs-comment">-- | lookup a type definition</span><span>
</span><a name="line-304"></a><span class="hs-comment">-- the 'wrong kind of object' is an internal error here,</span><span>
</span><a name="line-305"></a><span class="hs-comment">-- because the parser should distinguish typeDefs and other</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- objects</span><span>
</span><a name="line-307"></a><span class="hs-identifier">lookupTypeDef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158218"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158218"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158218"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.C.Analysis.SemRep.html#Type"><span class="hs-identifier hs-type">Type</span></a><span>
</span><a name="line-308"></a><a name="lookupTypeDef"><a href="Language.C.Analysis.TravMonad.html#lookupTypeDef"><span class="hs-identifier">lookupTypeDef</span></a></a><span> </span><a name="local-6989586621679158322"><a href="#local-6989586621679158322"><span class="hs-identifier">ident</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-309"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#getDefTable"><span class="hs-identifier hs-var">getDefTable</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679158325"><a href="#local-6989586621679158325"><span class="hs-identifier">symt</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-310"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="Language.C.Analysis.DefTable.html#lookupIdent"><span class="hs-identifier hs-var">lookupIdent</span></a><span> </span><a href="#local-6989586621679158322"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679158325"><span class="hs-identifier hs-var">symt</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-311"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>                             </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-312"></a><span>          </span><a href="Language.C.Analysis.TravMonad.html#astError"><span class="hs-identifier hs-var">astError</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679158322"><span class="hs-identifier hs-var">ident</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;unbound typeDef: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Language.C.Data.Ident.html#identToString"><span class="hs-identifier hs-var">identToString</span></a><span> </span><a href="#local-6989586621679158322"><span class="hs-identifier hs-var">ident</span></a><span>
</span><a name="line-313"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#TypeDef"><span class="hs-identifier hs-var">TypeDef</span></a><span> </span><a name="local-6989586621679158326"><a href="#local-6989586621679158326"><span class="hs-identifier">def_ident</span></a></a><span> </span><a name="local-6989586621679158327"><a href="#local-6989586621679158327"><span class="hs-identifier">ty</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#addRef"><span class="hs-identifier hs-var">addRef</span></a><span> </span><a href="#local-6989586621679158322"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679158326"><span class="hs-identifier hs-var">def_ident</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679158327"><span class="hs-identifier hs-var">ty</span></a><span>
</span><a name="line-314"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679158328"><a href="#local-6989586621679158328"><span class="hs-identifier">d</span></a></a><span class="hs-special">)</span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#astError"><span class="hs-identifier hs-var">astError</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679158322"><span class="hs-identifier hs-var">ident</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158323"><span class="hs-identifier hs-var">wrongKindErrMsg</span></a><span> </span><a href="#local-6989586621679158328"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-315"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-316"></a><span>    </span><a name="local-6989586621679158323"><a href="#local-6989586621679158323"><span class="hs-identifier">wrongKindErrMsg</span></a></a><span> </span><a name="local-6989586621679158324"><a href="#local-6989586621679158324"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;wrong kind of object: expected typedef but found &quot;</span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#objKindDescr"><span class="hs-identifier hs-var">objKindDescr</span></a><span> </span><a href="#local-6989586621679158324"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span>                        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; (for identifier `&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Language.C.Data.Ident.html#identToString"><span class="hs-identifier hs-var">identToString</span></a><span> </span><a href="#local-6989586621679158322"><span class="hs-identifier hs-var">ident</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;')&quot;</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-comment">-- | lookup an object, function or enumerator</span><span>
</span><a name="line-321"></a><span class="hs-identifier">lookupObject</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158217"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158217"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158217"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.C.Analysis.SemRep.html#IdentDecl"><span class="hs-identifier hs-type">IdentDecl</span></a><span class="hs-special">)</span><span>
</span><a name="line-322"></a><a name="lookupObject"><a href="Language.C.Analysis.TravMonad.html#lookupObject"><span class="hs-identifier">lookupObject</span></a></a><span> </span><a name="local-6989586621679158329"><a href="#local-6989586621679158329"><span class="hs-identifier">ident</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-323"></a><span>    </span><a name="local-6989586621679158330"><a href="#local-6989586621679158330"><span class="hs-identifier">old_decl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.DefTable.html#lookupIdent"><span class="hs-identifier hs-var">lookupIdent</span></a><span> </span><a href="#local-6989586621679158329"><span class="hs-identifier hs-var">ident</span></a><span class="hs-special">)</span><span> </span><a href="Language.C.Analysis.TravMonad.html#getDefTable"><span class="hs-identifier hs-var">getDefTable</span></a><span>
</span><a name="line-324"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a><span> </span><a href="#local-6989586621679158330"><span class="hs-identifier hs-var">old_decl</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679158331"><a href="#local-6989586621679158331"><span class="hs-identifier">obj</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-325"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679158331"><span class="hs-identifier hs-var">obj</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-326"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679158332"><a href="#local-6989586621679158332"><span class="hs-identifier">objdef</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#addRef"><span class="hs-identifier hs-var">addRef</span></a><span> </span><a href="#local-6989586621679158329"><span class="hs-identifier hs-var">ident</span></a><span> </span><a href="#local-6989586621679158332"><span class="hs-identifier hs-var">objdef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679158332"><span class="hs-identifier hs-var">objdef</span></a><span>
</span><a name="line-327"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679158333"><a href="#local-6989586621679158333"><span class="hs-identifier">_tydef</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#astError"><span class="hs-identifier hs-var">astError</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679158329"><span class="hs-identifier hs-var">ident</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#mismatchErr"><span class="hs-identifier hs-var">mismatchErr</span></a><span> </span><span class="hs-string">&quot;lookupObject&quot;</span><span> </span><span class="hs-string">&quot;an object&quot;</span><span> </span><span class="hs-string">&quot;a typeDef&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span class="hs-comment">-- | add link between use and definition (private)</span><span>
</span><a name="line-330"></a><span class="hs-identifier">addRef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158214"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158214"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Data.Node.html#CNode"><span class="hs-identifier hs-type">CNode</span></a><span> </span><a href="#local-6989586621679158215"><span class="hs-identifier hs-type">u</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Data.Node.html#CNode"><span class="hs-identifier hs-type">CNode</span></a><span> </span><a href="#local-6989586621679158216"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679158215"><span class="hs-identifier hs-type">u</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158216"><span class="hs-identifier hs-type">d</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158214"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-331"></a><a name="addRef"><a href="Language.C.Analysis.TravMonad.html#addRef"><span class="hs-identifier">addRef</span></a></a><span> </span><a name="local-6989586621679158334"><a href="#local-6989586621679158334"><span class="hs-identifier">use</span></a></a><span> </span><a name="local-6989586621679158335"><a href="#local-6989586621679158335"><span class="hs-identifier">def</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-332"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679158334"><span class="hs-identifier hs-var">use</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Data.Node.html#nodeInfo"><span class="hs-identifier hs-var">nodeInfo</span></a><span> </span><a href="#local-6989586621679158335"><span class="hs-identifier hs-var">def</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-333"></a><span>    </span><span class="hs-special">(</span><a href="Language.C.Data.Node.html#NodeInfo"><span class="hs-identifier hs-var">NodeInfo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679158336"><a href="#local-6989586621679158336"><span class="hs-identifier">useName</span></a></a><span class="hs-special">,</span><span> </span><a href="Language.C.Data.Node.html#NodeInfo"><span class="hs-identifier hs-var">NodeInfo</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679158337"><a href="#local-6989586621679158337"><span class="hs-identifier">defName</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-334"></a><span>      </span><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier hs-var">withDefTable</span></a><span>
</span><a name="line-335"></a><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679158338"><a href="#local-6989586621679158338"><span class="hs-identifier">dt</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-336"></a><span>         </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-337"></a><span>          </span><a href="#local-6989586621679158338"><span class="hs-identifier hs-var">dt</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">refTable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">insert</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">nameId</span><span> </span><a href="#local-6989586621679158336"><span class="hs-identifier hs-var">useName</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158337"><span class="hs-identifier hs-var">defName</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">refTable</span><span> </span><a href="#local-6989586621679158338"><span class="hs-identifier hs-var">dt</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-338"></a><span>         </span><span class="hs-special">)</span><span>
</span><a name="line-339"></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-340"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Don't have Names for both, so can't record.</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span class="hs-identifier">mismatchErr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-344"></a><a name="mismatchErr"><a href="Language.C.Analysis.TravMonad.html#mismatchErr"><span class="hs-identifier">mismatchErr</span></a></a><span> </span><a name="local-6989586621679158339"><a href="#local-6989586621679158339"><span class="hs-identifier">ctx</span></a></a><span> </span><a name="local-6989586621679158340"><a href="#local-6989586621679158340"><span class="hs-identifier">expect</span></a></a><span> </span><a name="local-6989586621679158341"><a href="#local-6989586621679158341"><span class="hs-identifier">found</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679158339"><span class="hs-identifier hs-var">ctx</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;: Expected &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679158340"><span class="hs-identifier hs-var">expect</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;, but found: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679158341"><span class="hs-identifier hs-var">found</span></a><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span class="hs-comment">-- * inserting declarations</span><span>
</span><a name="line-347"></a><span>
</span><a name="line-348"></a><span class="hs-comment">-- | create a reference to a struct\/union\/enum</span><span>
</span><a name="line-349"></a><span class="hs-comment">--</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- This currently depends on the fact the structs are tagged with unique names.</span><span>
</span><a name="line-351"></a><span class="hs-comment">-- We could use the name generation of TravMonad as well, which might be the better</span><span>
</span><a name="line-352"></a><span class="hs-comment">-- choice when dealing with autogenerated code.</span><span>
</span><a name="line-353"></a><span class="hs-identifier">createSUERef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158213"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><a href="#local-6989586621679158213"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Data.Node.html#NodeInfo"><span class="hs-identifier hs-type">NodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Language.C.Data.Ident.html#Ident"><span class="hs-identifier hs-type">Ident</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158213"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Language.C.Data.Ident.html#SUERef"><span class="hs-identifier hs-type">SUERef</span></a><span>
</span><a name="line-354"></a><a name="createSUERef"><a href="Language.C.Analysis.TravMonad.html#createSUERef"><span class="hs-identifier">createSUERef</span></a></a><span> </span><a name="local-6989586621679158342"><a href="#local-6989586621679158342"><span class="hs-identifier">_node_info</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679158343"><a href="#local-6989586621679158343"><span class="hs-identifier">ident</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Data.Ident.html#NamedRef"><span class="hs-identifier hs-var">NamedRef</span></a><span> </span><a href="#local-6989586621679158343"><span class="hs-identifier hs-var">ident</span></a><span>
</span><a name="line-355"></a><span class="hs-identifier">createSUERef</span><span> </span><a name="local-6989586621679158344"><a href="#local-6989586621679158344"><span class="hs-identifier">node_info</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679158345"><a href="#local-6989586621679158345"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Data.Node.html#nameOfNode"><span class="hs-identifier hs-var">nameOfNode</span></a><span> </span><a href="#local-6989586621679158344"><span class="hs-identifier hs-var">node_info</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Data.Ident.html#AnonymousRef"><span class="hs-identifier hs-var">AnonymousRef</span></a><span> </span><a href="#local-6989586621679158345"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-356"></a><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#astError"><span class="hs-identifier hs-var">astError</span></a><span> </span><a href="#local-6989586621679158344"><span class="hs-identifier hs-var">node_info</span></a><span> </span><span class="hs-string">&quot;struct/union/enum definition without unique name&quot;</span><span>
</span><a name="line-357"></a><span>
</span><a name="line-358"></a><span class="hs-comment">-- * error handling facilities</span><span>
</span><a name="line-359"></a><span>
</span><a name="line-360"></a><span class="hs-identifier">handleTravError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158211"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679158211"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679158212"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158211"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679158212"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-361"></a><a name="handleTravError"><a href="Language.C.Analysis.TravMonad.html#handleTravError"><span class="hs-identifier">handleTravError</span></a></a><span> </span><a name="local-6989586621679158346"><a href="#local-6989586621679158346"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679158346"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-special">`</span><a href="Language.C.Analysis.TravMonad.html#catchTravError"><span class="hs-identifier hs-var">catchTravError</span></a><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679158347"><a href="#local-6989586621679158347"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#recordError"><span class="hs-identifier hs-var">recordError</span></a><span> </span><a href="#local-6989586621679158347"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-comment">-- | check wheter non-recoverable errors occurred</span><span>
</span><a name="line-364"></a><span class="hs-identifier">hadHardErrors</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Language.C.Data.Error.html#CError"><span class="hs-identifier hs-type">CError</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-365"></a><a name="hadHardErrors"><a href="Language.C.Analysis.TravMonad.html#hadHardErrors"><span class="hs-identifier">hadHardErrors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><a href="Language.C.Data.Error.html#isHardError"><span class="hs-identifier hs-var">isHardError</span></a><span>
</span><a name="line-366"></a><span>
</span><a name="line-367"></a><span class="hs-comment">-- | raise an error caused by a malformed AST</span><span>
</span><a name="line-368"></a><span class="hs-identifier">astError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158209"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Language.C.Data.Node.html#NodeInfo"><span class="hs-identifier hs-type">NodeInfo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158209"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679158210"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-369"></a><a name="astError"><a href="Language.C.Analysis.TravMonad.html#astError"><span class="hs-identifier">astError</span></a></a><span> </span><a name="local-6989586621679158348"><a href="#local-6989586621679158348"><span class="hs-identifier">node</span></a></a><span> </span><a name="local-6989586621679158349"><a href="#local-6989586621679158349"><span class="hs-identifier">msg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#throwTravError"><span class="hs-identifier hs-var">throwTravError</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Language.C.Analysis.SemError.html#invalidAST"><span class="hs-identifier hs-var">invalidAST</span></a><span> </span><a href="#local-6989586621679158348"><span class="hs-identifier hs-var">node</span></a><span> </span><a href="#local-6989586621679158349"><span class="hs-identifier hs-var">msg</span></a><span>
</span><a name="line-370"></a><span>
</span><a name="line-371"></a><span class="hs-comment">-- | raise an error based on an Either argument</span><span>
</span><a name="line-372"></a><span class="hs-identifier">throwOnLeft</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158206"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Data.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a><span> </span><a href="#local-6989586621679158207"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="#local-6989586621679158207"><span class="hs-identifier hs-type">e</span></a><span> </span><a href="#local-6989586621679158208"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158206"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679158208"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-373"></a><a name="throwOnLeft"><a href="Language.C.Analysis.TravMonad.html#throwOnLeft"><span class="hs-identifier">throwOnLeft</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679158350"><a href="#local-6989586621679158350"><span class="hs-identifier">err</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#throwTravError"><span class="hs-identifier hs-var">throwTravError</span></a><span> </span><a href="#local-6989586621679158350"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-374"></a><span class="hs-identifier">throwOnLeft</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679158351"><a href="#local-6989586621679158351"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679158351"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span class="hs-identifier">warn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Error.html#Error"><span class="hs-identifier hs-type">Error</span></a><span> </span><a href="#local-6989586621679158204"><span class="hs-identifier hs-type">e</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><a href="#local-6989586621679158205"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679158204"><span class="hs-identifier hs-type">e</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158205"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-377"></a><a name="warn"><a href="Language.C.Analysis.TravMonad.html#warn"><span class="hs-identifier">warn</span></a></a><span> </span><a name="local-6989586621679158352"><a href="#local-6989586621679158352"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#recordError"><span class="hs-identifier hs-var">recordError</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Error.html#changeErrorLevel"><span class="hs-identifier hs-var">changeErrorLevel</span></a><span> </span><a href="#local-6989586621679158352"><span class="hs-identifier hs-var">err</span></a><span> </span><a href="Language.C.Data.Error.html#LevelWarn"><span class="hs-identifier hs-var">LevelWarn</span></a><span class="hs-special">)</span><span>
</span><a name="line-378"></a><span>
</span><a name="line-379"></a><span class="hs-comment">-- * The Trav datatype</span><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span class="hs-comment">-- | simple traversal monad, providing user state and callbacks</span><span>
</span><a name="line-382"></a><span class="hs-keyword">newtype</span><span> </span><a name="Trav"><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier">Trav</span></a></a><span> </span><a name="local-6989586621679158137"><a href="#local-6989586621679158137"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679158138"><a href="#local-6989586621679158138"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Trav"><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier">Trav</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unTrav"><a href="Language.C.Analysis.TravMonad.html#unTrav"><span class="hs-identifier">unTrav</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-type">TravState</span></a><span> </span><a href="#local-6989586621679158137"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Language.C.Data.Error.html#CError"><span class="hs-identifier hs-type">CError</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158138"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-type">TravState</span></a><span> </span><a href="#local-6989586621679158137"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-383"></a><span class="hs-identifier">modify</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-type">TravState</span></a><span> </span><a href="#local-6989586621679158203"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-type">TravState</span></a><span> </span><a href="#local-6989586621679158203"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158203"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-384"></a><a name="modify"><a href="Language.C.Analysis.TravMonad.html#modify"><span class="hs-identifier">modify</span></a></a><span> </span><a name="local-6989586621679158353"><a href="#local-6989586621679158353"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-var">Trav</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679158354"><a href="#local-6989586621679158354"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621679158353"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679158354"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-385"></a><span class="hs-identifier">gets</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-type">TravState</span></a><span> </span><a href="#local-6989586621679158201"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158202"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158201"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679158202"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-386"></a><a name="gets"><a href="Language.C.Analysis.TravMonad.html#gets"><span class="hs-identifier">gets</span></a></a><span> </span><a name="local-6989586621679158355"><a href="#local-6989586621679158355"><span class="hs-identifier">f</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-var">Trav</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679158356"><a href="#local-6989586621679158356"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158355"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679158356"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679158356"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span class="hs-identifier">get</span><span> </span><span class="hs-glyph">::</span><span>  </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158200"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-type">TravState</span></a><span> </span><a href="#local-6989586621679158200"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-388"></a><a name="get"><a href="Language.C.Analysis.TravMonad.html#get"><span class="hs-identifier">get</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-var">Trav</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679158357"><a href="#local-6989586621679158357"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158357"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><a href="#local-6989586621679158357"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-389"></a><span class="hs-identifier">put</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-type">TravState</span></a><span> </span><a href="#local-6989586621679158199"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158199"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-390"></a><a name="put"><a href="Language.C.Analysis.TravMonad.html#put"><span class="hs-identifier">put</span></a></a><span> </span><a name="local-6989586621679158358"><a href="#local-6989586621679158358"><span class="hs-identifier">s</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-var">Trav</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="#local-6989586621679158358"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-391"></a><span>
</span><a name="line-392"></a><span>
</span><a name="line-393"></a><span class="hs-identifier">runTrav</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679158197"><a href="#local-6989586621679158197"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679158198"><a href="#local-6989586621679158198"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><a href="#local-6989586621679158197"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158197"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679158198"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">[</span><a href="Language.C.Data.Error.html#CError"><span class="hs-identifier hs-type">CError</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158198"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-type">TravState</span></a><span> </span><a href="#local-6989586621679158197"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-394"></a><a name="runTrav"><a href="Language.C.Analysis.TravMonad.html#runTrav"><span class="hs-identifier">runTrav</span></a></a><span> </span><a name="local-6989586621679158359"><a href="#local-6989586621679158359"><span class="hs-identifier">state</span></a></a><span> </span><a name="local-6989586621679158360"><a href="#local-6989586621679158360"><span class="hs-identifier">traversal</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-395"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unTrav</span><span> </span><a href="#local-6989586621679158361"><span class="hs-identifier hs-var">action</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#initTravState"><span class="hs-identifier hs-var">initTravState</span></a><span> </span><a href="#local-6989586621679158359"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-396"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679158362"><a href="#local-6989586621679158362"><span class="hs-identifier">trav_err</span></a></a><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679158362"><span class="hs-identifier hs-var">trav_err</span></a><span class="hs-special">]</span><span>
</span><a name="line-397"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679158363"><a href="#local-6989586621679158363"><span class="hs-identifier">v</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679158364"><a href="#local-6989586621679158364"><span class="hs-identifier">ts</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><a href="Language.C.Analysis.TravMonad.html#hadHardErrors"><span class="hs-identifier hs-var">hadHardErrors</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#travErrors"><span class="hs-identifier hs-var">travErrors</span></a><span> </span><a href="#local-6989586621679158364"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#travErrors"><span class="hs-identifier hs-var">travErrors</span></a><span> </span><a href="#local-6989586621679158364"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span>
</span><a name="line-398"></a><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158363"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">,</span><a href="#local-6989586621679158364"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span>
</span><a name="line-399"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-400"></a><span>    </span><a name="local-6989586621679158361"><a href="#local-6989586621679158361"><span class="hs-identifier">action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier hs-var">withDefTable</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Language.C.Analysis.Builtins.html#builtins"><span class="hs-identifier hs-var">builtins</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-401"></a><span>                </span><a href="#local-6989586621679158360"><span class="hs-identifier hs-var">traversal</span></a><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span class="hs-identifier">runTrav_</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158196"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><span class="hs-special">[</span><a href="Language.C.Data.Error.html#CError"><span class="hs-identifier hs-type">CError</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158196"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span class="hs-special">[</span><a href="Language.C.Data.Error.html#CError"><span class="hs-identifier hs-type">CError</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-404"></a><a name="runTrav_"><a href="Language.C.Analysis.TravMonad.html#runTrav_"><span class="hs-identifier">runTrav_</span></a></a><span> </span><a name="local-6989586621679158365"><a href="#local-6989586621679158365"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Language.C.Analysis.TravMonad.html#runTrav"><span class="hs-identifier hs-var">runTrav</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-405"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679158366"><a href="#local-6989586621679158366"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679158365"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-406"></a><span>       </span><a name="local-6989586621679158367"><a href="#local-6989586621679158367"><span class="hs-identifier">es</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Analysis.TravMonad.html#getErrors"><span class="hs-identifier hs-var">getErrors</span></a><span>
</span><a name="line-407"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158366"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><a href="#local-6989586621679158367"><span class="hs-identifier hs-var">es</span></a><span class="hs-special">)</span><span>
</span><a name="line-408"></a><span>
</span><a name="line-409"></a><span class="hs-identifier">withExtDeclHandler</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158194"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679158195"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#DeclEvent"><span class="hs-identifier hs-type">DeclEvent</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158194"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158194"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679158195"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-410"></a><a name="withExtDeclHandler"><a href="Language.C.Analysis.TravMonad.html#withExtDeclHandler"><span class="hs-identifier">withExtDeclHandler</span></a></a><span> </span><a name="local-6989586621679158368"><a href="#local-6989586621679158368"><span class="hs-identifier">action</span></a></a><span> </span><a name="local-6989586621679158369"><a href="#local-6989586621679158369"><span class="hs-identifier">handler</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-411"></a><span>    </span><span class="hs-keyword">do</span><span> </span><a href="Language.C.Analysis.TravMonad.html#modify"><span class="hs-identifier hs-var">modify</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679158370"><a href="#local-6989586621679158370"><span class="hs-identifier">st</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158370"><span class="hs-identifier hs-var">st</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">doHandleExtDecl</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679158369"><span class="hs-identifier hs-var">handler</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-412"></a><span>       </span><a href="#local-6989586621679158368"><span class="hs-identifier hs-var">action</span></a><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158175"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-415"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158174"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-418"></a><span>    </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-419"></a><span>    </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158165"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-422"></a><span>    </span><a name="local-3458764513820541102"><span class="hs-identifier">return</span></a><span> </span><a name="local-6989586621679158166"><a href="#local-6989586621679158166"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-var">Trav</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679158167"><a href="#local-6989586621679158167"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158166"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679158167"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-423"></a><span>    </span><a name="local-6989586621679158168"><a href="#local-6989586621679158168"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621679158169"><a href="#local-6989586621679158169"><span class="hs-identifier">k</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-var">Trav</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679158170"><a href="#local-6989586621679158170"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unTrav</span><span> </span><a href="#local-6989586621679158168"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679158170"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-424"></a><span>                              </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679158171"><a href="#local-6989586621679158171"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679158172"><a href="#local-6989586621679158172"><span class="hs-identifier">s1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTrav</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158169"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679158171"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158172"><span class="hs-identifier hs-var">s1</span></a><span>
</span><a name="line-425"></a><span>                              </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679158173"><a href="#local-6989586621679158173"><span class="hs-identifier">e</span></a></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679158173"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-keyword">instance</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadName"><span class="hs-identifier hs-type">MonadName</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158164"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-428"></a><span>    </span><span class="hs-comment">-- unique name generation</span><span>
</span><a name="line-429"></a><span>    </span><a name="local-8214565720323932996"><a href="Language.C.Analysis.TravMonad.html#genName"><span class="hs-identifier">genName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#generateName"><span class="hs-identifier hs-var">generateName</span></a><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span class="hs-keyword">instance</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadSymtab"><span class="hs-identifier hs-type">MonadSymtab</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158159"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-432"></a><span>    </span><span class="hs-comment">-- symbol table handling</span><span>
</span><a name="line-433"></a><span>    </span><a name="local-8214565720323932993"><a href="Language.C.Analysis.TravMonad.html#getDefTable"><span class="hs-identifier">getDefTable</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#gets"><span class="hs-identifier hs-var">gets</span></a><span> </span><span class="hs-identifier">symbolTable</span><span>
</span><a name="line-434"></a><span>    </span><a name="local-8214565720323932994"><a href="Language.C.Analysis.TravMonad.html#withDefTable"><span class="hs-identifier">withDefTable</span></a></a><span> </span><a name="local-6989586621679158160"><a href="#local-6989586621679158160"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-435"></a><span>        </span><a name="local-6989586621679158161"><a href="#local-6989586621679158161"><span class="hs-identifier">ts</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Language.C.Analysis.TravMonad.html#get"><span class="hs-identifier hs-var">get</span></a><span>
</span><a name="line-436"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679158162"><a href="#local-6989586621679158162"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621679158163"><a href="#local-6989586621679158163"><span class="hs-identifier">symt'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679158160"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">symbolTable</span><span> </span><a href="#local-6989586621679158161"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span>
</span><a name="line-437"></a><span>        </span><a href="Language.C.Analysis.TravMonad.html#put"><span class="hs-identifier hs-var">put</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679158161"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">symbolTable</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679158163"><span class="hs-identifier hs-var">symt'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-438"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679158162"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-keyword">instance</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadCError"><span class="hs-identifier hs-type">MonadCError</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158150"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-441"></a><span>    </span><span class="hs-comment">-- error handling facilities</span><span>
</span><a name="line-442"></a><span>    </span><a name="local-8214565720323932988"><a href="Language.C.Analysis.TravMonad.html#throwTravError"><span class="hs-identifier">throwTravError</span></a></a><span> </span><a name="local-6989586621679158151"><a href="#local-6989586621679158151"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-var">Trav</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-special">(</span><a href="Language.C.Data.Error.html#toError"><span class="hs-identifier hs-var">toError</span></a><span> </span><a href="#local-6989586621679158151"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-443"></a><span>    </span><a name="local-8214565720323932989"><a href="Language.C.Analysis.TravMonad.html#catchTravError"><span class="hs-identifier">catchTravError</span></a></a><span> </span><a name="local-6989586621679158152"><a href="#local-6989586621679158152"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679158153"><a href="#local-6989586621679158153"><span class="hs-identifier">handler</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-var">Trav</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679158154"><a href="#local-6989586621679158154"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">unTrav</span><span> </span><a href="#local-6989586621679158152"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679158154"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-444"></a><span>                                             </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679158155"><a href="#local-6989586621679158155"><span class="hs-identifier">e</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">unTrav</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158153"><span class="hs-identifier hs-var">handler</span></a><span> </span><a href="#local-6989586621679158155"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158154"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-445"></a><span>                                             </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679158156"><a href="#local-6989586621679158156"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679158156"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-446"></a><span>    </span><a name="local-8214565720323932990"><a href="Language.C.Analysis.TravMonad.html#recordError"><span class="hs-identifier">recordError</span></a></a><span> </span><a name="local-6989586621679158157"><a href="#local-6989586621679158157"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#modify"><span class="hs-identifier hs-var">modify</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679158158"><a href="#local-6989586621679158158"><span class="hs-identifier">st</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158158"><span class="hs-identifier hs-var">st</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">rerrors</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">rerrors</span><span> </span><a href="#local-6989586621679158158"><span class="hs-identifier hs-var">st</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><a href="Language.C.Data.RList.html#snoc"><span class="hs-identifier hs-var">snoc</span></a><span class="hs-special">`</span><span> </span><a href="Language.C.Data.Error.html#toError"><span class="hs-identifier hs-var">toError</span></a><span> </span><a href="#local-6989586621679158157"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-447"></a><span>    </span><a name="local-8214565720323932991"><a href="Language.C.Analysis.TravMonad.html#getErrors"><span class="hs-identifier">getErrors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#gets"><span class="hs-identifier hs-var">gets</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Data.RList.html#reverse"><span class="hs-identifier hs-var">RList.reverse</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">rerrors</span><span class="hs-special">)</span><span>
</span><a name="line-448"></a><span>
</span><a name="line-449"></a><span class="hs-keyword">instance</span><span> </span><a href="Language.C.Analysis.TravMonad.html#MonadTrav"><span class="hs-identifier hs-type">MonadTrav</span></a><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158148"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-450"></a><span>    </span><span class="hs-comment">-- handling declarations and definitions</span><span>
</span><a name="line-451"></a><span>    </span><a name="local-8214565720323932986"><a href="Language.C.Analysis.TravMonad.html#handleDecl"><span class="hs-identifier">handleDecl</span></a></a><span> </span><a name="local-6989586621679158149"><a href="#local-6989586621679158149"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679158149"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#gets"><span class="hs-identifier hs-var">gets</span></a><span> </span><span class="hs-identifier">doHandleExtDecl</span><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span class="hs-comment">-- | The variety of the C language to accept. Note: this is not yet enforced.</span><span>
</span><a name="line-454"></a><span class="hs-keyword">data</span><span> </span><a name="CLanguage"><a href="Language.C.Analysis.TravMonad.html#CLanguage"><span class="hs-identifier">CLanguage</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="C89"><a href="Language.C.Analysis.TravMonad.html#C89"><span class="hs-identifier">C89</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="C99"><a href="Language.C.Analysis.TravMonad.html#C99"><span class="hs-identifier">C99</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="GNU89"><a href="Language.C.Analysis.TravMonad.html#GNU89"><span class="hs-identifier">GNU89</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="GNU99"><a href="Language.C.Analysis.TravMonad.html#GNU99"><span class="hs-identifier">GNU99</span></a></a><span>
</span><a name="line-455"></a><span>
</span><a name="line-456"></a><span class="hs-keyword">data</span><span> </span><a name="TravOptions"><a href="Language.C.Analysis.TravMonad.html#TravOptions"><span class="hs-identifier">TravOptions</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-457"></a><span>    </span><a name="TravOptions"><a href="Language.C.Analysis.TravMonad.html#TravOptions"><span class="hs-identifier">TravOptions</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-458"></a><span>        </span><a name="language"><a href="Language.C.Analysis.TravMonad.html#language"><span class="hs-identifier">language</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.TravMonad.html#CLanguage"><span class="hs-identifier hs-type">CLanguage</span></a><span>
</span><a name="line-459"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-460"></a><span>
</span><a name="line-461"></a><span class="hs-keyword">data</span><span> </span><a name="TravState"><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier">TravState</span></a></a><span> </span><a name="local-6989586621679158136"><a href="#local-6989586621679158136"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-462"></a><span>    </span><a name="TravState"><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier">TravState</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-463"></a><span>        </span><a name="symbolTable"><a href="Language.C.Analysis.TravMonad.html#symbolTable"><span class="hs-identifier">symbolTable</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.DefTable.html#DefTable"><span class="hs-identifier hs-type">DefTable</span></a><span class="hs-special">,</span><span>
</span><a name="line-464"></a><span>        </span><a name="rerrors"><a href="Language.C.Analysis.TravMonad.html#rerrors"><span class="hs-identifier">rerrors</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Data.RList.html#RList"><span class="hs-identifier hs-type">RList</span></a><span> </span><a href="Language.C.Data.Error.html#CError"><span class="hs-identifier hs-type">CError</span></a><span class="hs-special">,</span><span>
</span><a name="line-465"></a><span>        </span><a name="nameGenerator"><a href="Language.C.Analysis.TravMonad.html#nameGenerator"><span class="hs-identifier">nameGenerator</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Language.C.Data.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-466"></a><span>        </span><a name="doHandleExtDecl"><a href="Language.C.Analysis.TravMonad.html#doHandleExtDecl"><span class="hs-identifier">doHandleExtDecl</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.SemRep.html#DeclEvent"><span class="hs-identifier hs-type">DeclEvent</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158136"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-467"></a><span>        </span><a name="userState"><a href="Language.C.Analysis.TravMonad.html#userState"><span class="hs-identifier">userState</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679158136"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">,</span><span>
</span><a name="line-468"></a><span>        </span><a name="options"><a href="Language.C.Analysis.TravMonad.html#options"><span class="hs-identifier">options</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.TravMonad.html#TravOptions"><span class="hs-identifier hs-type">TravOptions</span></a><span>
</span><a name="line-469"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-470"></a><span>
</span><a name="line-471"></a><span class="hs-identifier">travErrors</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-type">TravState</span></a><span> </span><a href="#local-6989586621679158193"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Language.C.Data.Error.html#CError"><span class="hs-identifier hs-type">CError</span></a><span class="hs-special">]</span><span>
</span><a name="line-472"></a><a name="travErrors"><a href="Language.C.Analysis.TravMonad.html#travErrors"><span class="hs-identifier">travErrors</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Data.RList.html#reverse"><span class="hs-identifier hs-var">RList.reverse</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">rerrors</span><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span class="hs-identifier">initTravState</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679158192"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-type">TravState</span></a><span> </span><a href="#local-6989586621679158192"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-475"></a><a name="initTravState"><a href="Language.C.Analysis.TravMonad.html#initTravState"><span class="hs-identifier">initTravState</span></a></a><span> </span><a name="local-6989586621679158371"><a href="#local-6989586621679158371"><span class="hs-identifier">userst</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-476"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#TravState"><span class="hs-identifier hs-var">TravState</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-477"></a><span>        </span><span class="hs-identifier">symbolTable</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.DefTable.html#emptyDefTable"><span class="hs-identifier hs-var">emptyDefTable</span></a><span class="hs-special">,</span><span>
</span><a name="line-478"></a><span>        </span><span class="hs-identifier">rerrors</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Data.RList.html#empty"><span class="hs-identifier hs-var">RList.empty</span></a><span class="hs-special">,</span><span>
</span><a name="line-479"></a><span>        </span><span class="hs-identifier">nameGenerator</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Data.Name.html#newNameSupply"><span class="hs-identifier hs-var">newNameSupply</span></a><span class="hs-special">,</span><span>
</span><a name="line-480"></a><span>        </span><span class="hs-identifier">doHandleExtDecl</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-481"></a><span>        </span><span class="hs-identifier">userState</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679158371"><span class="hs-identifier hs-var">userst</span></a><span class="hs-special">,</span><span>
</span><a name="line-482"></a><span>        </span><span class="hs-identifier">options</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#TravOptions"><span class="hs-identifier hs-var">TravOptions</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">language</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#C99"><span class="hs-identifier hs-var">C99</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-483"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-comment">-- * Trav specific operations</span><span>
</span><a name="line-486"></a><span class="hs-identifier">modifyUserState</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158191"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158191"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158191"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-487"></a><a name="modifyUserState"><a href="Language.C.Analysis.TravMonad.html#modifyUserState"><span class="hs-identifier">modifyUserState</span></a></a><span> </span><a name="local-6989586621679158372"><a href="#local-6989586621679158372"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#modify"><span class="hs-identifier hs-var">modify</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679158373"><a href="#local-6989586621679158373"><span class="hs-identifier">ts</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158373"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">userState</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679158372"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">userState</span><span> </span><a href="#local-6989586621679158373"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-488"></a><span>
</span><a name="line-489"></a><span class="hs-identifier">getUserState</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158190"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679158190"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-490"></a><a name="getUserState"><a href="Language.C.Analysis.TravMonad.html#getUserState"><span class="hs-identifier">getUserState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">userState</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">liftM</span><span class="hs-special">`</span><span> </span><a href="Language.C.Analysis.TravMonad.html#get"><span class="hs-identifier hs-var">get</span></a><span>
</span><a name="line-491"></a><span>
</span><a name="line-492"></a><span class="hs-identifier">modifyOptions</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Language.C.Analysis.TravMonad.html#TravOptions"><span class="hs-identifier hs-type">TravOptions</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#TravOptions"><span class="hs-identifier hs-type">TravOptions</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158189"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-493"></a><a name="modifyOptions"><a href="Language.C.Analysis.TravMonad.html#modifyOptions"><span class="hs-identifier">modifyOptions</span></a></a><span> </span><a name="local-6989586621679158374"><a href="#local-6989586621679158374"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Language.C.Analysis.TravMonad.html#modify"><span class="hs-identifier hs-var">modify</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679158375"><a href="#local-6989586621679158375"><span class="hs-identifier">ts</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158375"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">options</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679158374"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">options</span><span> </span><a href="#local-6989586621679158375"><span class="hs-identifier hs-var">ts</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-494"></a><span>
</span><a name="line-495"></a><span class="hs-identifier">generateName</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Language.C.Analysis.TravMonad.html#Trav"><span class="hs-identifier hs-type">Trav</span></a><span> </span><a href="#local-6989586621679158188"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="Language.C.Data.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-496"></a><a name="generateName"><a href="Language.C.Analysis.TravMonad.html#generateName"><span class="hs-identifier">generateName</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-497"></a><span>    </span><a href="Language.C.Analysis.TravMonad.html#get"><span class="hs-identifier hs-var">get</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679158376"><a href="#local-6989586621679158376"><span class="hs-identifier">ts</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-498"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679158377"><a href="#local-6989586621679158377"><span class="hs-identifier">new_name</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679158378"><a href="#local-6989586621679158378"><span class="hs-identifier">gen'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">nameGenerator</span><span> </span><a href="#local-6989586621679158376"><span class="hs-identifier hs-var">ts</span></a><span>
</span><a name="line-499"></a><span>       </span><a href="Language.C.Analysis.TravMonad.html#put"><span class="hs-identifier hs-var">put</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679158376"><span class="hs-identifier hs-var">ts</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">nameGenerator</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679158378"><span class="hs-identifier hs-var">gen'</span></a><span class="hs-special">}</span><span>
</span><a name="line-500"></a><span>       </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679158377"><span class="hs-identifier hs-var">new_name</span></a><span>
</span><a name="line-501"></a><span>
</span><a name="line-502"></a><span class="hs-comment">-- * helpers</span><span>
</span><a name="line-503"></a><span class="hs-identifier">mapMaybeM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679158185"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679158186"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158186"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158185"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679158187"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158185"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679158187"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-504"></a><a name="mapMaybeM"><a href="Language.C.Analysis.TravMonad.html#mapMaybeM"><span class="hs-identifier">mapMaybeM</span></a></a><span> </span><a name="local-6989586621679158379"><a href="#local-6989586621679158379"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679158380"><a href="#local-6989586621679158380"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679158380"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158379"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-505"></a><span>
</span><a name="line-506"></a><span class="hs-identifier">maybeM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679158183"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679158184"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158184"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158183"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158183"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-507"></a><a name="maybeM"><a href="Language.C.Analysis.TravMonad.html#maybeM"><span class="hs-identifier">maybeM</span></a></a><span> </span><a name="local-6989586621679158381"><a href="#local-6989586621679158381"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679158382"><a href="#local-6989586621679158382"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158382"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679158381"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-508"></a><span>
</span><a name="line-509"></a><span class="hs-identifier">mapSndM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679158179"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158180"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158179"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679158181"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158182"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679158180"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158179"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158182"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679158181"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-510"></a><a name="mapSndM"><a href="Language.C.Analysis.TravMonad.html#mapSndM"><span class="hs-identifier">mapSndM</span></a></a><span> </span><a name="local-6989586621679158383"><a href="#local-6989586621679158383"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679158384"><a href="#local-6989586621679158384"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679158385"><a href="#local-6989586621679158385"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679158384"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158383"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679158385"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span class="hs-identifier">concatMapM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679158176"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679158177"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158176"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679158178"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679158177"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679158176"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679158178"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">]</span><span>
</span><a name="line-513"></a><a name="concatMapM"><a href="Language.C.Analysis.TravMonad.html#concatMapM"><span class="hs-identifier">concatMapM</span></a></a><span> </span><a name="local-6989586621679158386"><a href="#local-6989586621679158386"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679158386"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-514"></a></pre></body></html>