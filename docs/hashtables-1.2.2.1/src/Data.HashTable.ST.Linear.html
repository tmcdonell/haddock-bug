<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE CPP          #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE MagicHash    #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes   #-}</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-comment">{-| An implementation of linear hash tables. (See
&lt;http://en.wikipedia.org/wiki/Linear_hashing&gt;). Use this hash table if you...

  * don't care that inserts and lookups are slower than the other hash table
    implementations in this collection (this one is slightly faster than
    @Data.HashTable@ from the base library in most cases)

  * have a soft real-time or interactive application for which the risk of
    introducing a long pause on insert while all of the keys are rehashed is
    unacceptable.


/Details:/

Linear hashing allows for the expansion of the hash table one slot at a time,
by moving a \&quot;split\&quot; pointer across an array of pointers to buckets. The
number of buckets is always a power of two, and the bucket to look in is
defined as:

@
bucket(level,key) = hash(key) mod (2^level)
@

The \&quot;split pointer\&quot; controls the expansion of the hash table. If the hash
table is at level @k@ (i.e. @2^k@ buckets have been allocated), we first
calculate @b=bucket(level-1,key)@. If @b &lt; splitptr@, the destination bucket is
calculated as @b'=bucket(level,key)@, otherwise the original value @b@ is used.

The split pointer is incremented once an insert causes some bucket to become
fuller than some predetermined threshold; the bucket at the split pointer
(*not* the bucket which triggered the split!) is then rehashed, and half of its
keys can be expected to be rehashed into the upper half of the table.

When the split pointer reaches the middle of the bucket array, the size of the
bucket array is doubled, the level increases, and the split pointer is reset to
zero.

Linear hashing, although not quite as fast for inserts or lookups as the
implementation of linear probing included in this package, is well suited for
interactive applications because it has much better worst case behaviour on
inserts. Other hash table implementations can suffer from long pauses, because
it is occasionally necessary to rehash all of the keys when the table grows.
Linear hashing, on the other hand, only ever rehashes a bounded (effectively
constant) number of keys when an insert forces a bucket split.

/Space overhead: experimental results/

In randomized testing (see @test\/compute-overhead\/ComputeOverhead.hs@ in the
source distribution), mean overhead is approximately 1.51 machine words per
key-value mapping with a very low standard deviation of about 0.06 words, 1.60
words per mapping at the 95th percentile.

/Unsafe tricks/

Then the @unsafe-tricks@ flag is on when this package is built (and it is on by
default), we use some unsafe tricks (namely 'unsafeCoerce#' and
'reallyUnsafePtrEquality#') to save indirections in this table. These
techniques rely on assumptions about the behaviour of the GHC runtime system
and, although they've been tested and should be safe under normal conditions,
are slightly dangerous. Caveat emptor. In particular, these techniques are
incompatible with HPC code coverage reports.


References:

  * W. Litwin. Linear hashing: a new tool for file and table addressing. In
    /Proc. 6th International Conference on Very Large Data Bases, Volume 6/,
    pp. 212-223, 1980.

  * P-A. Larson. Dynamic hash tables. /Communications of the ACM/ 31:
    446-457, 1988.
-}</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.HashTable.ST.Linear</span><span>
</span><a name="line-80"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span>
</span><a name="line-81"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Linear.html#new"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-82"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Linear.html#newSized"><span class="hs-identifier hs-var">newSized</span></a><span>
</span><a name="line-83"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Linear.html#delete"><span class="hs-identifier hs-var">delete</span></a><span>
</span><a name="line-84"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Linear.html#lookup"><span class="hs-identifier hs-var">lookup</span></a><span>
</span><a name="line-85"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Linear.html#insert"><span class="hs-identifier hs-var">insert</span></a><span>
</span><a name="line-86"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Linear.html#mutate"><span class="hs-identifier hs-var">mutate</span></a><span>
</span><a name="line-87"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Linear.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span>
</span><a name="line-88"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Linear.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span>
</span><a name="line-89"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Linear.html#computeOverhead"><span class="hs-identifier hs-var">computeOverhead</span></a><span>
</span><a name="line-90"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad</span><span>                         </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.ST</span><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Bits</span><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Hashable</span><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.STRef</span><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Prelude</span><span>                               </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.HashTable.Class.html"><span class="hs-identifier">Data.HashTable.Class</span></a><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C</span><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.HashTable.Internal.Array.html"><span class="hs-identifier">Data.HashTable.Internal.Array</span></a><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.HashTable.Internal.Linear.Bucket.html"><span class="hs-identifier">Data.HashTable.Internal.Linear.Bucket</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.Internal.Linear.Bucket.html#Bucket"><span class="hs-identifier hs-type">Bucket</span></a><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html"><span class="hs-identifier">Data.HashTable.Internal.Linear.Bucket</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Bucket</span><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.HashTable.Internal.Utils.html"><span class="hs-identifier">Data.HashTable.Internal.Utils</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-cpp">#ifdef DEBUG
</span><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">System.IO</span><span>
</span><a name="line-108"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-112"></a><span class="hs-comment">-- | A linear hash table.</span><span>
</span><a name="line-113"></a><span class="hs-keyword">newtype</span><span> </span><a name="HashTable"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier">HashTable</span></a></a><span> </span><a name="local-6989586621679079856"><a href="#local-6989586621679079856"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679079857"><a href="#local-6989586621679079857"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679079858"><a href="#local-6989586621679079858"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="HT"><a href="Data.HashTable.ST.Linear.html#HT"><span class="hs-identifier">HT</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">STRef</span><span> </span><a href="#local-6989586621679079856"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679079856"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079857"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079858"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-keyword">data</span><span> </span><a name="HashTable_"><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier">HashTable_</span></a></a><span> </span><a name="local-6989586621679079853"><a href="#local-6989586621679079853"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679079854"><a href="#local-6989586621679079854"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679079855"><a href="#local-6989586621679079855"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="HashTable"><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier">HashTable</span></a></a><span>
</span><a name="line-116"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="_level"><a href="Data.HashTable.ST.Linear.html#_level"><span class="hs-identifier">_level</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-117"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_splitptr"><a href="Data.HashTable.ST.Linear.html#_splitptr"><span class="hs-identifier">_splitptr</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_buckets"><a href="Data.HashTable.ST.Linear.html#_buckets"><span class="hs-identifier">_buckets</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">MutableArray</span><span> </span><a href="#local-6989586621679079853"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.Internal.Linear.Bucket.html#Bucket"><span class="hs-identifier hs-type">Bucket</span></a><span> </span><a href="#local-6989586621679079853"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079854"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079855"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-123"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.HashTable.Class.html#HashTable"><span class="hs-identifier hs-type">C.HashTable</span></a><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-124"></a><span>    </span><a name="local-8214565720323798505"><a href="Data.HashTable.Class.html#new"><span class="hs-identifier">new</span></a></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#new"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-125"></a><span>    </span><a name="local-8214565720323798506"><a href="Data.HashTable.Class.html#newSized"><span class="hs-identifier">newSized</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#newSized"><span class="hs-identifier hs-var">newSized</span></a><span>
</span><a name="line-126"></a><span>    </span><a name="local-8214565720323798508"><a href="Data.HashTable.Class.html#insert"><span class="hs-identifier">insert</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#insert"><span class="hs-identifier hs-var">insert</span></a><span>
</span><a name="line-127"></a><span>    </span><a name="local-8214565720323798509"><a href="Data.HashTable.Class.html#delete"><span class="hs-identifier">delete</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#delete"><span class="hs-identifier hs-var">delete</span></a><span>
</span><a name="line-128"></a><span>    </span><a name="local-8214565720323798510"><a href="Data.HashTable.Class.html#lookup"><span class="hs-identifier">lookup</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#lookup"><span class="hs-identifier hs-var">lookup</span></a><span>
</span><a name="line-129"></a><span>    </span><a name="local-8214565720323798511"><a href="Data.HashTable.Class.html#foldM"><span class="hs-identifier">foldM</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span>
</span><a name="line-130"></a><span>    </span><a name="local-8214565720323798512"><a href="Data.HashTable.Class.html#mapM_"><span class="hs-identifier">mapM_</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span>
</span><a name="line-131"></a><span>    </span><a name="local-8214565720323798513"><a href="Data.HashTable.Class.html#lookupIndex"><span class="hs-identifier">lookupIndex</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#lookupIndex"><span class="hs-identifier hs-var">lookupIndex</span></a><span>
</span><a name="line-132"></a><span>    </span><a name="local-8214565720323798514"><a href="Data.HashTable.Class.html#nextByIndex"><span class="hs-identifier">nextByIndex</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#nextByIndex"><span class="hs-identifier hs-var">nextByIndex</span></a><span>
</span><a name="line-133"></a><span>    </span><a name="local-8214565720323798515"><a href="Data.HashTable.Class.html#computeOverhead"><span class="hs-identifier">computeOverhead</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#computeOverhead"><span class="hs-identifier hs-var">computeOverhead</span></a><span>
</span><a name="line-134"></a><span>    </span><a name="local-8214565720323798507"><a href="Data.HashTable.Class.html#mutate"><span class="hs-identifier">mutate</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#mutate"><span class="hs-identifier hs-var">mutate</span></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-138"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079859"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079860"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079861"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-139"></a><span>    </span><a name="local-8214565720323789997"><span class="hs-identifier">show</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;HashTable&gt;&quot;</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:new&quot;.</span><span>
</span><a name="line-145"></a><span class="hs-identifier">new</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079919"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079919"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079920"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079921"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-146"></a><a name="new"><a href="Data.HashTable.ST.Linear.html#new"><span class="hs-identifier">new</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-147"></a><span>    </span><a name="local-6989586621679079922"><a href="#local-6989586621679079922"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#newBucketArray"><span class="hs-identifier hs-var">Bucket.newBucketArray</span></a><span> </span><span class="hs-number">2</span><span>
</span><a name="line-148"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#newRef"><span class="hs-identifier hs-var">newRef</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679079922"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:newSized&quot;.</span><span>
</span><a name="line-154"></a><span class="hs-identifier">newSized</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079916"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079916"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079917"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079918"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-155"></a><a name="newSized"><a href="Data.HashTable.ST.Linear.html#newSized"><span class="hs-identifier">newSized</span></a></a><span> </span><a name="local-6989586621679079923"><a href="#local-6989586621679079923"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-156"></a><span>    </span><a name="local-6989586621679079927"><a href="#local-6989586621679079927"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#newBucketArray"><span class="hs-identifier hs-var">Bucket.newBucketArray</span></a><span> </span><a href="#local-6989586621679079926"><span class="hs-identifier hs-var">sz</span></a><span>
</span><a name="line-157"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#newRef"><span class="hs-identifier hs-var">newRef</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a href="#local-6989586621679079925"><span class="hs-identifier hs-var">lvl</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679079927"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-160"></a><span>    </span><a name="local-6989586621679079924"><a href="#local-6989586621679079924"><span class="hs-identifier">k</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ceiling</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679079923"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="Data.HashTable.ST.Linear.html#fillFactor"><span class="hs-identifier hs-var">fillFactor</span></a><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="Data.HashTable.ST.Linear.html#bucketSplitSize"><span class="hs-identifier hs-var">bucketSplitSize</span></a><span class="hs-special">)</span><span>
</span><a name="line-161"></a><span>    </span><a name="local-6989586621679079925"><a href="#local-6989586621679079925"><span class="hs-identifier">lvl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.HashTable.Internal.Utils.html#log2"><span class="hs-identifier hs-var">log2</span></a><span> </span><a href="#local-6989586621679079924"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span>    </span><a name="local-6989586621679079926"><a href="#local-6989586621679079926"><span class="hs-identifier">sz</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a><span> </span><a href="#local-6989586621679079925"><span class="hs-identifier hs-var">lvl</span></a><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:delete&quot;.</span><span>
</span><a name="line-169"></a><span class="hs-identifier">delete</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679079913"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679079913"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-170"></a><span>          </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079914"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079913"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079915"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079913"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-172"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079914"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-173"></a><a name="delete"><a href="Data.HashTable.ST.Linear.html#delete"><span class="hs-identifier">delete</span></a></a><span> </span><a name="local-6989586621679079928"><a href="#local-6989586621679079928"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679079929"><a href="#local-6989586621679079929"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679079928"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679079930"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-174"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-175"></a><span>    </span><a name="local-6989586621679079930"><a href="#local-6989586621679079930"><span class="hs-identifier">work</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679079931"><a href="#local-6989586621679079931"><span class="hs-identifier">lvl</span></a></a><span> </span><a name="local-6989586621679079932"><a href="#local-6989586621679079932"><span class="hs-identifier">splitptr</span></a></a><span> </span><a name="local-6989586621679079933"><a href="#local-6989586621679079933"><span class="hs-identifier">buckets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-176"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679079934"><a href="#local-6989586621679079934"><span class="hs-identifier">h0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a><span> </span><a href="#local-6989586621679079931"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="#local-6989586621679079932"><span class="hs-identifier hs-var">splitptr</span></a><span> </span><a href="#local-6989586621679079929"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-177"></a><span>        </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;delete: size=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a><span> </span><a href="#local-6989586621679079931"><span class="hs-identifier hs-var">lvl</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;, h0=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679079934"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-178"></a><span>                  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;splitptr: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679079932"><span class="hs-identifier hs-var">splitptr</span></a><span>
</span><a name="line-179"></a><span>        </span><a href="Data.HashTable.ST.Linear.html#delete%27"><span class="hs-identifier hs-var">delete'</span></a><span> </span><a href="#local-6989586621679079933"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679079934"><span class="hs-identifier hs-var">h0</span></a><span> </span><a href="#local-6989586621679079929"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-180"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">delete</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-181"></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-185"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:lookup&quot;.</span><span>
</span><a name="line-186"></a><span class="hs-identifier">lookup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679079910"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679079910"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079911"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079910"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079912"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079910"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079911"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679079912"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-187"></a><a name="lookup"><a href="Data.HashTable.ST.Linear.html#lookup"><span class="hs-identifier">lookup</span></a></a><span> </span><a name="local-6989586621679079935"><a href="#local-6989586621679079935"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679079936"><a href="#local-6989586621679079936"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679079935"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679079937"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-188"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-189"></a><span>    </span><a name="local-6989586621679079937"><a href="#local-6989586621679079937"><span class="hs-identifier">work</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679079938"><a href="#local-6989586621679079938"><span class="hs-identifier">lvl</span></a></a><span> </span><a name="local-6989586621679079939"><a href="#local-6989586621679079939"><span class="hs-identifier">splitptr</span></a></a><span> </span><a name="local-6989586621679079940"><a href="#local-6989586621679079940"><span class="hs-identifier">buckets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-190"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679079941"><a href="#local-6989586621679079941"><span class="hs-identifier">h0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a><span> </span><a href="#local-6989586621679079938"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="#local-6989586621679079939"><span class="hs-identifier hs-var">splitptr</span></a><span> </span><a href="#local-6989586621679079936"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-191"></a><span>        </span><a name="local-6989586621679079942"><a href="#local-6989586621679079942"><span class="hs-identifier">bucket</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679079940"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679079941"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-192"></a><span>        </span><a href="Data.HashTable.Internal.Linear.Bucket.html#lookup"><span class="hs-identifier hs-var">Bucket.lookup</span></a><span> </span><a href="#local-6989586621679079942"><span class="hs-identifier hs-var">bucket</span></a><span> </span><a href="#local-6989586621679079936"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-193"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">lookup</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span>
</span><a name="line-196"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-197"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-198"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:insert&quot;.</span><span>
</span><a name="line-199"></a><span class="hs-identifier">insert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679079907"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679079907"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-200"></a><span>          </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079908"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079907"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079909"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079907"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-202"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079909"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-203"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079908"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><a name="insert"><a href="Data.HashTable.ST.Linear.html#insert"><span class="hs-identifier">insert</span></a></a><span> </span><a name="local-6989586621679079943"><a href="#local-6989586621679079943"><span class="hs-identifier">htRef</span></a></a><span> </span><a name="local-6989586621679079944"><a href="#local-6989586621679079944"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679079945"><a href="#local-6989586621679079945"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-205"></a><span>    </span><a name="local-6989586621679079954"><a href="#local-6989586621679079954"><span class="hs-identifier">ht'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679079943"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679079946"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-206"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#writeRef"><span class="hs-identifier hs-var">writeRef</span></a><span> </span><a href="#local-6989586621679079943"><span class="hs-identifier hs-var">htRef</span></a><span> </span><a href="#local-6989586621679079954"><span class="hs-identifier hs-var">ht'</span></a><span>
</span><a name="line-207"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-208"></a><span>    </span><a name="local-6989586621679079946"><a href="#local-6989586621679079946"><span class="hs-identifier">work</span></a></a><span> </span><a name="local-6989586621679079947"><a href="#local-6989586621679079947"><span class="hs-identifier">ht</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679079948"><a href="#local-6989586621679079948"><span class="hs-identifier">lvl</span></a></a><span> </span><a name="local-6989586621679079949"><a href="#local-6989586621679079949"><span class="hs-identifier">splitptr</span></a></a><span> </span><a name="local-6989586621679079950"><a href="#local-6989586621679079950"><span class="hs-identifier">buckets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-209"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679079951"><a href="#local-6989586621679079951"><span class="hs-identifier">h0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a><span> </span><a href="#local-6989586621679079948"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="#local-6989586621679079949"><span class="hs-identifier hs-var">splitptr</span></a><span> </span><a href="#local-6989586621679079944"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-210"></a><span>        </span><a href="Data.HashTable.ST.Linear.html#delete%27"><span class="hs-identifier hs-var">delete'</span></a><span> </span><a href="#local-6989586621679079950"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679079951"><span class="hs-identifier hs-var">h0</span></a><span> </span><a href="#local-6989586621679079944"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-211"></a><span>        </span><a name="local-6989586621679079952"><a href="#local-6989586621679079952"><span class="hs-identifier">bsz</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Linear.html#primitiveInsert%27"><span class="hs-identifier hs-var">primitiveInsert'</span></a><span> </span><a href="#local-6989586621679079950"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679079951"><span class="hs-identifier hs-var">h0</span></a><span> </span><a href="#local-6989586621679079944"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679079945"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="Data.HashTable.ST.Linear.html#checkOverflow"><span class="hs-identifier hs-var">checkOverflow</span></a><span> </span><a href="#local-6989586621679079952"><span class="hs-identifier hs-var">bsz</span></a><span>
</span><a name="line-214"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-215"></a><span>            </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;insert: splitting&quot;</span><span>
</span><a name="line-216"></a><span>            </span><a name="local-6989586621679079953"><a href="#local-6989586621679079953"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Linear.html#split"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621679079947"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-217"></a><span>            </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;insert: done splitting&quot;</span><span>
</span><a name="line-218"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679079953"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-219"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-220"></a><span>            </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;insert: done&quot;</span><span>
</span><a name="line-221"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679079947"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-222"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">insert</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-226"></a><span class="hs-identifier">mutate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679079903"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679079903"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-227"></a><span>          </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079904"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079903"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079905"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079903"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-229"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679079905"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679079905"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679079906"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079904"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079906"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-231"></a><a name="mutate"><a href="Data.HashTable.ST.Linear.html#mutate"><span class="hs-identifier">mutate</span></a></a><span> </span><a name="local-6989586621679079955"><a href="#local-6989586621679079955"><span class="hs-identifier">htRef</span></a></a><span> </span><a name="local-6989586621679079956"><a href="#local-6989586621679079956"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679079957"><a href="#local-6989586621679079957"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-232"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679079969"><a href="#local-6989586621679079969"><span class="hs-identifier">ht</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679079970"><a href="#local-6989586621679079970"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679079955"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679079958"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-233"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#writeRef"><span class="hs-identifier hs-var">writeRef</span></a><span> </span><a href="#local-6989586621679079955"><span class="hs-identifier hs-var">htRef</span></a><span> </span><a href="#local-6989586621679079969"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-234"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679079970"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-235"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-236"></a><span>    </span><a name="local-6989586621679079958"><a href="#local-6989586621679079958"><span class="hs-identifier">work</span></a></a><span> </span><a name="local-6989586621679079959"><a href="#local-6989586621679079959"><span class="hs-identifier">ht</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679079960"><a href="#local-6989586621679079960"><span class="hs-identifier">lvl</span></a></a><span> </span><a name="local-6989586621679079961"><a href="#local-6989586621679079961"><span class="hs-identifier">splitptr</span></a></a><span> </span><a name="local-6989586621679079962"><a href="#local-6989586621679079962"><span class="hs-identifier">buckets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-237"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679079963"><a href="#local-6989586621679079963"><span class="hs-identifier">h0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a><span> </span><a href="#local-6989586621679079960"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="#local-6989586621679079961"><span class="hs-identifier hs-var">splitptr</span></a><span> </span><a href="#local-6989586621679079956"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-238"></a><span>        </span><a name="local-6989586621679079964"><a href="#local-6989586621679079964"><span class="hs-identifier">bucket</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679079962"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679079963"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-239"></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">!</span><a name="local-6989586621679079965"><a href="#local-6989586621679079965"><span class="hs-identifier">bsz</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679079966"><a href="#local-6989586621679079966"><span class="hs-identifier">mbk</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679079967"><a href="#local-6989586621679079967"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#mutate"><span class="hs-identifier hs-var">Bucket.mutate</span></a><span> </span><a href="#local-6989586621679079964"><span class="hs-identifier hs-var">bucket</span></a><span> </span><a href="#local-6989586621679079956"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679079957"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-240"></a><span>        </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-241"></a><span>              </span><span class="hs-special">(</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a><span> </span><a href="#local-6989586621679079962"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679079963"><span class="hs-identifier hs-var">h0</span></a><span class="hs-special">)</span><span>
</span><a name="line-242"></a><span>              </span><a href="#local-6989586621679079966"><span class="hs-identifier hs-var">mbk</span></a><span>
</span><a name="line-243"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="Data.HashTable.ST.Linear.html#checkOverflow"><span class="hs-identifier hs-var">checkOverflow</span></a><span> </span><a href="#local-6989586621679079965"><span class="hs-identifier hs-var">bsz</span></a><span>
</span><a name="line-244"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-245"></a><span>            </span><a name="local-6989586621679079968"><a href="#local-6989586621679079968"><span class="hs-identifier">ht'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Linear.html#split"><span class="hs-identifier hs-var">split</span></a><span> </span><a href="#local-6989586621679079959"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-246"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679079968"><span class="hs-identifier hs-var">ht'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679079967"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679079959"><span class="hs-identifier hs-var">ht</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679079967"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-251"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-252"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:mapM_&quot;.</span><span>
</span><a name="line-253"></a><span class="hs-identifier">mapM_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679079899"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><a href="#local-6989586621679079900"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079901"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079902"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079901"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079899"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079900"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079901"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-254"></a><a name="mapM_"><a href="Data.HashTable.ST.Linear.html#mapM_"><span class="hs-identifier">mapM_</span></a></a><span> </span><a name="local-6989586621679079971"><a href="#local-6989586621679079971"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679079972"><a href="#local-6989586621679079972"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679079972"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679079973"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-255"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-256"></a><span>    </span><a name="local-6989586621679079973"><a href="#local-6989586621679079973"><span class="hs-identifier">work</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679079974"><a href="#local-6989586621679079974"><span class="hs-identifier">lvl</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679079975"><a href="#local-6989586621679079975"><span class="hs-identifier">buckets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679079977"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-257"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-258"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679079976"><a href="#local-6989586621679079976"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a><span> </span><a href="#local-6989586621679079974"><span class="hs-identifier hs-var">lvl</span></a><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span>        </span><a name="local-6989586621679079977"><a href="#local-6989586621679079977"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679079978"><a href="#local-6989586621679079978"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679079978"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679079976"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-261"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-262"></a><span>            </span><a name="local-6989586621679079979"><a href="#local-6989586621679079979"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679079975"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679079978"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-263"></a><span>            </span><a href="Data.HashTable.Internal.Linear.Bucket.html#mapM_"><span class="hs-identifier hs-var">Bucket.mapM_</span></a><span> </span><a href="#local-6989586621679079971"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679079979"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-264"></a><span>            </span><a href="#local-6989586621679079977"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679079978"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-268"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-269"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:foldM&quot;.</span><span>
</span><a name="line-270"></a><span class="hs-identifier">foldM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679079895"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679079896"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><a href="#local-6989586621679079897"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079898"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079895"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079895"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079898"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079896"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079897"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-272"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079898"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079895"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-273"></a><a name="foldM"><a href="Data.HashTable.ST.Linear.html#foldM"><span class="hs-identifier">foldM</span></a></a><span> </span><a name="local-6989586621679079980"><a href="#local-6989586621679079980"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679079981"><a href="#local-6989586621679079981"><span class="hs-identifier">seed0</span></a></a><span> </span><a name="local-6989586621679079982"><a href="#local-6989586621679079982"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679079982"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679079983"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-274"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-275"></a><span>    </span><a name="local-6989586621679079983"><a href="#local-6989586621679079983"><span class="hs-identifier">work</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679079984"><a href="#local-6989586621679079984"><span class="hs-identifier">lvl</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679079985"><a href="#local-6989586621679079985"><span class="hs-identifier">buckets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679079987"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679079981"><span class="hs-identifier hs-var">seed0</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-276"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-277"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679079986"><a href="#local-6989586621679079986"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a><span> </span><a href="#local-6989586621679079984"><span class="hs-identifier hs-var">lvl</span></a><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span>        </span><a name="local-6989586621679079987"><a href="#local-6989586621679079987"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679079988"><a href="#local-6989586621679079988"><span class="hs-identifier">seed</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679079989"><a href="#local-6989586621679079989"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679079989"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679079986"><span class="hs-identifier hs-var">sz</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679079988"><span class="hs-identifier hs-var">seed</span></a><span>
</span><a name="line-280"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-281"></a><span>            </span><a name="local-6989586621679079990"><a href="#local-6989586621679079990"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679079985"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679079989"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-282"></a><span>            </span><span class="hs-glyph">!</span><a name="local-6989586621679079991"><a href="#local-6989586621679079991"><span class="hs-identifier">seed'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#foldM"><span class="hs-identifier hs-var">Bucket.foldM</span></a><span> </span><a href="#local-6989586621679079980"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679079988"><span class="hs-identifier hs-var">seed</span></a><span> </span><a href="#local-6989586621679079990"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-283"></a><span>            </span><a href="#local-6989586621679079987"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679079991"><span class="hs-identifier hs-var">seed'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679079989"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:computeOverhead&quot;.</span><span>
</span><a name="line-289"></a><span class="hs-identifier">computeOverhead</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079892"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079893"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079894"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079892"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-290"></a><a name="computeOverhead"><a href="Data.HashTable.ST.Linear.html#computeOverhead"><span class="hs-identifier">computeOverhead</span></a></a><span> </span><a name="local-6989586621679079992"><a href="#local-6989586621679079992"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679079992"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679079993"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-291"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-292"></a><span>    </span><a name="local-6989586621679079993"><a href="#local-6989586621679079993"><span class="hs-identifier">work</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679079994"><a href="#local-6989586621679079994"><span class="hs-identifier">lvl</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679079995"><a href="#local-6989586621679079995"><span class="hs-identifier">buckets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-293"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679080007"><a href="#local-6989586621679080007"><span class="hs-identifier">totElems</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679080008"><a href="#local-6989586621679080008"><span class="hs-identifier">overhead</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679079998"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080009"><a href="#local-6989586621679080009"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679080007"><span class="hs-identifier hs-var">totElems</span></a><span>
</span><a name="line-296"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080010"><a href="#local-6989586621679080010"><span class="hs-identifier">o</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679080008"><span class="hs-identifier hs-var">overhead</span></a><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679079997"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679079996"><span class="hs-identifier hs-var">constOverhead</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679080010"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><a href="#local-6989586621679080009"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-301"></a><span>        </span><a name="local-6989586621679079996"><a href="#local-6989586621679079996"><span class="hs-identifier">constOverhead</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">5.0</span><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679079997"><a href="#local-6989586621679079997"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a><span> </span><a href="#local-6989586621679079994"><span class="hs-identifier hs-var">lvl</span></a><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span>        </span><a name="local-6989586621679079998"><a href="#local-6989586621679079998"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679079999"><a href="#local-6989586621679079999"><span class="hs-identifier">nelems</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080000"><a href="#local-6989586621679080000"><span class="hs-identifier">overhead</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080001"><a href="#local-6989586621679080001"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679080001"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679079997"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679079999"><span class="hs-identifier hs-var">nelems</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679080000"><span class="hs-identifier hs-var">overhead</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>                                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-307"></a><span>            </span><a name="local-6989586621679080002"><a href="#local-6989586621679080002"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679079995"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679080001"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-308"></a><span>            </span><span class="hs-special">(</span><span class="hs-glyph">!</span><a name="local-6989586621679080003"><a href="#local-6989586621679080003"><span class="hs-identifier">n</span></a></a><span class="hs-special">,</span><span class="hs-glyph">!</span><a name="local-6989586621679080004"><a href="#local-6989586621679080004"><span class="hs-identifier">o</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#nelemsAndOverheadInWords"><span class="hs-identifier hs-var">Bucket.nelemsAndOverheadInWords</span></a><span> </span><a href="#local-6989586621679080002"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-309"></a><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080005"><a href="#local-6989586621679080005"><span class="hs-identifier">n'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080003"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679079999"><span class="hs-identifier hs-var">nelems</span></a><span>
</span><a name="line-310"></a><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080006"><a href="#local-6989586621679080006"><span class="hs-identifier">o'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080004"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679080000"><span class="hs-identifier hs-var">overhead</span></a><span>
</span><a name="line-311"></a><span>
</span><a name="line-312"></a><span>            </span><a href="#local-6989586621679079998"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679080005"><span class="hs-identifier hs-var">n'</span></a><span> </span><a href="#local-6989586621679080006"><span class="hs-identifier hs-var">o'</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080001"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span>
</span><a name="line-315"></a><span class="hs-comment">------------------------------</span><span>
</span><a name="line-316"></a><span class="hs-comment">-- Private functions follow --</span><span>
</span><a name="line-317"></a><span class="hs-comment">------------------------------</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-320"></a><span class="hs-identifier">delete'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679079889"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-321"></a><span>           </span><span class="hs-identifier hs-type">MutableArray</span><span> </span><a href="#local-6989586621679079890"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.Internal.Linear.Bucket.html#Bucket"><span class="hs-identifier hs-type">Bucket</span></a><span> </span><a href="#local-6989586621679079890"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079889"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079891"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-322"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-323"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079889"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-324"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079890"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-325"></a><a name="delete%27"><a href="Data.HashTable.ST.Linear.html#delete%27"><span class="hs-identifier">delete'</span></a></a><span> </span><a name="local-6989586621679080011"><a href="#local-6989586621679080011"><span class="hs-identifier">buckets</span></a></a><span> </span><a name="local-6989586621679080012"><a href="#local-6989586621679080012"><span class="hs-identifier">h0</span></a></a><span> </span><a name="local-6989586621679080013"><a href="#local-6989586621679080013"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-326"></a><span>    </span><a name="local-6989586621679080014"><a href="#local-6989586621679080014"><span class="hs-identifier">bucket</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679080011"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679080012"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-327"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#delete"><span class="hs-identifier hs-var">Bucket.delete</span></a><span> </span><a href="#local-6989586621679080014"><span class="hs-identifier hs-var">bucket</span></a><span> </span><a href="#local-6989586621679080013"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-328"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-329"></a><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-332"></a><span class="hs-identifier">split</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679079886"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-333"></a><span>         </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679079887"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079886"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079888"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079887"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679079887"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079886"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079888"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-335"></a><a name="split"><a href="Data.HashTable.ST.Linear.html#split"><span class="hs-identifier">split</span></a></a><span> </span><a name="local-6989586621679080015"><a href="#local-6989586621679080015"><span class="hs-identifier">ht</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679080016"><a href="#local-6989586621679080016"><span class="hs-identifier">lvl</span></a></a><span> </span><a name="local-6989586621679080017"><a href="#local-6989586621679080017"><span class="hs-identifier">splitptr</span></a></a><span> </span><a name="local-6989586621679080018"><a href="#local-6989586621679080018"><span class="hs-identifier">buckets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-336"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;split: start: nbuck=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a><span> </span><a href="#local-6989586621679080016"><span class="hs-identifier hs-var">lvl</span></a><span class="hs-special">)</span><span>
</span><a name="line-337"></a><span>              </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;, splitptr=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080017"><span class="hs-identifier hs-var">splitptr</span></a><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span>    </span><span class="hs-comment">-- grab bucket at splitPtr</span><span>
</span><a name="line-340"></a><span>    </span><a name="local-6989586621679080019"><a href="#local-6989586621679080019"><span class="hs-identifier">oldBucket</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679080018"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679080017"><span class="hs-identifier hs-var">splitptr</span></a><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span>    </span><a name="local-6989586621679080020"><a href="#local-6989586621679080020"><span class="hs-identifier">nelems</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#size"><span class="hs-identifier hs-var">Bucket.size</span></a><span> </span><a href="#local-6989586621679080019"><span class="hs-identifier hs-var">oldBucket</span></a><span>
</span><a name="line-343"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080021"><a href="#local-6989586621679080021"><span class="hs-identifier">bsz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">max</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#newBucketSize"><span class="hs-identifier hs-var">Bucket.newBucketSize</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-344"></a><span>                   </span><span class="hs-identifier hs-var">ceiling</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-number">0.625</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679080020"><span class="hs-identifier hs-var">nelems</span></a><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span>    </span><span class="hs-comment">-- write an empty bucket there</span><span>
</span><a name="line-347"></a><span>    </span><a name="local-6989586621679080022"><a href="#local-6989586621679080022"><span class="hs-identifier">dbucket1</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#emptyWithSize"><span class="hs-identifier hs-var">Bucket.emptyWithSize</span></a><span> </span><a href="#local-6989586621679080021"><span class="hs-identifier hs-var">bsz</span></a><span>
</span><a name="line-348"></a><span>    </span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a><span> </span><a href="#local-6989586621679080018"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679080017"><span class="hs-identifier hs-var">splitptr</span></a><span> </span><a href="#local-6989586621679080022"><span class="hs-identifier hs-var">dbucket1</span></a><span>
</span><a name="line-349"></a><span>
</span><a name="line-350"></a><span>    </span><span class="hs-comment">-- grow the buckets?</span><span>
</span><a name="line-351"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080023"><a href="#local-6989586621679080023"><span class="hs-identifier">lvl2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a><span> </span><a href="#local-6989586621679080016"><span class="hs-identifier hs-var">lvl</span></a><span>
</span><a name="line-352"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080024"><a href="#local-6989586621679080024"><span class="hs-identifier">lvl1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679080016"><span class="hs-identifier hs-var">lvl</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><a name="local-6989586621679080027"><a href="#local-6989586621679080027"><span class="hs-identifier">buckets'</span></a></a><span class="hs-special">,</span><span class="hs-glyph">!</span><a name="local-6989586621679080028"><a href="#local-6989586621679080028"><span class="hs-identifier">lvl'</span></a></a><span class="hs-special">,</span><span class="hs-glyph">!</span><a name="local-6989586621679080029"><a href="#local-6989586621679080029"><span class="hs-identifier">sp'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-355"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679080017"><span class="hs-identifier hs-var">splitptr</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679080024"><span class="hs-identifier hs-var">lvl1</span></a><span>
</span><a name="line-356"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-357"></a><span>            </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;split: resizing bucket array&quot;</span><span>
</span><a name="line-358"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080025"><a href="#local-6989586621679080025"><span class="hs-identifier">lvl3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span class="hs-operator hs-var">*</span><a href="#local-6989586621679080023"><span class="hs-identifier hs-var">lvl2</span></a><span>
</span><a name="line-359"></a><span>            </span><a name="local-6989586621679080026"><a href="#local-6989586621679080026"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#expandBucketArray"><span class="hs-identifier hs-var">Bucket.expandBucketArray</span></a><span> </span><a href="#local-6989586621679080025"><span class="hs-identifier hs-var">lvl3</span></a><span> </span><a href="#local-6989586621679080023"><span class="hs-identifier hs-var">lvl2</span></a><span> </span><a href="#local-6989586621679080018"><span class="hs-identifier hs-var">buckets</span></a><span>
</span><a name="line-360"></a><span>            </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;split: resizing bucket array: done&quot;</span><span>
</span><a name="line-361"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080026"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">,</span><a href="#local-6989586621679080016"><span class="hs-identifier hs-var">lvl</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-362"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080018"><span class="hs-identifier hs-var">buckets</span></a><span class="hs-special">,</span><a href="#local-6989586621679080016"><span class="hs-identifier hs-var">lvl</span></a><span class="hs-special">,</span><a href="#local-6989586621679080017"><span class="hs-identifier hs-var">splitptr</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-363"></a><span>
</span><a name="line-364"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080030"><a href="#local-6989586621679080030"><span class="hs-identifier">ht'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a href="#local-6989586621679080028"><span class="hs-identifier hs-var">lvl'</span></a><span> </span><a href="#local-6989586621679080029"><span class="hs-identifier hs-var">sp'</span></a><span> </span><a href="#local-6989586621679080027"><span class="hs-identifier hs-var">buckets'</span></a><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span>    </span><span class="hs-comment">-- make sure the other split bucket has enough room in it also</span><span>
</span><a name="line-367"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080031"><a href="#local-6989586621679080031"><span class="hs-identifier">splitOffs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080017"><span class="hs-identifier hs-var">splitptr</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679080024"><span class="hs-identifier hs-var">lvl1</span></a><span>
</span><a name="line-368"></a><span>    </span><a name="local-6989586621679080032"><a href="#local-6989586621679080032"><span class="hs-identifier">db2</span></a></a><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679080027"><span class="hs-identifier hs-var">buckets'</span></a><span> </span><a href="#local-6989586621679080031"><span class="hs-identifier hs-var">splitOffs</span></a><span>
</span><a name="line-369"></a><span>    </span><a name="local-6989586621679080033"><a href="#local-6989586621679080033"><span class="hs-identifier">db2sz</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#size"><span class="hs-identifier hs-var">Bucket.size</span></a><span> </span><a href="#local-6989586621679080032"><span class="hs-identifier hs-var">db2</span></a><span>
</span><a name="line-370"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080034"><a href="#local-6989586621679080034"><span class="hs-identifier">db2sz'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080033"><span class="hs-identifier hs-var">db2sz</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679080021"><span class="hs-identifier hs-var">bsz</span></a><span>
</span><a name="line-371"></a><span>    </span><a name="local-6989586621679080035"><a href="#local-6989586621679080035"><span class="hs-identifier">db2'</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#growBucketTo"><span class="hs-identifier hs-var">Bucket.growBucketTo</span></a><span> </span><a href="#local-6989586621679080034"><span class="hs-identifier hs-var">db2sz'</span></a><span> </span><a href="#local-6989586621679080032"><span class="hs-identifier hs-var">db2</span></a><span>
</span><a name="line-372"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;growing bucket at &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080031"><span class="hs-identifier hs-var">splitOffs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; to size &quot;</span><span>
</span><a name="line-373"></a><span>              </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080034"><span class="hs-identifier hs-var">db2sz'</span></a><span>
</span><a name="line-374"></a><span>    </span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a><span> </span><a href="#local-6989586621679080027"><span class="hs-identifier hs-var">buckets'</span></a><span> </span><a href="#local-6989586621679080031"><span class="hs-identifier hs-var">splitOffs</span></a><span> </span><a href="#local-6989586621679080035"><span class="hs-identifier hs-var">db2'</span></a><span>
</span><a name="line-375"></a><span>
</span><a name="line-376"></a><span>    </span><span class="hs-comment">-- rehash old bucket</span><span>
</span><a name="line-377"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;split: rehashing bucket&quot;</span><span>
</span><a name="line-378"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080036"><a href="#local-6989586621679080036"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.HashTable.ST.Linear.html#primitiveInsert"><span class="hs-identifier hs-var">primitiveInsert</span></a><span> </span><a href="#local-6989586621679080030"><span class="hs-identifier hs-var">ht'</span></a><span>
</span><a name="line-379"></a><span>    </span><a href="Data.HashTable.Internal.Utils.html#forceSameType"><span class="hs-identifier hs-var">forceSameType</span></a><span> </span><a href="#local-6989586621679080036"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.HashTable.ST.Linear.html#primitiveInsert"><span class="hs-identifier hs-var">primitiveInsert</span></a><span> </span><a href="#local-6989586621679080015"><span class="hs-identifier hs-var">ht</span></a><span class="hs-special">)</span><span>
</span><a name="line-380"></a><span>
</span><a name="line-381"></a><span>    </span><a href="Data.HashTable.Internal.Linear.Bucket.html#mapM_"><span class="hs-identifier hs-var">Bucket.mapM_</span></a><span> </span><a href="#local-6989586621679080036"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679080019"><span class="hs-identifier hs-var">oldBucket</span></a><span>
</span><a name="line-382"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;split: done&quot;</span><span>
</span><a name="line-383"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679080030"><span class="hs-identifier hs-var">ht'</span></a><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span>
</span><a name="line-386"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-387"></a><span class="hs-identifier">checkOverflow</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-388"></a><a name="checkOverflow"><a href="Data.HashTable.ST.Linear.html#checkOverflow"><span class="hs-identifier">checkOverflow</span></a></a><span> </span><a name="local-6989586621679080052"><a href="#local-6989586621679080052"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080052"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="Data.HashTable.ST.Linear.html#bucketSplitSize"><span class="hs-identifier hs-var">bucketSplitSize</span></a><span>
</span><a name="line-389"></a><span>
</span><a name="line-390"></a><span>
</span><a name="line-391"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-392"></a><span class="hs-comment">-- insert w/o splitting</span><span>
</span><a name="line-393"></a><span class="hs-identifier">primitiveInsert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679079883"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-394"></a><span>                   </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679079884"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079883"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079885"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-395"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079883"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-396"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079885"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-397"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079884"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-398"></a><a name="primitiveInsert"><a href="Data.HashTable.ST.Linear.html#primitiveInsert"><span class="hs-identifier">primitiveInsert</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679080053"><a href="#local-6989586621679080053"><span class="hs-identifier">lvl</span></a></a><span> </span><a name="local-6989586621679080054"><a href="#local-6989586621679080054"><span class="hs-identifier">splitptr</span></a></a><span> </span><a name="local-6989586621679080055"><a href="#local-6989586621679080055"><span class="hs-identifier">buckets</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080056"><a href="#local-6989586621679080056"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679080057"><a href="#local-6989586621679080057"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-399"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;primitiveInsert start: nbuckets=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a><span> </span><a href="#local-6989586621679080053"><span class="hs-identifier hs-var">lvl</span></a><span class="hs-special">)</span><span>
</span><a name="line-400"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080058"><a href="#local-6989586621679080058"><span class="hs-identifier">h0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a><span> </span><a href="#local-6989586621679080053"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="#local-6989586621679080054"><span class="hs-identifier hs-var">splitptr</span></a><span> </span><a href="#local-6989586621679080056"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-401"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#primitiveInsert%27"><span class="hs-identifier hs-var">primitiveInsert'</span></a><span> </span><a href="#local-6989586621679080055"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679080058"><span class="hs-identifier hs-var">h0</span></a><span> </span><a href="#local-6989586621679080056"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679080057"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-402"></a><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-405"></a><span class="hs-identifier">primitiveInsert'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MutableArray</span><span> </span><a href="#local-6989586621679079880"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.Internal.Linear.Bucket.html#Bucket"><span class="hs-identifier hs-type">Bucket</span></a><span> </span><a href="#local-6989586621679079880"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079881"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079882"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-406"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-407"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079881"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-408"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079882"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-409"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079880"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-410"></a><a name="primitiveInsert%27"><a href="Data.HashTable.ST.Linear.html#primitiveInsert%27"><span class="hs-identifier">primitiveInsert'</span></a></a><span> </span><a name="local-6989586621679080059"><a href="#local-6989586621679080059"><span class="hs-identifier">buckets</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080060"><a href="#local-6989586621679080060"><span class="hs-identifier">h0</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080061"><a href="#local-6989586621679080061"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080062"><a href="#local-6989586621679080062"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-411"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;primitiveInsert': bucket number=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679080060"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-412"></a><span>    </span><a name="local-6989586621679080063"><a href="#local-6989586621679080063"><span class="hs-identifier">bucket</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679080059"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679080060"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-413"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;primitiveInsert': snoccing bucket&quot;</span><span>
</span><a name="line-414"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">!</span><a name="local-6989586621679080064"><a href="#local-6989586621679080064"><span class="hs-identifier">hw</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080065"><a href="#local-6989586621679080065"><span class="hs-identifier">m</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#snoc"><span class="hs-identifier hs-var">Bucket.snoc</span></a><span> </span><a href="#local-6989586621679080063"><span class="hs-identifier hs-var">bucket</span></a><span> </span><a href="#local-6989586621679080061"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679080062"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-415"></a><span>    </span><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;primitiveInsert': bucket snoc'd&quot;</span><span>
</span><a name="line-416"></a><span>    </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>          </span><span class="hs-special">(</span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a><span> </span><a href="#local-6989586621679080059"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679080060"><span class="hs-identifier hs-var">h0</span></a><span class="hs-special">)</span><span>
</span><a name="line-418"></a><span>          </span><a href="#local-6989586621679080065"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-419"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679080064"><span class="hs-identifier hs-var">hw</span></a><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span>
</span><a name="line-423"></a><span>
</span><a name="line-424"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-425"></a><span class="hs-identifier">fillFactor</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-426"></a><a name="fillFactor"><a href="Data.HashTable.ST.Linear.html#fillFactor"><span class="hs-identifier">fillFactor</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1.3</span><span>
</span><a name="line-427"></a><span>
</span><a name="line-428"></a><span>
</span><a name="line-429"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-430"></a><span class="hs-identifier">bucketSplitSize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-431"></a><a name="bucketSplitSize"><a href="Data.HashTable.ST.Linear.html#bucketSplitSize"><span class="hs-identifier">bucketSplitSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#bucketSplitSize"><span class="hs-identifier hs-var">Bucket.bucketSplitSize</span></a><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span>
</span><a name="line-434"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-435"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">power2</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-436"></a><span class="hs-identifier">power2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-437"></a><a name="power2"><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier">power2</span></a></a><span> </span><a name="local-6989586621679080066"><a href="#local-6989586621679080066"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">`</span><a href="Data.HashTable.Internal.Utils.html#iShiftL"><span class="hs-identifier hs-var">iShiftL</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679080066"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-438"></a><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-441"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">hashKey</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-442"></a><span class="hs-identifier">hashKey</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679079879"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079879"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-443"></a><a name="hashKey"><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier">hashKey</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080067"><a href="#local-6989586621679080067"><span class="hs-identifier">lvl</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080068"><a href="#local-6989586621679080068"><span class="hs-identifier">splitptr</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080069"><a href="#local-6989586621679080069"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080071"><span class="hs-identifier hs-var">h1</span></a><span>
</span><a name="line-444"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-445"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679080070"><a href="#local-6989586621679080070"><span class="hs-identifier">h0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#hashAtLvl"><span class="hs-identifier hs-var">hashAtLvl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080067"><span class="hs-identifier hs-var">lvl</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679080069"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-446"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679080071"><a href="#local-6989586621679080071"><span class="hs-identifier">h1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080070"><span class="hs-identifier hs-var">h0</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679080068"><span class="hs-identifier hs-var">splitptr</span></a><span class="hs-special">)</span><span>
</span><a name="line-447"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="Data.HashTable.ST.Linear.html#hashAtLvl"><span class="hs-identifier hs-var">hashAtLvl</span></a><span> </span><a href="#local-6989586621679080067"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="#local-6989586621679080069"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-448"></a><span>            </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679080070"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-449"></a><span>
</span><a name="line-450"></a><span>
</span><a name="line-451"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-452"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">hashAtLvl</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-453"></a><span class="hs-identifier">hashAtLvl</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679079878"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079878"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-454"></a><a name="hashAtLvl"><a href="Data.HashTable.ST.Linear.html#hashAtLvl"><span class="hs-identifier">hashAtLvl</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080072"><a href="#local-6989586621679080072"><span class="hs-identifier">lvl</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080073"><a href="#local-6989586621679080073"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080074"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-455"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-456"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679080074"><a href="#local-6989586621679080074"><span class="hs-identifier">h</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679080075"><span class="hs-identifier hs-var">hashcode</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621679080076"><span class="hs-identifier hs-var">mask</span></a><span>
</span><a name="line-457"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679080075"><a href="#local-6989586621679080075"><span class="hs-identifier">hashcode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><a href="#local-6989586621679080073"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-458"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679080076"><a href="#local-6989586621679080076"><span class="hs-identifier">mask</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a><span> </span><a href="#local-6989586621679080072"><span class="hs-identifier hs-var">lvl</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span>
</span><a name="line-461"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-462"></a><span class="hs-identifier">newRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679079875"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079876"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079877"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079875"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079875"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079876"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079877"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-463"></a><a name="newRef"><a href="Data.HashTable.ST.Linear.html#newRef"><span class="hs-identifier">newRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="Data.HashTable.ST.Linear.html#HT"><span class="hs-identifier hs-var">HT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">newSTRef</span><span>
</span><a name="line-464"></a><span>
</span><a name="line-465"></a><span class="hs-identifier">writeRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079872"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079873"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079874"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679079872"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079873"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079874"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079872"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-466"></a><a name="writeRef"><a href="Data.HashTable.ST.Linear.html#writeRef"><span class="hs-identifier">writeRef</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HT"><span class="hs-identifier hs-var">HT</span></a><span> </span><a name="local-6989586621679080077"><a href="#local-6989586621679080077"><span class="hs-identifier">ref</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679080078"><a href="#local-6989586621679080078"><span class="hs-identifier">ht</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">writeSTRef</span><span> </span><a href="#local-6989586621679080077"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="#local-6989586621679080078"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-467"></a><span>
</span><a name="line-468"></a><span class="hs-identifier">readRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079869"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079870"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079871"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079869"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679079869"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079870"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079871"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-469"></a><a name="readRef"><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier">readRef</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HT"><span class="hs-identifier hs-var">HT</span></a><span> </span><a name="local-6989586621679080079"><a href="#local-6989586621679080079"><span class="hs-identifier">ref</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readSTRef</span><span> </span><a href="#local-6989586621679080079"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-470"></a><span>
</span><a name="line-471"></a><span>
</span><a name="line-472"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-473"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">debug</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-474"></a><span class="hs-identifier">debug</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079868"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-475"></a><span>
</span><a name="line-476"></a><span class="hs-cpp">#ifdef DEBUG
</span><span class="hs-identifier">debug</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeIOToST</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-478"></a><span>              </span><span class="hs-identifier">putStrLn</span><span> </span><span class="hs-identifier">s</span><span>
</span><a name="line-479"></a><span>              </span><span class="hs-identifier">hFlush</span><span> </span><span class="hs-identifier">stdout</span><span>
</span><a name="line-480"></a><span class="hs-cpp">#else
#ifdef TESTSUITE
</span><span class="hs-identifier">debug</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-483"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">s</span><span>
</span><a name="line-484"></a><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-485"></a><span class="hs-cpp">#else
</span><a name="debug"><a href="Data.HashTable.ST.Linear.html#debug"><span class="hs-identifier">debug</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-487"></a><span class="hs-cpp">#endif
#endif
</span><span>
</span><a name="line-490"></a><span>
</span><a name="line-491"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-492"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-493"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:lookupIndex&quot;.</span><span>
</span><a name="line-494"></a><span class="hs-identifier">lookupIndex</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679079865"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679079865"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079866"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079865"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079867"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679079865"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079866"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Word</span><span class="hs-special">)</span><span>
</span><a name="line-495"></a><a name="lookupIndex"><a href="Data.HashTable.ST.Linear.html#lookupIndex"><span class="hs-identifier">lookupIndex</span></a></a><span> </span><a name="local-6989586621679080080"><a href="#local-6989586621679080080"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080081"><a href="#local-6989586621679080081"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679080080"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679080082"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-496"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-497"></a><span>    </span><a name="local-6989586621679080082"><a href="#local-6989586621679080082"><span class="hs-identifier">work</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679080083"><a href="#local-6989586621679080083"><span class="hs-identifier">lvl</span></a></a><span> </span><a name="local-6989586621679080084"><a href="#local-6989586621679080084"><span class="hs-identifier">splitptr</span></a></a><span> </span><a name="local-6989586621679080085"><a href="#local-6989586621679080085"><span class="hs-identifier">buckets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-498"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679080086"><a href="#local-6989586621679080086"><span class="hs-identifier">h0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a><span> </span><a href="#local-6989586621679080083"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="#local-6989586621679080084"><span class="hs-identifier hs-var">splitptr</span></a><span> </span><a href="#local-6989586621679080081"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-499"></a><span>        </span><a name="local-6989586621679080087"><a href="#local-6989586621679080087"><span class="hs-identifier">bucket</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679080085"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679080086"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-500"></a><span>        </span><a name="local-6989586621679080088"><a href="#local-6989586621679080088"><span class="hs-identifier">mbIx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#lookupIndex"><span class="hs-identifier hs-var">Bucket.lookupIndex</span></a><span> </span><a href="#local-6989586621679080087"><span class="hs-identifier hs-var">bucket</span></a><span> </span><a href="#local-6989586621679080081"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-501"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-keyword">do</span><span> </span><a name="local-6989586621679080089"><a href="#local-6989586621679080089"><span class="hs-identifier">ix</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679080088"><span class="hs-identifier hs-var">mbIx</span></a><span>
</span><a name="line-502"></a><span>                     </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="Data.HashTable.ST.Linear.html#encodeIndex"><span class="hs-identifier hs-var">encodeIndex</span></a><span> </span><a href="#local-6989586621679080083"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="#local-6989586621679080086"><span class="hs-identifier hs-var">h0</span></a><span> </span><a href="#local-6989586621679080089"><span class="hs-identifier hs-var">ix</span></a><span>
</span><a name="line-503"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">lookupIndex</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-504"></a><span>
</span><a name="line-505"></a><span class="hs-identifier">encodeIndex</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-506"></a><a name="encodeIndex"><a href="Data.HashTable.ST.Linear.html#encodeIndex"><span class="hs-identifier">encodeIndex</span></a></a><span> </span><a name="local-6989586621679080090"><a href="#local-6989586621679080090"><span class="hs-identifier">lvl</span></a></a><span> </span><a name="local-6989586621679080091"><a href="#local-6989586621679080091"><span class="hs-identifier">bucketIx</span></a></a><span> </span><a name="local-6989586621679080092"><a href="#local-6989586621679080092"><span class="hs-identifier">elemIx</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-507"></a><span>  </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679080091"><span class="hs-identifier hs-var">bucketIx</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Data.Bits.shiftL</span><span class="hs-special">`</span><span> </span><a href="Data.HashTable.ST.Linear.html#indexOffset"><span class="hs-identifier hs-var">indexOffset</span></a><span> </span><a href="#local-6989586621679080090"><span class="hs-identifier hs-var">lvl</span></a><span> </span><span class="hs-operator hs-var">.|.</span><span>
</span><a name="line-508"></a><span>  </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679080092"><span class="hs-identifier hs-var">elemIx</span></a><span>
</span><a name="line-509"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">encodeIndex</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-510"></a><span>
</span><a name="line-511"></a><span class="hs-identifier">decodeIndex</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-512"></a><a name="decodeIndex"><a href="Data.HashTable.ST.Linear.html#decodeIndex"><span class="hs-identifier">decodeIndex</span></a></a><span> </span><a name="local-6989586621679080093"><a href="#local-6989586621679080093"><span class="hs-identifier">lvl</span></a></a><span> </span><a name="local-6989586621679080094"><a href="#local-6989586621679080094"><span class="hs-identifier">ix</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-513"></a><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080094"><span class="hs-identifier hs-var">ix</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Data.Bits.shiftR</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679080095"><span class="hs-identifier hs-var">offset</span></a><span class="hs-special">)</span><span>
</span><a name="line-514"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">bit</span><span> </span><a href="#local-6989586621679080095"><span class="hs-identifier hs-var">offset</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621679080094"><span class="hs-identifier hs-var">ix</span></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-515"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-516"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679080095"><a href="#local-6989586621679080095"><span class="hs-identifier">offset</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#indexOffset"><span class="hs-identifier hs-var">indexOffset</span></a><span> </span><a href="#local-6989586621679080093"><span class="hs-identifier hs-var">lvl</span></a><span>
</span><a name="line-517"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">decodeIndex</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-518"></a><span>
</span><a name="line-519"></a><span class="hs-identifier">indexOffset</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-520"></a><a name="indexOffset"><a href="Data.HashTable.ST.Linear.html#indexOffset"><span class="hs-identifier">indexOffset</span></a></a><span> </span><a name="local-6989586621679080096"><a href="#local-6989586621679080096"><span class="hs-identifier">lvl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">finiteBitSize</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679080096"><span class="hs-identifier hs-var">lvl</span></a><span>
</span><a name="line-521"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">indexOffset</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-522"></a><span>
</span><a name="line-523"></a><span class="hs-identifier">nextByIndex</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679079862"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679079863"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679079864"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679079862"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word</span><span class="hs-special">,</span><a href="#local-6989586621679079863"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><a href="#local-6989586621679079864"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-524"></a><a name="nextByIndex"><a href="Data.HashTable.ST.Linear.html#nextByIndex"><span class="hs-identifier">nextByIndex</span></a></a><span> </span><a name="local-6989586621679080097"><a href="#local-6989586621679080097"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080098"><a href="#local-6989586621679080098"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679080097"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679080099"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-525"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-526"></a><span>    </span><a name="local-6989586621679080099"><a href="#local-6989586621679080099"><span class="hs-identifier">work</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Linear.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679080100"><a href="#local-6989586621679080100"><span class="hs-identifier">lvl</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679080101"><a href="#local-6989586621679080101"><span class="hs-identifier">buckets</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-527"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679080111"><a href="#local-6989586621679080111"><span class="hs-identifier">h0</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080112"><a href="#local-6989586621679080112"><span class="hs-identifier">ix</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#decodeIndex"><span class="hs-identifier hs-var">decodeIndex</span></a><span> </span><a href="#local-6989586621679080100"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="#local-6989586621679080098"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-528"></a><span>        </span><a href="#local-6989586621679080103"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679080111"><span class="hs-identifier hs-var">h0</span></a><span> </span><a href="#local-6989586621679080112"><span class="hs-identifier hs-var">ix</span></a><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-531"></a><span>        </span><a name="local-6989586621679080102"><a href="#local-6989586621679080102"><span class="hs-identifier">bucketN</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#power2"><span class="hs-identifier hs-var">power2</span></a><span> </span><a href="#local-6989586621679080100"><span class="hs-identifier hs-var">lvl</span></a><span>
</span><a name="line-532"></a><span>        </span><a name="local-6989586621679080103"><a href="#local-6989586621679080103"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679080104"><a href="#local-6989586621679080104"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679080105"><a href="#local-6989586621679080105"><span class="hs-identifier">ix</span></a></a><span>
</span><a name="line-533"></a><span>          </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679080104"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679080102"><span class="hs-identifier hs-var">bucketN</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679080104"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-534"></a><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-535"></a><span>              </span><a name="local-6989586621679080106"><a href="#local-6989586621679080106"><span class="hs-identifier">bucket</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679080101"><span class="hs-identifier hs-var">buckets</span></a><span> </span><a href="#local-6989586621679080104"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-536"></a><span>              </span><a name="local-6989586621679080107"><a href="#local-6989586621679080107"><span class="hs-identifier">mb</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Linear.Bucket.html#elemAt"><span class="hs-identifier hs-var">Bucket.elemAt</span></a><span> </span><a href="#local-6989586621679080106"><span class="hs-identifier hs-var">bucket</span></a><span> </span><a href="#local-6989586621679080105"><span class="hs-identifier hs-var">ix</span></a><span>
</span><a name="line-537"></a><span>              </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679080107"><span class="hs-identifier hs-var">mb</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-538"></a><span>                </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679080108"><a href="#local-6989586621679080108"><span class="hs-identifier">k'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679080109"><a href="#local-6989586621679080109"><span class="hs-identifier">v</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-539"></a><span>                  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679080110"><a href="#local-6989586621679080110"><span class="hs-identifier">ix'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Linear.html#encodeIndex"><span class="hs-identifier hs-var">encodeIndex</span></a><span> </span><a href="#local-6989586621679080100"><span class="hs-identifier hs-var">lvl</span></a><span> </span><a href="#local-6989586621679080104"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679080105"><span class="hs-identifier hs-var">ix</span></a><span>
</span><a name="line-540"></a><span>                  </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080110"><span class="hs-identifier hs-var">ix'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679080108"><span class="hs-identifier hs-var">k'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679080109"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span>                </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679080103"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679080104"><span class="hs-identifier hs-var">h</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-542"></a><span>
</span><a name="line-543"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">nextByIndex</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-544"></a></pre></body></html>