<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE CPP          #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE MagicHash    #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-comment">{-|

A basic open-addressing hash table using linear probing. Use this hash table if
you...

  * want the fastest possible lookups, and very fast inserts.

  * don't care about wasting a little bit of memory to get it.

  * don't care that a table resize might pause for a long time to rehash all
    of the key-value mappings.

  * have a workload which is not heavy with deletes; deletes clutter the table
    with deleted markers and force the table to be completely rehashed fairly
    often.

Of the hash tables in this collection, this hash table has the best lookup
performance, while maintaining competitive insert performance.

/Space overhead/

This table is not especially memory-efficient; firstly, the table has a maximum
load factor of 0.83 and will be resized if load exceeds this value. Secondly,
to improve insert and lookup performance, we store a 16-bit hash code for each
key in the table.

Each hash table entry requires at least 2.25 words (on a 64-bit machine), two
for the pointers to the key and value and one quarter word for the hash code.
We don't count key and value pointers as overhead, because they have to be
there -- so the overhead for a full slot is at least one quarter word -- but
empty slots in the hash table count for a full 2.25 words of overhead. Define
@m@ as the number of slots in the table, @n@ as the number of key value
mappings, and @ws@ as the machine word size in /bytes/. If the load factor is
@k=n\/m@, the amount of space /wasted/ per mapping in words is:

@
w(n) = (m*(2*ws + 2) - n*(2*ws)) / ws
@

Since @m=n\/k@,

@
w(n) = n\/k * (2*ws + 2) - n*(2*ws)
     = (n * (2 + 2*ws*(1-k)) / k) / ws
@

Solving for @k=0.83@, the maximum load factor, gives a /minimum/ overhead of
0.71 words per mapping on a 64-bit machine, or 1.01 words per mapping on a
32-bit machine. If @k=0.5@, which should be under normal usage the /maximum/
overhead situation, then the overhead would be 2.5 words per mapping on a
64-bit machine, or 3.0 words per mapping on a 32-bit machine.

/Space overhead: experimental results/

In randomized testing on a 64-bit machine (see
@test\/compute-overhead\/ComputeOverhead.hs@ in the source distribution), mean
overhead (that is, the number of words needed to store the key-value mapping
over and above the two words necessary for the key and the value pointers) is
approximately 1.24 machine words per key-value mapping with a standard
deviation of about 0.30 words, and 1.70 words per mapping at the 95th
percentile.

/Expensive resizes/

If enough elements are inserted into the table to make it exceed the maximum
load factor, the table is resized. A resize involves a complete rehash of all
the elements in the table, which means that any given call to 'insert' might
take /O(n)/ time in the size of the table, with a large constant factor. If a
long pause waiting for the table to resize is unacceptable for your
application, you should choose the included linear hash table instead.


/References:/

  * Knuth, Donald E. /The Art of Computer Programming/, vol. 3 Sorting and
    Searching. Addison-Wesley Publishing Company, 1973.
-}</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.HashTable.ST.Basic</span><span>
</span><a name="line-84"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span>
</span><a name="line-85"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Basic.html#new"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-86"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Basic.html#newSized"><span class="hs-identifier hs-var">newSized</span></a><span>
</span><a name="line-87"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Basic.html#delete"><span class="hs-identifier hs-var">delete</span></a><span>
</span><a name="line-88"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Basic.html#lookup"><span class="hs-identifier hs-var">lookup</span></a><span>
</span><a name="line-89"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Basic.html#insert"><span class="hs-identifier hs-var">insert</span></a><span>
</span><a name="line-90"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Basic.html#mutate"><span class="hs-identifier hs-var">mutate</span></a><span>
</span><a name="line-91"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Basic.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span>
</span><a name="line-92"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Basic.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span>
</span><a name="line-93"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.HashTable.ST.Basic.html#computeOverhead"><span class="hs-identifier hs-var">computeOverhead</span></a><span>
</span><a name="line-94"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>
</span><a name="line-97"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Exception</span><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">assert</span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad</span><span>                     </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">foldM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.ST</span><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ST</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Bits</span><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Hashable</span><span>                     </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hashable</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Hashable</span><span>                     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">H</span><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Maybe</span><span>
</span><a name="line-105"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Monoid</span><span>
</span><a name="line-106"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Primitive.ByteArray</span><span>          </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">A</span><span>
</span><a name="line-107"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.STRef</span><span>
</span><a name="line-108"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.Exts</span><span>
</span><a name="line-109"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Prelude</span><span>                           </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">read</span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.HashTable.Class.html"><span class="hs-identifier">Data.HashTable.Class</span></a><span>              </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C</span><span>
</span><a name="line-112"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.HashTable.Internal.Array.html"><span class="hs-identifier">Data.HashTable.Internal.Array</span></a><span>
</span><a name="line-113"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.HashTable.Internal.CacheLine.html"><span class="hs-identifier">Data.HashTable.Internal.CacheLine</span></a><span>
</span><a name="line-114"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.HashTable.Internal.IntArray.html"><span class="hs-identifier">Data.HashTable.Internal.IntArray</span></a><span>  </span><span class="hs-special">(</span><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Data.HashTable.Internal.IntArray.html"><span class="hs-identifier">Data.HashTable.Internal.IntArray</span></a><span>  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">U</span><span>
</span><a name="line-116"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.HashTable.Internal.Utils.html"><span class="hs-identifier">Data.HashTable.Internal.Utils</span></a><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- | An open addressing hash table using linear probing.</span><span>
</span><a name="line-121"></a><span class="hs-keyword">newtype</span><span> </span><a name="HashTable"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier">HashTable</span></a></a><span> </span><a name="local-6989586621679069576"><a href="#local-6989586621679069576"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679069577"><a href="#local-6989586621679069577"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679069578"><a href="#local-6989586621679069578"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="HT"><a href="Data.HashTable.ST.Basic.html#HT"><span class="hs-identifier">HT</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">STRef</span><span> </span><a href="#local-6989586621679069576"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069576"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069577"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069578"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-keyword">type</span><span> </span><a name="SizeRefs"><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier">SizeRefs</span></a></a><span> </span><a name="local-6989586621679069575"><a href="#local-6989586621679069575"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">A.MutableByteArray</span><span> </span><a href="#local-6989586621679069575"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-identifier">intSz</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-126"></a><a name="intSz"><a href="Data.HashTable.ST.Basic.html#intSz"><span class="hs-identifier">intSz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">finiteBitSize</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-identifier">readLoad</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a><span> </span><a href="#local-6989586621679069662"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069662"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-129"></a><a name="readLoad"><a href="Data.HashTable.ST.Basic.html#readLoad"><span class="hs-identifier">readLoad</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">A.readByteArray</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-130"></a><span>
</span><a name="line-131"></a><span class="hs-identifier">writeLoad</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a><span> </span><a href="#local-6989586621679069661"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069661"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-132"></a><a name="writeLoad"><a href="Data.HashTable.ST.Basic.html#writeLoad"><span class="hs-identifier">writeLoad</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">A.writeByteArray</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span class="hs-identifier">readDelLoad</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a><span> </span><a href="#local-6989586621679069660"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069660"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-135"></a><a name="readDelLoad"><a href="Data.HashTable.ST.Basic.html#readDelLoad"><span class="hs-identifier">readDelLoad</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">A.readByteArray</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-identifier">writeDelLoad</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a><span> </span><a href="#local-6989586621679069659"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069659"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-138"></a><a name="writeDelLoad"><a href="Data.HashTable.ST.Basic.html#writeDelLoad"><span class="hs-identifier">writeDelLoad</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">A.writeByteArray</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-identifier">newSizeRefs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069658"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a><span> </span><a href="#local-6989586621679069658"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-141"></a><a name="newSizeRefs"><a href="Data.HashTable.ST.Basic.html#newSizeRefs"><span class="hs-identifier">newSizeRefs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-142"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069663"><a href="#local-6989586621679069663"><span class="hs-identifier">asz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="Data.HashTable.ST.Basic.html#intSz"><span class="hs-identifier hs-var">intSz</span></a><span>
</span><a name="line-143"></a><span>    </span><a name="local-6989586621679069664"><a href="#local-6989586621679069664"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">A.newAlignedPinnedByteArray</span><span> </span><a href="#local-6989586621679069663"><span class="hs-identifier hs-var">asz</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#intSz"><span class="hs-identifier hs-var">intSz</span></a><span>
</span><a name="line-144"></a><span>    </span><span class="hs-identifier hs-var">A.fillByteArray</span><span> </span><a href="#local-6989586621679069664"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679069663"><span class="hs-identifier hs-var">asz</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-145"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679069664"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-keyword">data</span><span> </span><a name="HashTable_"><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier">HashTable_</span></a></a><span> </span><a name="local-6989586621679069572"><a href="#local-6989586621679069572"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679069573"><a href="#local-6989586621679069573"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679069574"><a href="#local-6989586621679069574"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="HashTable"><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier">HashTable</span></a></a><span>
</span><a name="line-149"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="_size"><a href="Data.HashTable.ST.Basic.html#_size"><span class="hs-identifier">_size</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-150"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_load"><a href="Data.HashTable.ST.Basic.html#_load"><span class="hs-identifier">_load</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a><span> </span><a href="#local-6989586621679069572"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- ^ 2-element array, stores how many entries</span><span>
</span><a name="line-151"></a><span>                                  </span><span class="hs-comment">-- and deleted entries are in the table.</span><span>
</span><a name="line-152"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_hashes"><a href="Data.HashTable.ST.Basic.html#_hashes"><span class="hs-identifier">_hashes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="Data.HashTable.Internal.IntArray.html#IntArray"><span class="hs-identifier hs-type">U.IntArray</span></a><span> </span><a href="#local-6989586621679069572"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-153"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_keys"><a href="Data.HashTable.ST.Basic.html#_keys"><span class="hs-identifier">_keys</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">MutableArray</span><span> </span><a href="#local-6989586621679069572"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069573"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="_values"><a href="Data.HashTable.ST.Basic.html#_values"><span class="hs-identifier">_values</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">MutableArray</span><span> </span><a href="#local-6989586621679069572"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069574"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-155"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-159"></a><span class="hs-keyword">instance</span><span> </span><a href="Data.HashTable.Class.html#HashTable"><span class="hs-identifier hs-type">C.HashTable</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-160"></a><span>    </span><a name="local-8214565720323798505"><a href="Data.HashTable.Class.html#new"><span class="hs-identifier">new</span></a></a><span>             </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#new"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-161"></a><span>    </span><a name="local-8214565720323798506"><a href="Data.HashTable.Class.html#newSized"><span class="hs-identifier">newSized</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#newSized"><span class="hs-identifier hs-var">newSized</span></a><span>
</span><a name="line-162"></a><span>    </span><a name="local-8214565720323798508"><a href="Data.HashTable.Class.html#insert"><span class="hs-identifier">insert</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#insert"><span class="hs-identifier hs-var">insert</span></a><span>
</span><a name="line-163"></a><span>    </span><a name="local-8214565720323798509"><a href="Data.HashTable.Class.html#delete"><span class="hs-identifier">delete</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#delete"><span class="hs-identifier hs-var">delete</span></a><span>
</span><a name="line-164"></a><span>    </span><a name="local-8214565720323798510"><a href="Data.HashTable.Class.html#lookup"><span class="hs-identifier">lookup</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#lookup"><span class="hs-identifier hs-var">lookup</span></a><span>
</span><a name="line-165"></a><span>    </span><a name="local-8214565720323798511"><a href="Data.HashTable.Class.html#foldM"><span class="hs-identifier">foldM</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#foldM"><span class="hs-identifier hs-var">foldM</span></a><span>
</span><a name="line-166"></a><span>    </span><a name="local-8214565720323798512"><a href="Data.HashTable.Class.html#mapM_"><span class="hs-identifier">mapM_</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a><span>
</span><a name="line-167"></a><span>    </span><a name="local-8214565720323798513"><a href="Data.HashTable.Class.html#lookupIndex"><span class="hs-identifier">lookupIndex</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#lookupIndex"><span class="hs-identifier hs-var">lookupIndex</span></a><span>
</span><a name="line-168"></a><span>    </span><a name="local-8214565720323798514"><a href="Data.HashTable.Class.html#nextByIndex"><span class="hs-identifier">nextByIndex</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#nextByIndex"><span class="hs-identifier hs-var">nextByIndex</span></a><span>
</span><a name="line-169"></a><span>    </span><a name="local-8214565720323798515"><a href="Data.HashTable.Class.html#computeOverhead"><span class="hs-identifier">computeOverhead</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#computeOverhead"><span class="hs-identifier hs-var">computeOverhead</span></a><span>
</span><a name="line-170"></a><span>    </span><a name="local-8214565720323798507"><a href="Data.HashTable.Class.html#mutate"><span class="hs-identifier">mutate</span></a></a><span>          </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#mutate"><span class="hs-identifier hs-var">mutate</span></a><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-174"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069582"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069583"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069584"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-175"></a><span>    </span><a name="local-8214565720323789997"><span class="hs-identifier">show</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;HashTable&gt;&quot;</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-179"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-180"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:new&quot;.</span><span>
</span><a name="line-181"></a><span class="hs-identifier">new</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069655"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069655"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069656"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069657"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-182"></a><a name="new"><a href="Data.HashTable.ST.Basic.html#new"><span class="hs-identifier">new</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#newSized"><span class="hs-identifier hs-var">newSized</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-183"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">new</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-187"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:newSized&quot;.</span><span>
</span><a name="line-189"></a><span class="hs-identifier">newSized</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069652"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069652"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069653"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069654"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><a name="newSized"><a href="Data.HashTable.ST.Basic.html#newSized"><span class="hs-identifier">newSized</span></a></a><span> </span><a name="local-6989586621679069665"><a href="#local-6989586621679069665"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-191"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;entering: newSized &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069665"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-192"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069666"><a href="#local-6989586621679069666"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.Utils.html#nextBestPrime"><span class="hs-identifier hs-var">nextBestPrime</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">ceiling</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679069665"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">/</span><span> </span><a href="Data.HashTable.ST.Basic.html#maxLoad"><span class="hs-identifier hs-var">maxLoad</span></a><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>    </span><a name="local-6989586621679069667"><a href="#local-6989586621679069667"><span class="hs-identifier">ht</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#newSizedReal"><span class="hs-identifier hs-var">newSizedReal</span></a><span> </span><a href="#local-6989586621679069666"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-194"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#newRef"><span class="hs-identifier hs-var">newRef</span></a><span> </span><a href="#local-6989586621679069667"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-195"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newSized</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span>
</span><a name="line-198"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-199"></a><span class="hs-identifier">newSizedReal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069649"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069649"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069650"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069651"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-200"></a><a name="newSizedReal"><a href="Data.HashTable.ST.Basic.html#newSizedReal"><span class="hs-identifier">newSizedReal</span></a></a><span> </span><a name="local-6989586621679069668"><a href="#local-6989586621679069668"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-201"></a><span>    </span><span class="hs-comment">-- make sure the hash array is a multiple of cache-line sized so we can</span><span>
</span><a name="line-202"></a><span>    </span><span class="hs-comment">-- always search a whole cache line at once</span><span>
</span><a name="line-203"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069669"><a href="#local-6989586621679069669"><span class="hs-identifier">m'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679069668"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="Data.HashTable.Internal.Utils.html#numElemsInCacheLine"><span class="hs-identifier hs-var">numElemsInCacheLine</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><a href="Data.HashTable.Internal.Utils.html#numElemsInCacheLine"><span class="hs-identifier hs-var">numElemsInCacheLine</span></a><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>             </span><span class="hs-operator hs-var">*</span><span> </span><a href="Data.HashTable.Internal.Utils.html#numElemsInCacheLine"><span class="hs-identifier hs-var">numElemsInCacheLine</span></a><span>
</span><a name="line-205"></a><span>    </span><a name="local-6989586621679069670"><a href="#local-6989586621679069670"><span class="hs-identifier">h</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#newArray"><span class="hs-identifier hs-var">U.newArray</span></a><span> </span><a href="#local-6989586621679069669"><span class="hs-identifier hs-var">m'</span></a><span>
</span><a name="line-206"></a><span>    </span><a name="local-6989586621679069671"><a href="#local-6989586621679069671"><span class="hs-identifier">k</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#newArray"><span class="hs-identifier hs-var">newArray</span></a><span> </span><a href="#local-6989586621679069668"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-207"></a><span>    </span><a name="local-6989586621679069672"><a href="#local-6989586621679069672"><span class="hs-identifier">v</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#newArray"><span class="hs-identifier hs-var">newArray</span></a><span> </span><a href="#local-6989586621679069668"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-208"></a><span>    </span><a name="local-6989586621679069673"><a href="#local-6989586621679069673"><span class="hs-identifier">ld</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#newSizeRefs"><span class="hs-identifier hs-var">newSizeRefs</span></a><span>
</span><a name="line-209"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a href="#local-6989586621679069668"><span class="hs-identifier hs-var">m</span></a><span> </span><a href="#local-6989586621679069673"><span class="hs-identifier hs-var">ld</span></a><span> </span><a href="#local-6989586621679069670"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679069671"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679069672"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-213"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-214"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:delete&quot;.</span><span>
</span><a name="line-215"></a><span class="hs-identifier">delete</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679069646"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679069646"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-216"></a><span>          </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069647"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069646"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069648"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069646"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-218"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069647"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-219"></a><a name="delete"><a href="Data.HashTable.ST.Basic.html#delete"><span class="hs-identifier">delete</span></a></a><span> </span><a name="local-6989586621679069674"><a href="#local-6989586621679069674"><span class="hs-identifier">htRef</span></a></a><span> </span><a name="local-6989586621679069675"><a href="#local-6989586621679069675"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-220"></a><span>    </span><a name="local-6989586621679069677"><a href="#local-6989586621679069677"><span class="hs-identifier">ht</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679069674"><span class="hs-identifier hs-var">htRef</span></a><span>
</span><a name="line-221"></a><span>    </span><a name="local-6989586621679069678"><a href="#local-6989586621679069678"><span class="hs-identifier">slots</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#findSafeSlots"><span class="hs-identifier hs-var">findSafeSlots</span></a><span> </span><a href="#local-6989586621679069677"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="#local-6989586621679069675"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679069676"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-222"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#trueInt"><span class="hs-identifier hs-var">trueInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_slotFound</span><span> </span><a href="#local-6989586621679069678"><span class="hs-identifier hs-var">slots</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-identifier hs-var">deleteFromSlot</span></a><span> </span><a href="#local-6989586621679069677"><span class="hs-identifier hs-var">ht</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_slotB1</span><span> </span><a href="#local-6989586621679069678"><span class="hs-identifier hs-var">slots</span></a><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-224"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069676"><a href="#local-6989586621679069676"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a><span> </span><a href="#local-6989586621679069675"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-225"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">delete</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-229"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-230"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:lookup&quot;.</span><span>
</span><a name="line-231"></a><span class="hs-identifier">lookup</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679069643"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679069643"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069644"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069643"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069645"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069643"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069644"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679069645"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-232"></a><a name="lookup"><a href="Data.HashTable.ST.Basic.html#lookup"><span class="hs-identifier">lookup</span></a></a><span> </span><a name="local-6989586621679069679"><a href="#local-6989586621679069679"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069680"><a href="#local-6989586621679069680"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-233"></a><span>    </span><a name="local-6989586621679069697"><a href="#local-6989586621679069697"><span class="hs-identifier">ht</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679069679"><span class="hs-identifier hs-var">htRef</span></a><span>
</span><a name="line-234"></a><span>    </span><a href="#local-6989586621679069681"><span class="hs-identifier hs-var">lookup'</span></a><span> </span><a href="#local-6989586621679069697"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-235"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-236"></a><span>    </span><a name="local-6989586621679069681"><a href="#local-6989586621679069681"><span class="hs-identifier">lookup'</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679069682"><a href="#local-6989586621679069682"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679069683"><a href="#local-6989586621679069683"><span class="hs-identifier">hashes</span></a></a><span> </span><a name="local-6989586621679069684"><a href="#local-6989586621679069684"><span class="hs-identifier">keys</span></a></a><span> </span><a name="local-6989586621679069685"><a href="#local-6989586621679069685"><span class="hs-identifier">values</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-237"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069696"><a href="#local-6989586621679069696"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.Utils.html#whichBucket"><span class="hs-identifier hs-var">whichBucket</span></a><span> </span><a href="#local-6989586621679069686"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679069682"><span class="hs-identifier hs-var">sz</span></a><span>
</span><a name="line-238"></a><span>        </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;lookup h=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069686"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; sz=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069682"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; b=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069696"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-239"></a><span>        </span><a href="#local-6989586621679069688"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679069696"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679069682"><span class="hs-identifier hs-var">sz</span></a><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-242"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069686"><a href="#local-6989586621679069686"><span class="hs-identifier">h</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a><span> </span><a href="#local-6989586621679069680"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-243"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069687"><a href="#local-6989586621679069687"><span class="hs-identifier">he</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a><span> </span><a href="#local-6989586621679069686"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>        </span><a name="local-6989586621679069688"><a href="#local-6989586621679069688"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069689"><a href="#local-6989586621679069689"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069690"><a href="#local-6989586621679069690"><span class="hs-identifier">start</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069691"><a href="#local-6989586621679069691"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;lookup/go&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-246"></a><span>            </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;lookup'/go: &quot;</span><span>
</span><a name="line-247"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069689"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-248"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;/&quot;</span><span>
</span><a name="line-249"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069690"><span class="hs-identifier hs-var">start</span></a><span>
</span><a name="line-250"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;/&quot;</span><span>
</span><a name="line-251"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069691"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-252"></a><span>                           </span><span class="hs-special">]</span><span>
</span><a name="line-253"></a><span>            </span><a name="local-6989586621679069692"><a href="#local-6989586621679069692"><span class="hs-identifier">idx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.CacheLine.html#forwardSearch2"><span class="hs-identifier hs-var">forwardSearch2</span></a><span> </span><a href="#local-6989586621679069683"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069689"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679069691"><span class="hs-identifier hs-var">end</span></a><span> </span><a href="#local-6989586621679069687"><span class="hs-identifier hs-var">he</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a><span>
</span><a name="line-254"></a><span>            </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;forwardSearch2 returned &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-255"></a><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679069690"><span class="hs-identifier hs-var">start</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679069691"><span class="hs-identifier hs-var">end</span></a><span class="hs-special">)</span><span>
</span><a name="line-256"></a><span>               </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-257"></a><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-258"></a><span>                 </span><a name="local-6989586621679069693"><a href="#local-6989586621679069693"><span class="hs-identifier">h0</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a><span> </span><a href="#local-6989586621679069683"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-259"></a><span>                 </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;h0 was &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069693"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span>                 </span><span class="hs-keyword">if</span><span> </span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a><span> </span><a href="#local-6989586621679069693"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-262"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-263"></a><span>                       </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;record empty, returning Nothing&quot;</span><span>
</span><a name="line-264"></a><span>                       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-265"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-266"></a><span>                     </span><a name="local-6989586621679069694"><a href="#local-6989586621679069694"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069684"><span class="hs-identifier hs-var">keys</span></a><span> </span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-267"></a><span>                     </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679069680"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679069694"><span class="hs-identifier hs-var">k'</span></a><span>
</span><a name="line-268"></a><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-269"></a><span>                         </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;value found at &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-270"></a><span>                         </span><a name="local-6989586621679069695"><a href="#local-6989586621679069695"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069685"><span class="hs-identifier hs-var">values</span></a><span> </span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-271"></a><span>                         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679069695"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-272"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-273"></a><span>                         </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;value not found, recursing&quot;</span><span>
</span><a name="line-274"></a><span>                         </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679069689"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-275"></a><span>                           </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679069688"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069689"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-276"></a><span>                           </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679069688"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069692"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069690"><span class="hs-identifier hs-var">start</span></a><span> </span><a href="#local-6989586621679069691"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-277"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">lookup</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-281"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-282"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:insert&quot;.</span><span>
</span><a name="line-283"></a><span class="hs-identifier">insert</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679069640"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679069640"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-284"></a><span>          </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069641"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069640"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069642"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-285"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069640"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-286"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069642"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-287"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069641"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-288"></a><a name="insert"><a href="Data.HashTable.ST.Basic.html#insert"><span class="hs-identifier">insert</span></a></a><span> </span><a name="local-6989586621679069698"><a href="#local-6989586621679069698"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069699"><a href="#local-6989586621679069699"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069700"><a href="#local-6989586621679069700"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-289"></a><span>    </span><a name="local-6989586621679069703"><a href="#local-6989586621679069703"><span class="hs-identifier">ht</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679069698"><span class="hs-identifier hs-var">htRef</span></a><span>
</span><a name="line-290"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;insert: h=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069701"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-291"></a><span>    </span><a name="local-6989586621679069704"><a href="#local-6989586621679069704"><span class="hs-identifier">slots</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-var">SlotFindResponse</span></a><span> </span><a name="local-6989586621679069705"><a href="#local-6989586621679069705"><span class="hs-identifier">foundInt</span></a></a><span> </span><a name="local-6989586621679069706"><a href="#local-6989586621679069706"><span class="hs-identifier">b0</span></a></a><span> </span><a name="local-6989586621679069707"><a href="#local-6989586621679069707"><span class="hs-identifier">b1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#findSafeSlots"><span class="hs-identifier hs-var">findSafeSlots</span></a><span> </span><a href="#local-6989586621679069703"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="#local-6989586621679069699"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679069701"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-292"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069708"><a href="#local-6989586621679069708"><span class="hs-identifier">found</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#trueInt"><span class="hs-identifier hs-var">trueInt</span></a><span> </span><a href="#local-6989586621679069705"><span class="hs-identifier hs-var">foundInt</span></a><span>
</span><a name="line-293"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;insert: findSafeSlots returned &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069704"><span class="hs-identifier hs-var">slots</span></a><span>
</span><a name="line-294"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069708"><span class="hs-identifier hs-var">found</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069706"><span class="hs-identifier hs-var">b0</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679069707"><span class="hs-identifier hs-var">b1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-identifier hs-var">deleteFromSlot</span></a><span> </span><a href="#local-6989586621679069703"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="#local-6989586621679069707"><span class="hs-identifier hs-var">b1</span></a><span>
</span><a name="line-295"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#insertIntoSlot"><span class="hs-identifier hs-var">insertIntoSlot</span></a><span> </span><a href="#local-6989586621679069703"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="#local-6989586621679069706"><span class="hs-identifier hs-var">b0</span></a><span> </span><a href="#local-6989586621679069702"><span class="hs-identifier hs-var">he</span></a><span> </span><a href="#local-6989586621679069699"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679069700"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-296"></a><span>    </span><a name="local-6989586621679069709"><a href="#local-6989586621679069709"><span class="hs-identifier">ht'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#checkOverflow"><span class="hs-identifier hs-var">checkOverflow</span></a><span> </span><a href="#local-6989586621679069703"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-297"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#writeRef"><span class="hs-identifier hs-var">writeRef</span></a><span> </span><a href="#local-6989586621679069698"><span class="hs-identifier hs-var">htRef</span></a><span> </span><a href="#local-6989586621679069709"><span class="hs-identifier hs-var">ht'</span></a><span>
</span><a name="line-298"></a><span>
</span><a name="line-299"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-300"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069701"><a href="#local-6989586621679069701"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a><span> </span><a href="#local-6989586621679069699"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-301"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069702"><a href="#local-6989586621679069702"><span class="hs-identifier">he</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a><span> </span><a href="#local-6989586621679069701"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-302"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">insert</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-306"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-307"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:alter&quot;.</span><span>
</span><a name="line-308"></a><span class="hs-identifier">mutate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679069636"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679069636"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-309"></a><span>          </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069637"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069636"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069638"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-310"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069636"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-311"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679069638"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679069638"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679069639"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069637"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069639"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-313"></a><a name="mutate"><a href="Data.HashTable.ST.Basic.html#mutate"><span class="hs-identifier">mutate</span></a></a><span> </span><a name="local-6989586621679069710"><a href="#local-6989586621679069710"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069711"><a href="#local-6989586621679069711"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069712"><a href="#local-6989586621679069712"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-314"></a><span>    </span><a name="local-6989586621679069715"><a href="#local-6989586621679069715"><span class="hs-identifier">ht</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679069710"><span class="hs-identifier hs-var">htRef</span></a><span>
</span><a name="line-315"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069716"><a href="#local-6989586621679069716"><span class="hs-identifier">values</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">_values</span><span> </span><a href="#local-6989586621679069715"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-316"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;mutate h=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069713"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-317"></a><span>    </span><a name="local-6989586621679069717"><a href="#local-6989586621679069717"><span class="hs-identifier">slots</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-var">SlotFindResponse</span></a><span> </span><a name="local-6989586621679069718"><a href="#local-6989586621679069718"><span class="hs-identifier">foundInt</span></a></a><span> </span><a name="local-6989586621679069719"><a href="#local-6989586621679069719"><span class="hs-identifier">b0</span></a></a><span> </span><a name="local-6989586621679069720"><a href="#local-6989586621679069720"><span class="hs-identifier">b1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#findSafeSlots"><span class="hs-identifier hs-var">findSafeSlots</span></a><span> </span><a href="#local-6989586621679069715"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="#local-6989586621679069711"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679069713"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-318"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069721"><a href="#local-6989586621679069721"><span class="hs-identifier">found</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#trueInt"><span class="hs-identifier hs-var">trueInt</span></a><span> </span><a href="#local-6989586621679069718"><span class="hs-identifier hs-var">foundInt</span></a><span>
</span><a name="line-319"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;findSafeSlots returned &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069717"><span class="hs-identifier hs-var">slots</span></a><span>
</span><a name="line-320"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069722"><a href="#local-6989586621679069722"><span class="hs-identifier">mv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679069721"><span class="hs-identifier hs-var">found</span></a><span>
</span><a name="line-321"></a><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069716"><span class="hs-identifier hs-var">values</span></a><span> </span><a href="#local-6989586621679069720"><span class="hs-identifier hs-var">b1</span></a><span>
</span><a name="line-322"></a><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-323"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><a name="local-6989586621679069723"><a href="#local-6989586621679069723"><span class="hs-identifier">mv'</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069724"><a href="#local-6989586621679069724"><span class="hs-identifier">result</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069712"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679069722"><span class="hs-identifier hs-var">mv</span></a><span>
</span><a name="line-324"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069722"><span class="hs-identifier hs-var">mv</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679069723"><span class="hs-identifier hs-var">mv'</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-325"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-326"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-327"></a><span>            </span><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-identifier hs-var">deleteFromSlot</span></a><span> </span><a href="#local-6989586621679069715"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="#local-6989586621679069720"><span class="hs-identifier hs-var">b1</span></a><span>
</span><a name="line-328"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679069725"><a href="#local-6989586621679069725"><span class="hs-identifier">v'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-329"></a><span>            </span><a href="Data.HashTable.ST.Basic.html#insertIntoSlot"><span class="hs-identifier hs-var">insertIntoSlot</span></a><span> </span><a href="#local-6989586621679069715"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="#local-6989586621679069719"><span class="hs-identifier hs-var">b0</span></a><span> </span><a href="#local-6989586621679069714"><span class="hs-identifier hs-var">he</span></a><span> </span><a href="#local-6989586621679069711"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679069725"><span class="hs-identifier hs-var">v'</span></a><span>
</span><a name="line-330"></a><span>            </span><a name="local-6989586621679069726"><a href="#local-6989586621679069726"><span class="hs-identifier">ht'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#checkOverflow"><span class="hs-identifier hs-var">checkOverflow</span></a><span> </span><a href="#local-6989586621679069715"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-331"></a><span>            </span><a href="Data.HashTable.ST.Basic.html#writeRef"><span class="hs-identifier hs-var">writeRef</span></a><span> </span><a href="#local-6989586621679069710"><span class="hs-identifier hs-var">htRef</span></a><span> </span><a href="#local-6989586621679069726"><span class="hs-identifier hs-var">ht'</span></a><span>
</span><a name="line-332"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679069727"><a href="#local-6989586621679069727"><span class="hs-identifier">v'</span></a></a><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-333"></a><span>            </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069719"><span class="hs-identifier hs-var">b0</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679069720"><span class="hs-identifier hs-var">b1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-334"></a><span>                </span><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-identifier hs-var">deleteFromSlot</span></a><span> </span><a href="#local-6989586621679069715"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="#local-6989586621679069720"><span class="hs-identifier hs-var">b1</span></a><span>
</span><a name="line-335"></a><span>            </span><a href="Data.HashTable.ST.Basic.html#insertIntoSlot"><span class="hs-identifier hs-var">insertIntoSlot</span></a><span> </span><a href="#local-6989586621679069715"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="#local-6989586621679069719"><span class="hs-identifier hs-var">b0</span></a><span> </span><a href="#local-6989586621679069714"><span class="hs-identifier hs-var">he</span></a><span> </span><a href="#local-6989586621679069711"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679069727"><span class="hs-identifier hs-var">v'</span></a><span>
</span><a name="line-336"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679069724"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-337"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-338"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069713"><a href="#local-6989586621679069713"><span class="hs-identifier">h</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a><span> </span><a href="#local-6989586621679069711"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-339"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069714"><a href="#local-6989586621679069714"><span class="hs-identifier">he</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a><span> </span><a href="#local-6989586621679069713"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-340"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">mutate</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-341"></a><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-344"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-345"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:foldM&quot;.</span><span>
</span><a name="line-346"></a><span class="hs-identifier">foldM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069632"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069633"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><a href="#local-6989586621679069634"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069635"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069632"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069632"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069635"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069633"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069634"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069635"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069632"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-347"></a><a name="foldM"><a href="Data.HashTable.ST.Basic.html#foldM"><span class="hs-identifier">foldM</span></a></a><span> </span><a name="local-6989586621679069728"><a href="#local-6989586621679069728"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679069729"><a href="#local-6989586621679069729"><span class="hs-identifier">seed0</span></a></a><span> </span><a name="local-6989586621679069730"><a href="#local-6989586621679069730"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679069730"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679069731"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-348"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-349"></a><span>    </span><a name="local-6989586621679069731"><a href="#local-6989586621679069731"><span class="hs-identifier">work</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679069732"><a href="#local-6989586621679069732"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679069733"><a href="#local-6989586621679069733"><span class="hs-identifier">hashes</span></a></a><span> </span><a name="local-6989586621679069734"><a href="#local-6989586621679069734"><span class="hs-identifier">keys</span></a></a><span> </span><a name="local-6989586621679069735"><a href="#local-6989586621679069735"><span class="hs-identifier">values</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069736"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679069729"><span class="hs-identifier hs-var">seed0</span></a><span>
</span><a name="line-350"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-351"></a><span>        </span><a name="local-6989586621679069736"><a href="#local-6989586621679069736"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069737"><a href="#local-6989586621679069737"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069738"><a href="#local-6989586621679069738"><span class="hs-identifier">seed</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679069737"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679069732"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679069738"><span class="hs-identifier hs-var">seed</span></a><span>
</span><a name="line-352"></a><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-353"></a><span>            </span><a name="local-6989586621679069739"><a href="#local-6989586621679069739"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a><span> </span><a href="#local-6989586621679069733"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069737"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-354"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a><span> </span><a href="#local-6989586621679069739"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-var">recordIsDeleted</span></a><span> </span><a href="#local-6989586621679069739"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-355"></a><span>              </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679069736"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069737"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069738"><span class="hs-identifier hs-var">seed</span></a><span>
</span><a name="line-356"></a><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-357"></a><span>                </span><a name="local-6989586621679069740"><a href="#local-6989586621679069740"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069734"><span class="hs-identifier hs-var">keys</span></a><span> </span><a href="#local-6989586621679069737"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-358"></a><span>                </span><a name="local-6989586621679069741"><a href="#local-6989586621679069741"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069735"><span class="hs-identifier hs-var">values</span></a><span> </span><a href="#local-6989586621679069737"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-359"></a><span>                </span><span class="hs-glyph">!</span><a name="local-6989586621679069742"><a href="#local-6989586621679069742"><span class="hs-identifier">seed'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679069728"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679069738"><span class="hs-identifier hs-var">seed</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069740"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679069741"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-360"></a><span>                </span><a href="#local-6989586621679069736"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069737"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069742"><span class="hs-identifier hs-var">seed'</span></a><span>
</span><a name="line-361"></a><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-364"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:mapM_&quot;.</span><span>
</span><a name="line-366"></a><span class="hs-identifier">mapM_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679069628"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><a href="#local-6989586621679069629"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069630"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069631"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069630"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069628"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069629"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069630"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-367"></a><a name="mapM_"><a href="Data.HashTable.ST.Basic.html#mapM_"><span class="hs-identifier">mapM_</span></a></a><span> </span><a name="local-6989586621679069743"><a href="#local-6989586621679069743"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679069744"><a href="#local-6989586621679069744"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679069744"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679069745"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-368"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-369"></a><span>    </span><a name="local-6989586621679069745"><a href="#local-6989586621679069745"><span class="hs-identifier">work</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679069746"><a href="#local-6989586621679069746"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679069747"><a href="#local-6989586621679069747"><span class="hs-identifier">hashes</span></a></a><span> </span><a name="local-6989586621679069748"><a href="#local-6989586621679069748"><span class="hs-identifier">keys</span></a></a><span> </span><a name="local-6989586621679069749"><a href="#local-6989586621679069749"><span class="hs-identifier">values</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069750"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-370"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-371"></a><span>        </span><a name="local-6989586621679069750"><a href="#local-6989586621679069750"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069751"><a href="#local-6989586621679069751"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679069751"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679069746"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-372"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-373"></a><span>            </span><a name="local-6989586621679069752"><a href="#local-6989586621679069752"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a><span> </span><a href="#local-6989586621679069747"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069751"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-374"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a><span> </span><a href="#local-6989586621679069752"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-var">recordIsDeleted</span></a><span> </span><a href="#local-6989586621679069752"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-375"></a><span>              </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679069750"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069751"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-377"></a><span>                </span><a name="local-6989586621679069753"><a href="#local-6989586621679069753"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069748"><span class="hs-identifier hs-var">keys</span></a><span> </span><a href="#local-6989586621679069751"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-378"></a><span>                </span><a name="local-6989586621679069754"><a href="#local-6989586621679069754"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069749"><span class="hs-identifier hs-var">values</span></a><span> </span><a href="#local-6989586621679069751"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-379"></a><span>                </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679069743"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069753"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679069754"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-380"></a><span>                </span><a href="#local-6989586621679069750"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069751"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-381"></a><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-384"></a><span class="hs-comment">-- | See the documentation for this function in</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- &quot;Data.HashTable.Class#v:computeOverhead&quot;.</span><span>
</span><a name="line-386"></a><span class="hs-identifier">computeOverhead</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069625"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069626"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069627"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069625"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-387"></a><a name="computeOverhead"><a href="Data.HashTable.ST.Basic.html#computeOverhead"><span class="hs-identifier">computeOverhead</span></a></a><span> </span><a name="local-6989586621679069755"><a href="#local-6989586621679069755"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679069755"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679069756"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-388"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-389"></a><span>    </span><a name="local-6989586621679069756"><a href="#local-6989586621679069756"><span class="hs-identifier">work</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679069757"><a href="#local-6989586621679069757"><span class="hs-identifier">sz'</span></a></a><span> </span><a name="local-6989586621679069758"><a href="#local-6989586621679069758"><span class="hs-identifier">loadRef</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-390"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069762"><a href="#local-6989586621679069762"><span class="hs-identifier">ld</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#readLoad"><span class="hs-identifier hs-var">readLoad</span></a><span> </span><a href="#local-6989586621679069758"><span class="hs-identifier hs-var">loadRef</span></a><span>
</span><a name="line-391"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069763"><a href="#local-6989586621679069763"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679069762"><span class="hs-identifier hs-var">ld</span></a><span> </span><span class="hs-operator hs-var">/</span><span> </span><a href="#local-6989586621679069760"><span class="hs-identifier hs-var">sz</span></a><span>
</span><a name="line-392"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679069761"><span class="hs-identifier hs-var">constOverhead</span></a><span class="hs-operator hs-var">/</span><a href="#local-6989586621679069760"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">2</span><span class="hs-operator hs-var">*</span><a href="#local-6989586621679069759"><span class="hs-identifier hs-var">ws</span></a><span class="hs-operator hs-var">*</span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-glyph">-</span><a href="#local-6989586621679069763"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069763"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679069759"><span class="hs-identifier hs-var">ws</span></a><span class="hs-special">)</span><span>
</span><a name="line-393"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-394"></a><span>        </span><a name="local-6989586621679069759"><a href="#local-6989586621679069759"><span class="hs-identifier">ws</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-identifier hs-var">finiteBitSize</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-395"></a><span>        </span><a name="local-6989586621679069760"><a href="#local-6989586621679069760"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679069757"><span class="hs-identifier hs-var">sz'</span></a><span>
</span><a name="line-396"></a><span>        </span><span class="hs-comment">-- Change these if you change the representation</span><span>
</span><a name="line-397"></a><span>        </span><a name="local-6989586621679069761"><a href="#local-6989586621679069761"><span class="hs-identifier">constOverhead</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">14</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span>
</span><a name="line-400"></a><span class="hs-comment">------------------------------</span><span>
</span><a name="line-401"></a><span class="hs-comment">-- Private functions follow --</span><span>
</span><a name="line-402"></a><span class="hs-comment">------------------------------</span><span>
</span><a name="line-403"></a><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-406"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">insertRecord</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-407"></a><span class="hs-identifier">insertRecord</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-408"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#IntArray"><span class="hs-identifier hs-type">U.IntArray</span></a><span> </span><a href="#local-6989586621679069622"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-409"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MutableArray</span><span> </span><a href="#local-6989586621679069622"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069623"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-410"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">MutableArray</span><span> </span><a href="#local-6989586621679069622"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069624"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-411"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-412"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069623"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-413"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069624"><span class="hs-identifier hs-type">v</span></a><span>
</span><a name="line-414"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069622"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-415"></a><a name="insertRecord"><a href="Data.HashTable.ST.Basic.html#insertRecord"><span class="hs-identifier">insertRecord</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069764"><a href="#local-6989586621679069764"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069765"><a href="#local-6989586621679069765"><span class="hs-identifier">hashes</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069766"><a href="#local-6989586621679069766"><span class="hs-identifier">keys</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069767"><a href="#local-6989586621679069767"><span class="hs-identifier">values</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069768"><a href="#local-6989586621679069768"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069769"><a href="#local-6989586621679069769"><span class="hs-identifier">key</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069770"><a href="#local-6989586621679069770"><span class="hs-identifier">value</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-416"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069775"><a href="#local-6989586621679069775"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.Utils.html#whichBucket"><span class="hs-identifier hs-var">whichBucket</span></a><span> </span><a href="#local-6989586621679069768"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679069764"><span class="hs-identifier hs-var">sz</span></a><span>
</span><a name="line-417"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;insertRecord sz=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069764"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; h=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069768"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; b=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069775"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-418"></a><span>    </span><a href="#local-6989586621679069772"><span class="hs-identifier hs-var">probe</span></a><span> </span><a href="#local-6989586621679069775"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-421"></a><span>    </span><a name="local-6989586621679069771"><a href="#local-6989586621679069771"><span class="hs-identifier">he</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a><span> </span><a href="#local-6989586621679069768"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-422"></a><span>
</span><a name="line-423"></a><span>    </span><a name="local-6989586621679069772"><a href="#local-6989586621679069772"><span class="hs-identifier">probe</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069773"><a href="#local-6989586621679069773"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;insertRecord/probe&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-424"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069774"><a href="#local-6989586621679069774"><span class="hs-identifier">idx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.CacheLine.html#forwardSearch2"><span class="hs-identifier hs-var">forwardSearch2</span></a><span> </span><a href="#local-6989586621679069765"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069773"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679069764"><span class="hs-identifier hs-var">sz</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a><span>
</span><a name="line-425"></a><span>        </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;forwardSearch2 returned &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069774"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-426"></a><span>        </span><span class="hs-identifier hs-var">assert</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069774"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-427"></a><span>            </span><a href="Data.HashTable.Internal.IntArray.html#writeArray"><span class="hs-identifier hs-var">U.writeArray</span></a><span> </span><a href="#local-6989586621679069765"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069774"><span class="hs-identifier hs-var">idx</span></a><span> </span><a href="#local-6989586621679069771"><span class="hs-identifier hs-var">he</span></a><span>
</span><a name="line-428"></a><span>            </span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a><span> </span><a href="#local-6989586621679069766"><span class="hs-identifier hs-var">keys</span></a><span> </span><a href="#local-6989586621679069774"><span class="hs-identifier hs-var">idx</span></a><span> </span><a href="#local-6989586621679069769"><span class="hs-identifier hs-var">key</span></a><span>
</span><a name="line-429"></a><span>            </span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a><span> </span><a href="#local-6989586621679069767"><span class="hs-identifier hs-var">values</span></a><span> </span><a href="#local-6989586621679069774"><span class="hs-identifier hs-var">idx</span></a><span> </span><a href="#local-6989586621679069770"><span class="hs-identifier hs-var">value</span></a><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-433"></a><span class="hs-identifier">checkOverflow</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679069619"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679069619"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-434"></a><span>                 </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069620"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069619"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069621"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-435"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069620"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069620"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069619"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069621"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-436"></a><a name="checkOverflow"><a href="Data.HashTable.ST.Basic.html#checkOverflow"><span class="hs-identifier">checkOverflow</span></a></a><span> </span><a name="local-6989586621679069776"><a href="#local-6989586621679069776"><span class="hs-identifier">ht</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679069777"><a href="#local-6989586621679069777"><span class="hs-identifier">sz</span></a></a><span> </span><a name="local-6989586621679069778"><a href="#local-6989586621679069778"><span class="hs-identifier">ldRef</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-437"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069779"><a href="#local-6989586621679069779"><span class="hs-identifier">ld</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#readLoad"><span class="hs-identifier hs-var">readLoad</span></a><span> </span><a href="#local-6989586621679069778"><span class="hs-identifier hs-var">ldRef</span></a><span>
</span><a name="line-438"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069780"><a href="#local-6989586621679069780"><span class="hs-identifier">dl</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#readDelLoad"><span class="hs-identifier hs-var">readDelLoad</span></a><span> </span><a href="#local-6989586621679069778"><span class="hs-identifier hs-var">ldRef</span></a><span>
</span><a name="line-439"></a><span>
</span><a name="line-440"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;checkOverflow: sz=&quot;</span><span>
</span><a name="line-441"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069777"><span class="hs-identifier hs-var">sz</span></a><span>
</span><a name="line-442"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot; entries=&quot;</span><span>
</span><a name="line-443"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069779"><span class="hs-identifier hs-var">ld</span></a><span>
</span><a name="line-444"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot; deleted=&quot;</span><span>
</span><a name="line-445"></a><span>                   </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069780"><span class="hs-identifier hs-var">dl</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069779"><span class="hs-identifier hs-var">ld</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679069780"><span class="hs-identifier hs-var">dl</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679069777"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="Data.HashTable.ST.Basic.html#maxLoad"><span class="hs-identifier hs-var">maxLoad</span></a><span>
</span><a name="line-448"></a><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679069780"><span class="hs-identifier hs-var">dl</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><a href="#local-6989586621679069779"><span class="hs-identifier hs-var">ld</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">div</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-449"></a><span>             </span><span class="hs-keyword">then</span><span> </span><a href="Data.HashTable.ST.Basic.html#rehashAll"><span class="hs-identifier hs-var">rehashAll</span></a><span> </span><a href="#local-6989586621679069776"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="#local-6989586621679069777"><span class="hs-identifier hs-var">sz</span></a><span>
</span><a name="line-450"></a><span>             </span><span class="hs-keyword">else</span><span> </span><a href="Data.HashTable.ST.Basic.html#growTable"><span class="hs-identifier hs-var">growTable</span></a><span> </span><a href="#local-6989586621679069776"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-451"></a><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679069776"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span>
</span><a name="line-454"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-455"></a><span class="hs-identifier">rehashAll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679069616"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069617"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069616"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069618"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069617"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069617"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069616"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069618"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-456"></a><a name="rehashAll"><a href="Data.HashTable.ST.Basic.html#rehashAll"><span class="hs-identifier">rehashAll</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679069781"><a href="#local-6989586621679069781"><span class="hs-identifier">sz</span></a></a><span> </span><a name="local-6989586621679069782"><a href="#local-6989586621679069782"><span class="hs-identifier">loadRef</span></a></a><span> </span><a name="local-6989586621679069783"><a href="#local-6989586621679069783"><span class="hs-identifier">hashes</span></a></a><span> </span><a name="local-6989586621679069784"><a href="#local-6989586621679069784"><span class="hs-identifier">keys</span></a></a><span> </span><a name="local-6989586621679069785"><a href="#local-6989586621679069785"><span class="hs-identifier">values</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679069786"><a href="#local-6989586621679069786"><span class="hs-identifier">sz'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-457"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;rehashing: old size &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069781"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;, new size &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069786"><span class="hs-identifier hs-var">sz'</span></a><span>
</span><a name="line-458"></a><span>    </span><a name="local-6989586621679069796"><a href="#local-6989586621679069796"><span class="hs-identifier">ht'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#newSizedReal"><span class="hs-identifier hs-var">newSizedReal</span></a><span> </span><a href="#local-6989586621679069786"><span class="hs-identifier hs-var">sz'</span></a><span>
</span><a name="line-459"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679069797"><a href="#local-6989586621679069797"><span class="hs-identifier">loadRef'</span></a></a><span> </span><a name="local-6989586621679069798"><a href="#local-6989586621679069798"><span class="hs-identifier">newHashes</span></a></a><span> </span><a name="local-6989586621679069799"><a href="#local-6989586621679069799"><span class="hs-identifier">newKeys</span></a></a><span> </span><a name="local-6989586621679069800"><a href="#local-6989586621679069800"><span class="hs-identifier">newValues</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069796"><span class="hs-identifier hs-var">ht'</span></a><span>
</span><a name="line-460"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#readLoad"><span class="hs-identifier hs-var">readLoad</span></a><span> </span><a href="#local-6989586621679069782"><span class="hs-identifier hs-var">loadRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Data.HashTable.ST.Basic.html#writeLoad"><span class="hs-identifier hs-var">writeLoad</span></a><span> </span><a href="#local-6989586621679069797"><span class="hs-identifier hs-var">loadRef'</span></a><span>
</span><a name="line-461"></a><span>    </span><a href="#local-6989586621679069787"><span class="hs-identifier hs-var">rehash</span></a><span> </span><a href="#local-6989586621679069798"><span class="hs-identifier hs-var">newHashes</span></a><span> </span><a href="#local-6989586621679069799"><span class="hs-identifier hs-var">newKeys</span></a><span> </span><a href="#local-6989586621679069800"><span class="hs-identifier hs-var">newValues</span></a><span>
</span><a name="line-462"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679069796"><span class="hs-identifier hs-var">ht'</span></a><span>
</span><a name="line-463"></a><span>
</span><a name="line-464"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-465"></a><span>    </span><a name="local-6989586621679069787"><a href="#local-6989586621679069787"><span class="hs-identifier">rehash</span></a></a><span> </span><a name="local-6989586621679069788"><a href="#local-6989586621679069788"><span class="hs-identifier">newHashes</span></a></a><span> </span><a name="local-6989586621679069789"><a href="#local-6989586621679069789"><span class="hs-identifier">newKeys</span></a></a><span> </span><a name="local-6989586621679069790"><a href="#local-6989586621679069790"><span class="hs-identifier">newValues</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069791"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-466"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-467"></a><span>        </span><a name="local-6989586621679069791"><a href="#local-6989586621679069791"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069792"><a href="#local-6989586621679069792"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679069792"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679069781"><span class="hs-identifier hs-var">sz</span></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-468"></a><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;growTable/rehash&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-469"></a><span>                    </span><a name="local-6989586621679069793"><a href="#local-6989586621679069793"><span class="hs-identifier">h0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a><span> </span><a href="#local-6989586621679069783"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069792"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-470"></a><span>                    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a><span> </span><a href="#local-6989586621679069793"><span class="hs-identifier hs-var">h0</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-var">recordIsDeleted</span></a><span> </span><a href="#local-6989586621679069793"><span class="hs-identifier hs-var">h0</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-471"></a><span>                        </span><a name="local-6989586621679069794"><a href="#local-6989586621679069794"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069784"><span class="hs-identifier hs-var">keys</span></a><span> </span><a href="#local-6989586621679069792"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-472"></a><span>                        </span><a name="local-6989586621679069795"><a href="#local-6989586621679069795"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069785"><span class="hs-identifier hs-var">values</span></a><span> </span><a href="#local-6989586621679069792"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-473"></a><span>                        </span><a href="Data.HashTable.ST.Basic.html#insertRecord"><span class="hs-identifier hs-var">insertRecord</span></a><span> </span><a href="#local-6989586621679069786"><span class="hs-identifier hs-var">sz'</span></a><span> </span><a href="#local-6989586621679069788"><span class="hs-identifier hs-var">newHashes</span></a><span> </span><a href="#local-6989586621679069789"><span class="hs-identifier hs-var">newKeys</span></a><span> </span><a href="#local-6989586621679069790"><span class="hs-identifier hs-var">newValues</span></a><span>
</span><a name="line-474"></a><span>                                     </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a><span> </span><a href="#local-6989586621679069794"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069794"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679069795"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-475"></a><span>                    </span><a href="#local-6989586621679069791"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679069792"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span>
</span><a name="line-476"></a><span>
</span><a name="line-477"></a><span>
</span><a name="line-478"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-479"></a><span class="hs-identifier">growTable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679069613"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069614"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069613"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069615"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069614"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069614"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069613"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069615"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-480"></a><a name="growTable"><a href="Data.HashTable.ST.Basic.html#growTable"><span class="hs-identifier">growTable</span></a></a><span> </span><a name="local-6989586621679069801"><a href="#local-6989586621679069801"><span class="hs-identifier">ht</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679069802"><a href="#local-6989586621679069802"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-481"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069803"><a href="#local-6989586621679069803"><span class="hs-identifier">sz'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.Utils.html#bumpSize"><span class="hs-identifier hs-var">bumpSize</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#maxLoad"><span class="hs-identifier hs-var">maxLoad</span></a><span> </span><a href="#local-6989586621679069802"><span class="hs-identifier hs-var">sz</span></a><span>
</span><a name="line-482"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#rehashAll"><span class="hs-identifier hs-var">rehashAll</span></a><span> </span><a href="#local-6989586621679069801"><span class="hs-identifier hs-var">ht</span></a><span> </span><a href="#local-6989586621679069803"><span class="hs-identifier hs-var">sz'</span></a><span>
</span><a name="line-483"></a><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-486"></a><span class="hs-comment">-- Helper data structure for findSafeSlots</span><span>
</span><a name="line-487"></a><span class="hs-keyword">newtype</span><span> </span><a name="Slot"><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier">Slot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Slot"><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier">Slot</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="_slot"><a href="Data.HashTable.ST.Basic.html#_slot"><span class="hs-identifier">_slot</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-488"></a><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-491"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-type">Slot</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-492"></a><span>    </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a><span> </span><span class="hs-identifier hs-var">maxBound</span><span>
</span><a name="line-493"></a><span class="hs-cpp">#if !MIN_VERSION_base(4,11,0)
</span><span>    </span><span class="hs-special">(</span><span class="hs-identifier">Slot</span><span> </span><span class="hs-identifier">x1</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Slot</span><span> </span><span class="hs-identifier">x2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-495"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">m</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mask</span><span> </span><span class="hs-identifier">x1</span><span> </span><span class="hs-identifier">maxBound</span><span>
</span><a name="line-496"></a><span>        </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">Slot</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">complement</span><span> </span><span class="hs-identifier">m</span><span> </span><span class="hs-operator">.&amp;.</span><span> </span><span class="hs-identifier">x1</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.|.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">m</span><span> </span><span class="hs-operator">.&amp;.</span><span> </span><span class="hs-identifier">x2</span><span class="hs-special">)</span><span>
</span><a name="line-497"></a><span class="hs-cpp">#else
</span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span> </span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-type">Slot</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-499"></a><span>    </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a><span> </span><a name="local-6989586621679069579"><a href="#local-6989586621679069579"><span class="hs-identifier">x1</span></a></a><span class="hs-special">)</span><span> </span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a><span> </span><a name="local-6989586621679069580"><a href="#local-6989586621679069580"><span class="hs-identifier">x2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-500"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069581"><a href="#local-6989586621679069581"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.CacheLine.html#mask"><span class="hs-identifier hs-var">mask</span></a><span> </span><a href="#local-6989586621679069579"><span class="hs-identifier hs-var">x1</span></a><span> </span><span class="hs-identifier hs-var">maxBound</span><span>
</span><a name="line-501"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">complement</span><span> </span><a href="#local-6989586621679069581"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621679069579"><span class="hs-identifier hs-var">x1</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069581"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="#local-6989586621679069580"><span class="hs-identifier hs-var">x2</span></a><span class="hs-special">)</span><span>
</span><a name="line-502"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-504"></a><span>
</span><a name="line-505"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-506"></a><span class="hs-comment">-- findSafeSlots return type</span><span>
</span><a name="line-507"></a><span class="hs-keyword">data</span><span> </span><a name="SlotFindResponse"><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier">SlotFindResponse</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SlotFindResponse"><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier">SlotFindResponse</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-508"></a><span>    </span><a name="_slotFound"><a href="Data.HashTable.ST.Basic.html#_slotFound"><span class="hs-identifier">_slotFound</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- we use Int because Bool won't unpack</span><span>
</span><a name="line-509"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_slotB0"><a href="Data.HashTable.ST.Basic.html#_slotB0"><span class="hs-identifier">_slotB0</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-510"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_slotB1"><a href="Data.HashTable.ST.Basic.html#_slotB1"><span class="hs-identifier">_slotB1</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-511"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-512"></a><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-515"></a><span class="hs-comment">-- Returns ST s (SlotFoundResponse found b0 b1),</span><span>
</span><a name="line-516"></a><span class="hs-comment">-- where</span><span>
</span><a name="line-517"></a><span class="hs-comment">--     * found :: Int  - 1 if key-value mapping is already in the table,</span><span>
</span><a name="line-518"></a><span class="hs-comment">--                       0 otherwise.</span><span>
</span><a name="line-519"></a><span class="hs-comment">--     * b0    :: Int  - The index of a slot where it would be safe to write</span><span>
</span><a name="line-520"></a><span class="hs-comment">--                       the given key (if the key is already in the mapping,</span><span>
</span><a name="line-521"></a><span class="hs-comment">--                       you have to delete it before using this slot).</span><span>
</span><a name="line-522"></a><span class="hs-comment">--     * b1    :: Int  - The index of a slot where the key currently resides.</span><span>
</span><a name="line-523"></a><span class="hs-comment">--                       Or, if the key is not in the table, b1 is a slot</span><span>
</span><a name="line-524"></a><span class="hs-comment">--                       where it is safe to write the key (b1 == b0).</span><span>
</span><a name="line-525"></a><span class="hs-identifier">findSafeSlots</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679069610"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679069610"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><a name="line-526"></a><span>                 </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069611"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069610"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069612"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-527"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069610"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-528"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-529"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069611"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-type">SlotFindResponse</span></a><span>
</span><a name="line-530"></a><a name="findSafeSlots"><a href="Data.HashTable.ST.Basic.html#findSafeSlots"><span class="hs-identifier">findSafeSlots</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069804"><a href="#local-6989586621679069804"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679069805"><a href="#local-6989586621679069805"><span class="hs-identifier">hashes</span></a></a><span> </span><a name="local-6989586621679069806"><a href="#local-6989586621679069806"><span class="hs-identifier">keys</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679069807"><a href="#local-6989586621679069807"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679069808"><a href="#local-6989586621679069808"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-531"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;findSafeSlots: h=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069808"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; he=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069809"><span class="hs-identifier hs-var">he</span></a><span>
</span><a name="line-532"></a><span>            </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; sz=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069804"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; b0=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069810"><span class="hs-identifier hs-var">b0</span></a><span>
</span><a name="line-533"></a><span>    </span><a name="local-6989586621679069826"><a href="#local-6989586621679069826"><span class="hs-identifier">response</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679069812"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-identifier hs-var">mempty</span><span> </span><a href="#local-6989586621679069810"><span class="hs-identifier hs-var">b0</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-534"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;go returned &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069826"><span class="hs-identifier hs-var">response</span></a><span>
</span><a name="line-535"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679069826"><span class="hs-identifier hs-var">response</span></a><span>
</span><a name="line-536"></a><span>
</span><a name="line-537"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-538"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069809"><a href="#local-6989586621679069809"><span class="hs-identifier">he</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a><span> </span><a href="#local-6989586621679069808"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-539"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069810"><a href="#local-6989586621679069810"><span class="hs-identifier">b0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.Utils.html#whichBucket"><span class="hs-identifier hs-var">whichBucket</span></a><span> </span><a href="#local-6989586621679069808"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679069804"><span class="hs-identifier hs-var">sz</span></a><span>
</span><a name="line-540"></a><span>    </span><a name="local-6989586621679069811"><a href="#local-6989586621679069811"><span class="hs-identifier">haveWrapped</span></a></a><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a><span> </span><a name="local-6989586621679069813"><a href="#local-6989586621679069813"><span class="hs-identifier">fp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069814"><a href="#local-6989586621679069814"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679069813"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">maxBound</span><span>
</span><a name="line-541"></a><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-542"></a><span>                                    </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679069814"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><a href="#local-6989586621679069813"><span class="hs-identifier hs-var">fp</span></a><span>
</span><a name="line-543"></a><span>
</span><a name="line-544"></a><span>    </span><span class="hs-comment">-- arguments:</span><span>
</span><a name="line-545"></a><span>
</span><a name="line-546"></a><span>    </span><span class="hs-comment">--   * fp    maintains the slot in the array where it would be safe to</span><span>
</span><a name="line-547"></a><span>    </span><span class="hs-comment">--           write the given key</span><span>
</span><a name="line-548"></a><span>    </span><span class="hs-comment">--   * b     search the buckets array starting at this index.</span><span>
</span><a name="line-549"></a><span>    </span><span class="hs-comment">--   * wrap  True if we've wrapped around, False otherwise</span><span>
</span><a name="line-550"></a><span>
</span><a name="line-551"></a><span>    </span><a name="local-6989586621679069812"><a href="#local-6989586621679069812"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069815"><a href="#local-6989586621679069815"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069816"><a href="#local-6989586621679069816"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069817"><a href="#local-6989586621679069817"><span class="hs-identifier">wrap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-552"></a><span>        </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;go: fp=&quot;</span><span>
</span><a name="line-553"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069815"><span class="hs-identifier hs-var">fp</span></a><span>
</span><a name="line-554"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot; b=&quot;</span><span>
</span><a name="line-555"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069816"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-556"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;, wrap=&quot;</span><span>
</span><a name="line-557"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069817"><span class="hs-identifier hs-var">wrap</span></a><span>
</span><a name="line-558"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;, he=&quot;</span><span>
</span><a name="line-559"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069809"><span class="hs-identifier hs-var">he</span></a><span>
</span><a name="line-560"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;, emptyMarker=&quot;</span><span>
</span><a name="line-561"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a><span>
</span><a name="line-562"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;, deletedMarker=&quot;</span><span>
</span><a name="line-563"></a><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a><span> </span><span class="hs-special">]</span><span>
</span><a name="line-564"></a><span>
</span><a name="line-565"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069818"><a href="#local-6989586621679069818"><span class="hs-identifier">idx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.CacheLine.html#forwardSearch3"><span class="hs-identifier hs-var">forwardSearch3</span></a><span> </span><a href="#local-6989586621679069805"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069816"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679069804"><span class="hs-identifier hs-var">sz</span></a><span> </span><a href="#local-6989586621679069809"><span class="hs-identifier hs-var">he</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a><span>
</span><a name="line-566"></a><span>        </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;forwardSearch3 returned &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-567"></a><span>                </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; with sz=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069804"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;, b=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069816"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-568"></a><span>
</span><a name="line-569"></a><span>        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679069817"><span class="hs-identifier hs-var">wrap</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679069810"><span class="hs-identifier hs-var">b0</span></a><span>
</span><a name="line-570"></a><span>          </span><span class="hs-comment">-- we wrapped around in the search and didn't find our hash code;</span><span>
</span><a name="line-571"></a><span>          </span><span class="hs-comment">-- this means that the table is full of deleted elements. Just return</span><span>
</span><a name="line-572"></a><span>          </span><span class="hs-comment">-- the first place we'd be allowed to insert.</span><span>
</span><a name="line-573"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-574"></a><span>          </span><span class="hs-comment">-- TODO: if we get in this situation we should probably just rehash</span><span>
</span><a name="line-575"></a><span>          </span><span class="hs-comment">-- the table, because every insert is going to be O(n).</span><span>
</span><a name="line-576"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-577"></a><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069819"><a href="#local-6989586621679069819"><span class="hs-identifier">sl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069815"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;impossible&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-578"></a><span>            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-var">SlotFindResponse</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_slot</span><span> </span><a href="#local-6989586621679069819"><span class="hs-identifier hs-var">sl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_slot</span><span> </span><a href="#local-6989586621679069819"><span class="hs-identifier hs-var">sl</span></a><span class="hs-special">)</span><span>
</span><a name="line-579"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-580"></a><span>            </span><span class="hs-comment">-- because the table isn't full, we know that there must be either</span><span>
</span><a name="line-581"></a><span>            </span><span class="hs-comment">-- an empty or a deleted marker somewhere in the table. Assert this</span><span>
</span><a name="line-582"></a><span>            </span><span class="hs-comment">-- here.</span><span>
</span><a name="line-583"></a><span>            </span><span class="hs-identifier hs-var">assert</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-584"></a><span>            </span><a name="local-6989586621679069820"><a href="#local-6989586621679069820"><span class="hs-identifier">h0</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a><span> </span><a href="#local-6989586621679069805"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-585"></a><span>            </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;h0 was &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069820"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-586"></a><span>
</span><a name="line-587"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a><span> </span><a href="#local-6989586621679069820"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-588"></a><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-589"></a><span>                  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679069821"><a href="#local-6989586621679069821"><span class="hs-identifier">pl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069815"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a><span> </span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span class="hs-special">)</span><span>
</span><a name="line-590"></a><span>                  </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;empty, returning &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069821"><span class="hs-identifier hs-var">pl</span></a><span>
</span><a name="line-591"></a><span>                  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-var">SlotFindResponse</span></a><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_slot</span><span> </span><a href="#local-6989586621679069821"><span class="hs-identifier hs-var">pl</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_slot</span><span> </span><a href="#local-6989586621679069821"><span class="hs-identifier hs-var">pl</span></a><span class="hs-special">)</span><span>
</span><a name="line-592"></a><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-593"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069822"><a href="#local-6989586621679069822"><span class="hs-identifier">wrap'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069811"><span class="hs-identifier hs-var">haveWrapped</span></a><span> </span><a href="#local-6989586621679069815"><span class="hs-identifier hs-var">fp</span></a><span> </span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-594"></a><span>                </span><span class="hs-keyword">if</span><span> </span><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-var">recordIsDeleted</span></a><span> </span><a href="#local-6989586621679069820"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-595"></a><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-596"></a><span>                      </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069823"><a href="#local-6989586621679069823"><span class="hs-identifier">pl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069815"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a><span> </span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span class="hs-special">)</span><span>
</span><a name="line-597"></a><span>                      </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;deleted, cont with pl=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069823"><span class="hs-identifier hs-var">pl</span></a><span>
</span><a name="line-598"></a><span>                      </span><a href="#local-6989586621679069812"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679069823"><span class="hs-identifier hs-var">pl</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069822"><span class="hs-identifier hs-var">wrap'</span></a><span>
</span><a name="line-599"></a><span>                  </span><span class="hs-keyword">else</span><span>
</span><a name="line-600"></a><span>                    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679069809"><span class="hs-identifier hs-var">he</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679069820"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-601"></a><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-602"></a><span>                        </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;found he == h0 == &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069820"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-603"></a><span>                        </span><a name="local-6989586621679069824"><a href="#local-6989586621679069824"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069806"><span class="hs-identifier hs-var">keys</span></a><span> </span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-604"></a><span>                        </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679069807"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679069824"><span class="hs-identifier hs-var">k'</span></a><span>
</span><a name="line-605"></a><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-606"></a><span>                            </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;found at &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-607"></a><span>                            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069825"><a href="#local-6989586621679069825"><span class="hs-identifier">sl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069815"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mappend</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#Slot"><span class="hs-identifier hs-var">Slot</span></a><span> </span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span class="hs-special">)</span><span>
</span><a name="line-608"></a><span>                            </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="Data.HashTable.ST.Basic.html#SlotFindResponse"><span class="hs-identifier hs-var">SlotFindResponse</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_slot</span><span> </span><a href="#local-6989586621679069825"><span class="hs-identifier hs-var">sl</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-609"></a><span>                          </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679069812"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679069815"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069822"><span class="hs-identifier hs-var">wrap'</span></a><span>
</span><a name="line-610"></a><span>                      </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679069812"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679069815"><span class="hs-identifier hs-var">fp</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069818"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069822"><span class="hs-identifier hs-var">wrap'</span></a><span>
</span><a name="line-611"></a><span>
</span><a name="line-612"></a><span>
</span><a name="line-613"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-614"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">deleteFromSlot</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-615"></a><span class="hs-identifier">deleteFromSlot</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069607"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069608"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069609"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069607"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-616"></a><a name="deleteFromSlot"><a href="Data.HashTable.ST.Basic.html#deleteFromSlot"><span class="hs-identifier">deleteFromSlot</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679069827"><a href="#local-6989586621679069827"><span class="hs-identifier">loadRef</span></a></a><span> </span><a name="local-6989586621679069828"><a href="#local-6989586621679069828"><span class="hs-identifier">hashes</span></a></a><span> </span><a name="local-6989586621679069829"><a href="#local-6989586621679069829"><span class="hs-identifier">keys</span></a></a><span> </span><a name="local-6989586621679069830"><a href="#local-6989586621679069830"><span class="hs-identifier">values</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679069831"><a href="#local-6989586621679069831"><span class="hs-identifier">idx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-617"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069832"><a href="#local-6989586621679069832"><span class="hs-identifier">he</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a><span> </span><a href="#local-6989586621679069828"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069831"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-618"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#recordIsFilled"><span class="hs-identifier hs-var">recordIsFilled</span></a><span> </span><a href="#local-6989586621679069832"><span class="hs-identifier hs-var">he</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-619"></a><span>        </span><a href="Data.HashTable.ST.Basic.html#bumpDelLoad"><span class="hs-identifier hs-var">bumpDelLoad</span></a><span> </span><a href="#local-6989586621679069827"><span class="hs-identifier hs-var">loadRef</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-620"></a><span>        </span><a href="Data.HashTable.ST.Basic.html#bumpLoad"><span class="hs-identifier hs-var">bumpLoad</span></a><span> </span><a href="#local-6989586621679069827"><span class="hs-identifier hs-var">loadRef</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-621"></a><span>        </span><a href="Data.HashTable.Internal.IntArray.html#writeArray"><span class="hs-identifier hs-var">U.writeArray</span></a><span> </span><a href="#local-6989586621679069828"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069831"><span class="hs-identifier hs-var">idx</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a><span>
</span><a name="line-622"></a><span>        </span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a><span> </span><a href="#local-6989586621679069829"><span class="hs-identifier hs-var">keys</span></a><span> </span><a href="#local-6989586621679069831"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-623"></a><span>        </span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a><span> </span><a href="#local-6989586621679069830"><span class="hs-identifier hs-var">values</span></a><span> </span><a href="#local-6989586621679069831"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-624"></a><span>
</span><a name="line-625"></a><span>
</span><a name="line-626"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-627"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">insertIntoSlot</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-628"></a><span class="hs-identifier">insertIntoSlot</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069604"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069605"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069606"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069605"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069606"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069604"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-629"></a><a name="insertIntoSlot"><a href="Data.HashTable.ST.Basic.html#insertIntoSlot"><span class="hs-identifier">insertIntoSlot</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679069833"><a href="#local-6989586621679069833"><span class="hs-identifier">loadRef</span></a></a><span> </span><a name="local-6989586621679069834"><a href="#local-6989586621679069834"><span class="hs-identifier">hashes</span></a></a><span> </span><a name="local-6989586621679069835"><a href="#local-6989586621679069835"><span class="hs-identifier">keys</span></a></a><span> </span><a name="local-6989586621679069836"><a href="#local-6989586621679069836"><span class="hs-identifier">values</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679069837"><a href="#local-6989586621679069837"><span class="hs-identifier">idx</span></a></a><span> </span><a name="local-6989586621679069838"><a href="#local-6989586621679069838"><span class="hs-identifier">he</span></a></a><span> </span><a name="local-6989586621679069839"><a href="#local-6989586621679069839"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679069840"><a href="#local-6989586621679069840"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-630"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069841"><a href="#local-6989586621679069841"><span class="hs-identifier">heOld</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a><span> </span><a href="#local-6989586621679069834"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069837"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-631"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069842"><a href="#local-6989586621679069842"><span class="hs-identifier">heInt</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679069841"><span class="hs-identifier hs-var">heOld</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-632"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069843"><a href="#local-6989586621679069843"><span class="hs-identifier">delInt</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-633"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069844"><a href="#local-6989586621679069844"><span class="hs-identifier">emptyInt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-634"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069845"><a href="#local-6989586621679069845"><span class="hs-identifier">delBump</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.CacheLine.html#mask"><span class="hs-identifier hs-var">mask</span></a><span> </span><a href="#local-6989586621679069842"><span class="hs-identifier hs-var">heInt</span></a><span> </span><a href="#local-6989586621679069843"><span class="hs-identifier hs-var">delInt</span></a><span> </span><span class="hs-comment">-- -1 if heInt == delInt,</span><span>
</span><a name="line-635"></a><span>                                      </span><span class="hs-comment">--  0  otherwise</span><span>
</span><a name="line-636"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069846"><a href="#local-6989586621679069846"><span class="hs-identifier">mLoad</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.CacheLine.html#mask"><span class="hs-identifier hs-var">mask</span></a><span> </span><a href="#local-6989586621679069842"><span class="hs-identifier hs-var">heInt</span></a><span> </span><a href="#local-6989586621679069843"><span class="hs-identifier hs-var">delInt</span></a><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><a href="Data.HashTable.Internal.CacheLine.html#mask"><span class="hs-identifier hs-var">mask</span></a><span> </span><a href="#local-6989586621679069842"><span class="hs-identifier hs-var">heInt</span></a><span> </span><a href="#local-6989586621679069844"><span class="hs-identifier hs-var">emptyInt</span></a><span>
</span><a name="line-637"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069847"><a href="#local-6989586621679069847"><span class="hs-identifier">loadBump</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069846"><span class="hs-identifier hs-var">mLoad</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-comment">-- 1 if heInt == delInt || heInt == emptyInt,</span><span>
</span><a name="line-638"></a><span>                                </span><span class="hs-comment">-- 0 otherwise</span><span>
</span><a name="line-639"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#bumpDelLoad"><span class="hs-identifier hs-var">bumpDelLoad</span></a><span> </span><a href="#local-6989586621679069833"><span class="hs-identifier hs-var">loadRef</span></a><span> </span><a href="#local-6989586621679069845"><span class="hs-identifier hs-var">delBump</span></a><span>
</span><a name="line-640"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#bumpLoad"><span class="hs-identifier hs-var">bumpLoad</span></a><span> </span><a href="#local-6989586621679069833"><span class="hs-identifier hs-var">loadRef</span></a><span> </span><a href="#local-6989586621679069847"><span class="hs-identifier hs-var">loadBump</span></a><span>
</span><a name="line-641"></a><span>    </span><a href="Data.HashTable.Internal.IntArray.html#writeArray"><span class="hs-identifier hs-var">U.writeArray</span></a><span> </span><a href="#local-6989586621679069834"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069837"><span class="hs-identifier hs-var">idx</span></a><span> </span><a href="#local-6989586621679069838"><span class="hs-identifier hs-var">he</span></a><span>
</span><a name="line-642"></a><span>    </span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a><span> </span><a href="#local-6989586621679069835"><span class="hs-identifier hs-var">keys</span></a><span> </span><a href="#local-6989586621679069837"><span class="hs-identifier hs-var">idx</span></a><span> </span><a href="#local-6989586621679069839"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-643"></a><span>    </span><a href="Data.HashTable.Internal.Array.html#writeArray"><span class="hs-identifier hs-var">writeArray</span></a><span> </span><a href="#local-6989586621679069836"><span class="hs-identifier hs-var">values</span></a><span> </span><a href="#local-6989586621679069837"><span class="hs-identifier hs-var">idx</span></a><span> </span><a href="#local-6989586621679069840"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-644"></a><span>
</span><a name="line-645"></a><span>
</span><a name="line-646"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-647"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bumpLoad</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-648"></a><span class="hs-identifier">bumpLoad</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a><span> </span><a href="#local-6989586621679069603"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069603"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-649"></a><a name="bumpLoad"><a href="Data.HashTable.ST.Basic.html#bumpLoad"><span class="hs-identifier">bumpLoad</span></a></a><span> </span><a name="local-6989586621679069848"><a href="#local-6989586621679069848"><span class="hs-identifier">ref</span></a></a><span> </span><a name="local-6989586621679069849"><a href="#local-6989586621679069849"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-650"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069850"><a href="#local-6989586621679069850"><span class="hs-identifier">ld</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#readLoad"><span class="hs-identifier hs-var">readLoad</span></a><span> </span><a href="#local-6989586621679069848"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-651"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#writeLoad"><span class="hs-identifier hs-var">writeLoad</span></a><span> </span><a href="#local-6989586621679069848"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="#local-6989586621679069850"><span class="hs-identifier hs-var">ld</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679069849"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-652"></a><span>
</span><a name="line-653"></a><span>
</span><a name="line-654"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-655"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">bumpDelLoad</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-656"></a><span class="hs-identifier">bumpDelLoad</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#SizeRefs"><span class="hs-identifier hs-type">SizeRefs</span></a><span> </span><a href="#local-6989586621679069602"><span class="hs-identifier hs-type">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069602"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-657"></a><a name="bumpDelLoad"><a href="Data.HashTable.ST.Basic.html#bumpDelLoad"><span class="hs-identifier">bumpDelLoad</span></a></a><span> </span><a name="local-6989586621679069851"><a href="#local-6989586621679069851"><span class="hs-identifier">ref</span></a></a><span> </span><a name="local-6989586621679069852"><a href="#local-6989586621679069852"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-658"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069853"><a href="#local-6989586621679069853"><span class="hs-identifier">ld</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#readDelLoad"><span class="hs-identifier hs-var">readDelLoad</span></a><span> </span><a href="#local-6989586621679069851"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-659"></a><span>    </span><a href="Data.HashTable.ST.Basic.html#writeDelLoad"><span class="hs-identifier hs-var">writeDelLoad</span></a><span> </span><a href="#local-6989586621679069851"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-operator hs-var">$!</span><span> </span><a href="#local-6989586621679069853"><span class="hs-identifier hs-var">ld</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679069852"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-660"></a><span>
</span><a name="line-661"></a><span>
</span><a name="line-662"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-663"></a><span class="hs-identifier">maxLoad</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Double</span><span>
</span><a name="line-664"></a><a name="maxLoad"><a href="Data.HashTable.ST.Basic.html#maxLoad"><span class="hs-identifier">maxLoad</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0.82</span><span>
</span><a name="line-665"></a><span>
</span><a name="line-666"></a><span>
</span><a name="line-667"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-668"></a><span class="hs-identifier">emptyMarker</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a><span>
</span><a name="line-669"></a><a name="emptyMarker"><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier">emptyMarker</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-670"></a><span>
</span><a name="line-671"></a><span>
</span><a name="line-672"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-673"></a><span class="hs-identifier">deletedMarker</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a><span>
</span><a name="line-674"></a><a name="deletedMarker"><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier">deletedMarker</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-675"></a><span>
</span><a name="line-676"></a><span>
</span><a name="line-677"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-678"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">trueInt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-679"></a><span class="hs-identifier">trueInt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-680"></a><a name="trueInt"><a href="Data.HashTable.ST.Basic.html#trueInt"><span class="hs-identifier">trueInt</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">I#</span><span> </span><a name="local-6989586621679069854"><a href="#local-6989586621679069854"><span class="hs-identifier">i#</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tagToEnum#</span><span> </span><a href="#local-6989586621679069854"><span class="hs-identifier hs-var">i#</span></a><span>
</span><a name="line-681"></a><span>
</span><a name="line-682"></a><span>
</span><a name="line-683"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-684"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">recordIsEmpty</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-685"></a><span class="hs-identifier">recordIsEmpty</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-686"></a><a name="recordIsEmpty"><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier">recordIsEmpty</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a><span class="hs-special">)</span><span>
</span><a name="line-687"></a><span>
</span><a name="line-688"></a><span>
</span><a name="line-689"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-690"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">recordIsDeleted</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-691"></a><span class="hs-identifier">recordIsDeleted</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-692"></a><a name="recordIsDeleted"><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier">recordIsDeleted</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a><span class="hs-special">)</span><span>
</span><a name="line-693"></a><span>
</span><a name="line-694"></a><span>
</span><a name="line-695"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-696"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">recordIsFilled</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-697"></a><span class="hs-identifier">recordIsFilled</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-698"></a><a name="recordIsFilled"><a href="Data.HashTable.ST.Basic.html#recordIsFilled"><span class="hs-identifier">recordIsFilled</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069855"><a href="#local-6989586621679069855"><span class="hs-identifier">el</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tagToEnum#</span><span> </span><a href="#local-6989586621679069859"><span class="hs-identifier hs-var">isFilled#</span></a><span>
</span><a name="line-699"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-700"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069856"><a href="#local-6989586621679069856"><span class="hs-identifier">el#</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#elemToInt%23"><span class="hs-identifier hs-var">U.elemToInt#</span></a><span> </span><a href="#local-6989586621679069855"><span class="hs-identifier hs-var">el</span></a><span>
</span><a name="line-701"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069857"><a href="#local-6989586621679069857"><span class="hs-identifier">deletedMarker#</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#elemToInt%23"><span class="hs-identifier hs-var">U.elemToInt#</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#deletedMarker"><span class="hs-identifier hs-var">deletedMarker</span></a><span>
</span><a name="line-702"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069858"><a href="#local-6989586621679069858"><span class="hs-identifier">emptyMarker#</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#elemToInt%23"><span class="hs-identifier hs-var">U.elemToInt#</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a><span>
</span><a name="line-703"></a><span class="hs-cpp">#if __GLASGOW_HASKELL__ &gt;= 708
</span><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069859"><a href="#local-6989586621679069859"><span class="hs-identifier">isFilled#</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069856"><span class="hs-identifier hs-var">el#</span></a><span> </span><span class="hs-operator hs-var">/=#</span><span> </span><a href="#local-6989586621679069857"><span class="hs-identifier hs-var">deletedMarker#</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">andI#</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069856"><span class="hs-identifier hs-var">el#</span></a><span> </span><span class="hs-operator hs-var">/=#</span><span> </span><a href="#local-6989586621679069858"><span class="hs-identifier hs-var">emptyMarker#</span></a><span class="hs-special">)</span><span>
</span><a name="line-705"></a><span class="hs-cpp">#else
</span><span>    </span><span class="hs-glyph">!</span><span class="hs-identifier">delOrEmpty#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mask#</span><span> </span><span class="hs-identifier">el#</span><span> </span><span class="hs-identifier">deletedMarker#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">orI#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">mask#</span><span> </span><span class="hs-identifier">el#</span><span> </span><span class="hs-identifier">emptyMarker#</span><span>
</span><a name="line-707"></a><span>    </span><span class="hs-glyph">!</span><span class="hs-identifier">isFilled#</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">andI#</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">notI#</span><span> </span><span class="hs-identifier">delOrEmpty#</span><span>
</span><a name="line-708"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-710"></a><span>
</span><a name="line-711"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-712"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">hash</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-713"></a><span class="hs-identifier">hash</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679069601"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679069601"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-714"></a><a name="hash"><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier">hash</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">H.hash</span><span>
</span><a name="line-715"></a><span>
</span><a name="line-716"></a><span>
</span><a name="line-717"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-718"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">hashToElem</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-719"></a><span class="hs-identifier">hashToElem</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#Elem"><span class="hs-identifier hs-type">Elem</span></a><span>
</span><a name="line-720"></a><a name="hashToElem"><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier">hashToElem</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069860"><a href="#local-6989586621679069860"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069865"><span class="hs-identifier hs-var">out</span></a><span>
</span><a name="line-721"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-722"></a><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-var">I#</span><span> </span><a name="local-6989586621679069861"><a href="#local-6989586621679069861"><span class="hs-identifier">lo#</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069860"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#elemMask"><span class="hs-identifier hs-var">U.elemMask</span></a><span>
</span><a name="line-723"></a><span>
</span><a name="line-724"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069862"><a href="#local-6989586621679069862"><span class="hs-identifier">m#</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.CacheLine.html#maskw%23"><span class="hs-identifier hs-var">maskw#</span></a><span> </span><a href="#local-6989586621679069861"><span class="hs-identifier hs-var">lo#</span></a><span> </span><span class="hs-number">0#</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">or#</span><span class="hs-special">`</span><span> </span><a href="Data.HashTable.Internal.CacheLine.html#maskw%23"><span class="hs-identifier hs-var">maskw#</span></a><span> </span><a href="#local-6989586621679069861"><span class="hs-identifier hs-var">lo#</span></a><span> </span><span class="hs-number">1#</span><span>
</span><a name="line-725"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069863"><a href="#local-6989586621679069863"><span class="hs-identifier">nm#</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">not#</span><span> </span><a href="#local-6989586621679069862"><span class="hs-identifier hs-var">m#</span></a><span>
</span><a name="line-726"></a><span>
</span><a name="line-727"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069864"><a href="#local-6989586621679069864"><span class="hs-identifier">r#</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">int2Word#</span><span> </span><span class="hs-number">2#</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">and#</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679069862"><span class="hs-identifier hs-var">m#</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">or#</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">int2Word#</span><span> </span><a href="#local-6989586621679069861"><span class="hs-identifier hs-var">lo#</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">and#</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679069863"><span class="hs-identifier hs-var">nm#</span></a><span class="hs-special">)</span><span>
</span><a name="line-728"></a><span>    </span><span class="hs-glyph">!</span><a name="local-6989586621679069865"><a href="#local-6989586621679069865"><span class="hs-identifier">out</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#primWordToElem"><span class="hs-identifier hs-var">U.primWordToElem</span></a><span> </span><a href="#local-6989586621679069864"><span class="hs-identifier hs-var">r#</span></a><span>
</span><a name="line-729"></a><span>
</span><a name="line-730"></a><span>
</span><a name="line-731"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-732"></a><span class="hs-identifier">newRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069598"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069599"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069600"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069598"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069598"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069599"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069600"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-733"></a><a name="newRef"><a href="Data.HashTable.ST.Basic.html#newRef"><span class="hs-identifier">newRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span> </span><a href="Data.HashTable.ST.Basic.html#HT"><span class="hs-identifier hs-var">HT</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">newSTRef</span><span>
</span><a name="line-734"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">newRef</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-735"></a><span>
</span><a name="line-736"></a><span class="hs-identifier">writeRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069595"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069596"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069597"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069595"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069596"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069597"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069595"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-737"></a><a name="writeRef"><a href="Data.HashTable.ST.Basic.html#writeRef"><span class="hs-identifier">writeRef</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HT"><span class="hs-identifier hs-var">HT</span></a><span> </span><a name="local-6989586621679069866"><a href="#local-6989586621679069866"><span class="hs-identifier">ref</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679069867"><a href="#local-6989586621679069867"><span class="hs-identifier">ht</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">writeSTRef</span><span> </span><a href="#local-6989586621679069866"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="#local-6989586621679069867"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-738"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">writeRef</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-739"></a><span>
</span><a name="line-740"></a><span class="hs-identifier">readRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069592"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069593"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069594"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069592"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable_"><span class="hs-identifier hs-type">HashTable_</span></a><span> </span><a href="#local-6989586621679069592"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069593"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069594"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-741"></a><a name="readRef"><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier">readRef</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HT"><span class="hs-identifier hs-var">HT</span></a><span> </span><a name="local-6989586621679069868"><a href="#local-6989586621679069868"><span class="hs-identifier">ref</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readSTRef</span><span> </span><a href="#local-6989586621679069868"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-742"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">readRef</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-743"></a><span>
</span><a name="line-744"></a><span>
</span><a name="line-745"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-746"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">debug</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-747"></a><span class="hs-identifier">debug</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069591"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-748"></a><span class="hs-cpp">#ifdef DEBUG
</span><span class="hs-identifier">debug</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unsafeIOToST</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">putStrLn</span><span> </span><span class="hs-identifier">s</span><span class="hs-special">)</span><span>
</span><a name="line-750"></a><span class="hs-cpp">#else
</span><a name="debug"><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier">debug</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-752"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-754"></a><span class="hs-identifier">lookupIndex</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679069588"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Hashable</span><span> </span><a href="#local-6989586621679069588"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069589"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069588"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069590"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679069588"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069589"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Word</span><span class="hs-special">)</span><span>
</span><a name="line-755"></a><a name="lookupIndex"><a href="Data.HashTable.ST.Basic.html#lookupIndex"><span class="hs-identifier">lookupIndex</span></a></a><span> </span><a name="local-6989586621679069869"><a href="#local-6989586621679069869"><span class="hs-identifier">htRef</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069870"><a href="#local-6989586621679069870"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-756"></a><span>    </span><a name="local-6989586621679069886"><a href="#local-6989586621679069886"><span class="hs-identifier">ht</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679069869"><span class="hs-identifier hs-var">htRef</span></a><span>
</span><a name="line-757"></a><span>    </span><a href="#local-6989586621679069871"><span class="hs-identifier hs-var">lookup'</span></a><span> </span><a href="#local-6989586621679069886"><span class="hs-identifier hs-var">ht</span></a><span>
</span><a name="line-758"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-759"></a><span>    </span><a name="local-6989586621679069871"><a href="#local-6989586621679069871"><span class="hs-identifier">lookup'</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679069872"><a href="#local-6989586621679069872"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679069873"><a href="#local-6989586621679069873"><span class="hs-identifier">hashes</span></a></a><span> </span><a name="local-6989586621679069874"><a href="#local-6989586621679069874"><span class="hs-identifier">keys</span></a></a><span> </span><a name="local-6989586621679069875"><a href="#local-6989586621679069875"><span class="hs-identifier">_values</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-760"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069885"><a href="#local-6989586621679069885"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.Internal.Utils.html#whichBucket"><span class="hs-identifier hs-var">whichBucket</span></a><span> </span><a href="#local-6989586621679069876"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679069872"><span class="hs-identifier hs-var">sz</span></a><span>
</span><a name="line-761"></a><span>        </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;lookup h=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069876"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; sz=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069872"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot; b=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069885"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-762"></a><span>        </span><a href="#local-6989586621679069878"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679069885"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679069872"><span class="hs-identifier hs-var">sz</span></a><span>
</span><a name="line-763"></a><span>
</span><a name="line-764"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-765"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069876"><a href="#local-6989586621679069876"><span class="hs-identifier">h</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#hash"><span class="hs-identifier hs-var">hash</span></a><span> </span><a href="#local-6989586621679069870"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-766"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679069877"><a href="#local-6989586621679069877"><span class="hs-identifier">he</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#hashToElem"><span class="hs-identifier hs-var">hashToElem</span></a><span> </span><a href="#local-6989586621679069876"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-767"></a><span>
</span><a name="line-768"></a><span>        </span><a name="local-6989586621679069878"><a href="#local-6989586621679069878"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069879"><a href="#local-6989586621679069879"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069880"><a href="#local-6989586621679069880"><span class="hs-identifier">start</span></a></a><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069881"><a href="#local-6989586621679069881"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;lookupIndex/go&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-769"></a><span>            </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;lookupIndex/go: &quot;</span><span>
</span><a name="line-770"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069879"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-771"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;/&quot;</span><span>
</span><a name="line-772"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069880"><span class="hs-identifier hs-var">start</span></a><span>
</span><a name="line-773"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;/&quot;</span><span>
</span><a name="line-774"></a><span>                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069881"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-775"></a><span>                           </span><span class="hs-special">]</span><span>
</span><a name="line-776"></a><span>            </span><a name="local-6989586621679069882"><a href="#local-6989586621679069882"><span class="hs-identifier">idx</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.CacheLine.html#forwardSearch2"><span class="hs-identifier hs-var">forwardSearch2</span></a><span> </span><a href="#local-6989586621679069873"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069879"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679069881"><span class="hs-identifier hs-var">end</span></a><span> </span><a href="#local-6989586621679069877"><span class="hs-identifier hs-var">he</span></a><span> </span><a href="Data.HashTable.ST.Basic.html#emptyMarker"><span class="hs-identifier hs-var">emptyMarker</span></a><span>
</span><a name="line-777"></a><span>            </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;forwardSearch2 returned &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-778"></a><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679069880"><span class="hs-identifier hs-var">start</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679069881"><span class="hs-identifier hs-var">end</span></a><span class="hs-special">)</span><span>
</span><a name="line-779"></a><span>               </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-780"></a><span>               </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-781"></a><span>                 </span><a name="local-6989586621679069883"><a href="#local-6989586621679069883"><span class="hs-identifier">h0</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a><span> </span><a href="#local-6989586621679069873"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-782"></a><span>                 </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;h0 was &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069883"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-783"></a><span>
</span><a name="line-784"></a><span>                 </span><span class="hs-keyword">if</span><span> </span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a><span> </span><a href="#local-6989586621679069883"><span class="hs-identifier hs-var">h0</span></a><span>
</span><a name="line-785"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-786"></a><span>                       </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;record empty, returning Nothing&quot;</span><span>
</span><a name="line-787"></a><span>                       </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-788"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-789"></a><span>                     </span><a name="local-6989586621679069884"><a href="#local-6989586621679069884"><span class="hs-identifier">k'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069874"><span class="hs-identifier hs-var">keys</span></a><span> </span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-790"></a><span>                     </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679069870"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679069884"><span class="hs-identifier hs-var">k'</span></a><span>
</span><a name="line-791"></a><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-792"></a><span>                         </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;value found at &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span>
</span><a name="line-793"></a><span>                         </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$!</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span class="hs-special">)</span><span>
</span><a name="line-794"></a><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-795"></a><span>                         </span><a href="Data.HashTable.ST.Basic.html#debug"><span class="hs-identifier hs-var">debug</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;value not found, recursing&quot;</span><span>
</span><a name="line-796"></a><span>                         </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679069879"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-797"></a><span>                           </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679069878"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069879"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-798"></a><span>                           </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679069878"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069882"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679069880"><span class="hs-identifier hs-var">start</span></a><span> </span><a href="#local-6989586621679069881"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-799"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">lookupIndex</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-800"></a><span>
</span><a name="line-801"></a><span class="hs-identifier">nextByIndex</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-type">HashTable</span></a><span> </span><a href="#local-6989586621679069585"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679069586"><span class="hs-identifier hs-type">k</span></a><span> </span><a href="#local-6989586621679069587"><span class="hs-identifier hs-type">v</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ST</span><span> </span><a href="#local-6989586621679069585"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679069586"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679069587"><span class="hs-identifier hs-type">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-802"></a><a name="nextByIndex"><a href="Data.HashTable.ST.Basic.html#nextByIndex"><span class="hs-identifier">nextByIndex</span></a></a><span> </span><a name="local-6989586621679069887"><a href="#local-6989586621679069887"><span class="hs-identifier">htRef</span></a></a><span> </span><a name="local-6989586621679069888"><a href="#local-6989586621679069888"><span class="hs-identifier">i0</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.HashTable.ST.Basic.html#readRef"><span class="hs-identifier hs-var">readRef</span></a><span> </span><a href="#local-6989586621679069887"><span class="hs-identifier hs-var">htRef</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679069889"><span class="hs-identifier hs-var">work</span></a><span>
</span><a name="line-803"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-804"></a><span>    </span><a name="local-6989586621679069889"><a href="#local-6989586621679069889"><span class="hs-identifier">work</span></a></a><span> </span><span class="hs-special">(</span><a href="Data.HashTable.ST.Basic.html#HashTable"><span class="hs-identifier hs-var">HashTable</span></a><span> </span><a name="local-6989586621679069890"><a href="#local-6989586621679069890"><span class="hs-identifier">sz</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679069891"><a href="#local-6989586621679069891"><span class="hs-identifier">hashes</span></a></a><span> </span><a name="local-6989586621679069892"><a href="#local-6989586621679069892"><span class="hs-identifier">keys</span></a></a><span> </span><a name="local-6989586621679069893"><a href="#local-6989586621679069893"><span class="hs-identifier">values</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679069894"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679069888"><span class="hs-identifier hs-var">i0</span></a><span class="hs-special">)</span><span>
</span><a name="line-805"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-806"></a><span>        </span><a name="local-6989586621679069894"><a href="#local-6989586621679069894"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679069895"><a href="#local-6989586621679069895"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679069895"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679069890"><span class="hs-identifier hs-var">sz</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-807"></a><span>             </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-808"></a><span>            </span><a name="local-6989586621679069896"><a href="#local-6989586621679069896"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.IntArray.html#readArray"><span class="hs-identifier hs-var">U.readArray</span></a><span> </span><a href="#local-6989586621679069891"><span class="hs-identifier hs-var">hashes</span></a><span> </span><a href="#local-6989586621679069895"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-809"></a><span>            </span><span class="hs-keyword">if</span><span> </span><a href="Data.HashTable.ST.Basic.html#recordIsEmpty"><span class="hs-identifier hs-var">recordIsEmpty</span></a><span> </span><a href="#local-6989586621679069896"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Data.HashTable.ST.Basic.html#recordIsDeleted"><span class="hs-identifier hs-var">recordIsDeleted</span></a><span> </span><a href="#local-6989586621679069896"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-810"></a><span>              </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679069894"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069895"><span class="hs-identifier hs-var">i</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-811"></a><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-812"></a><span>                </span><a name="local-6989586621679069897"><a href="#local-6989586621679069897"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069892"><span class="hs-identifier hs-var">keys</span></a><span> </span><a href="#local-6989586621679069895"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-813"></a><span>                </span><a name="local-6989586621679069898"><a href="#local-6989586621679069898"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Data.HashTable.Internal.Array.html#readArray"><span class="hs-identifier hs-var">readArray</span></a><span> </span><a href="#local-6989586621679069893"><span class="hs-identifier hs-var">values</span></a><span> </span><a href="#local-6989586621679069895"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-814"></a><span>                </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679069899"><a href="#local-6989586621679069899"><span class="hs-identifier">i'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679069895"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-815"></a><span>                </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679069899"><span class="hs-identifier hs-var">i'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679069897"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679069898"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-816"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">nextByIndex</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-817"></a></pre></body></html>